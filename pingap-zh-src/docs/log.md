---
sidebar_position: 61
---

# è®¿é—®æ—¥å¿—æ ¼å¼åŒ–

Pingap æä¾›äº†å¼ºå¤§ä¸”çµæ´»çš„è®¿é—®æ—¥å¿—åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥é€‰æ‹©å¼€ç®±å³ç”¨çš„é¢„è®¾æ ¼å¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸°å¯Œçš„å˜é‡æ¥æž„å»ºå®Œå…¨è‡ªå®šä¹‰çš„æ—¥å¿—æ ¼å¼ã€‚

åœ¨`server.toml`é…ç½®æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ access_log å­—æ®µæ¥æŒ‡å®šæ—¥å¿—æ ¼å¼ã€‚


1. é¢„è®¾æ ¼å¼

ä¸ºæ–¹ä¾¿å¿«é€Ÿé…ç½®ï¼ŒPingap å†…ç½®äº†å››ç§ä¸šç•Œæ ‡å‡†çš„æ—¥å¿—æ ¼å¼ï¼š

| æ ¼å¼åç§° | æ ¼å¼åŒ–å­—ç¬¦ä¸²                                                                                   |
| -------- | ---------------------------------------------------------------------------------------------- |
| combined | `{client_ip} - - [{when}] "{method} {uri} {proto}" {status} {size} "{referer}" "{user_agent}"` |
| common   | `{client_ip} - - [{when}] "{method} {uri} {proto}" {status} {size}`                            |
| short    | `{client_ip} - {method} {uri} {proto} {status} {size} - {latency_human}`                       |
| tiny     | `{method} {uri} {status} {size} - {latency_human}`                                             |

ä½¿ç”¨ç¤ºä¾‹ï¼š

```toml
# åœ¨ server.x.toml ä¸­
access_log = "combined"
```

2. è‡ªå®šä¹‰æ ¼å¼

å¦‚æžœæ‚¨éœ€è¦è®°å½•æ›´å¤šç»´åº¦çš„ä¿¡æ¯ï¼Œå¯ä»¥æž„å»ºè‡ªå®šä¹‰çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚

å·¥ä½œåŽŸç†ï¼šå°†ä¸‹æ–‡â€œå˜é‡å‚è€ƒâ€ä¸­çš„å˜é‡ï¼ˆç”¨ {} åŒ…è£¹ï¼‰ç»„åˆæˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

é…ç½®ç¤ºä¾‹ï¼š

```toml
# åœ¨ server.x.toml ä¸­
access_log = '{client_ip} - [{when}] "{method} {uri} {proto}" status={status} size={size} latency={latency_human} upstream={:upstream_addr} upstream_time={:upstream_processing_time_human}'
```

3. æŒ‡å®šæ—¥å¿—è¾“å‡ºæ–‡ä»¶

é»˜è®¤æƒ…å†µä¸‹ï¼Œè®¿é—®æ—¥å¿—ä¸Žç¨‹åºæ—¥å¿—å…±åŒè¾“å‡ºåŒä¸€æ–‡ä»¶ä¸­ï¼Œè‹¥å¸Œæœ›å•ç‹¬è¾“å‡ºï¼Œåˆ™å¯ä»¥æŒ‡å®šæ—¥å¿—è¾“å‡ºæ–‡ä»¶ã€‚

```toml
# åœ¨ server.x.toml ä¸­
access_log = '/var/log/pingap.log {when} {path}'
```

4. å˜é‡å‚è€ƒ

è¯·æ±‚åŸºç¡€ä¿¡æ¯

| å˜é‡             | è¯´æ˜Ž                          | ç¤ºä¾‹å€¼              |
| ---------------- | ----------------------------- | ------------------- |
| `{method}`       | HTTP è¯·æ±‚æ–¹æ³•                 | GET                 |
| `{scheme}`       | è¯·æ±‚åè®®                      | https               |
| `{host}`         | è¯·æ±‚å¤´ä¸­çš„ä¸»æœºå              | api.example.com     |
| `{path}`         | è¯·æ±‚è·¯å¾„ï¼ˆä¸å«æŸ¥è¯¢å‚æ•°ï¼‰      | `/users/123`        |
| `{query}`        | æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆä¸å« ?ï¼‰          | `id=123&type=new`   |
| `{uri}`          | å®Œæ•´çš„è¯·æ±‚ URIï¼ˆè·¯å¾„ + æŸ¥è¯¢ï¼‰ | `/users/123?id=123` |
| `{proto}`        | HTTP åè®®ç‰ˆæœ¬                 | HTTP/2.0            |
| `{payload_size}` | è¯·æ±‚ä½“å¤§å°ï¼ˆå­—èŠ‚ï¼‰            | 1024                |

å®¢æˆ·ç«¯ä¸Žä»£ç†ä¿¡æ¯

| å˜é‡           | è¯´æ˜Ž                                                                                   | ç¤ºä¾‹å€¼                 |
| -------------- | -------------------------------------------------------------------------------------- | ---------------------- |
| `{remote}`     | TCP è¿žæŽ¥çš„æº IP åœ°å€                                                                   | 123.123.123.123        |
| `{client_ip}`  | å®¢æˆ·ç«¯çœŸå®ž IPã€‚ä¼˜å…ˆçº§: X-Forwarded-For > X-Real-Ip > `{remote}`ã€‚<br/>ðŸ’¡ æŽ¨èä½¿ç”¨æ­¤å˜é‡ | 192.168.1.10           |
| `{referer}`    | HTTP Referer è¯·æ±‚å¤´                                                                    | `https://example.com/` |
| `{user_agent}` | User-Agent è¯·æ±‚å¤´                                                                      | `Mozilla/5.0 ...`      |
| `{request_id}` | è¯·æ±‚çš„å”¯ä¸€ IDã€‚éœ€é…ç½® Request ID æ’ä»¶                                                  | uuid-v4-string         |

æ—¶é—´ä¸Žæ€§èƒ½

| å˜é‡             | è¯´æ˜Ž                                 | ç¤ºä¾‹å€¼                     |
| ---------------- | ------------------------------------ | -------------------------- |
| `{when}`         | æ—¥å¿—è®°å½•æ—¶é—´ (æœ¬åœ°æ—¶é—´)              | 12/Sep/2025:21:30:00 +0800 |
| `{when_utc_iso}` | æ—¥å¿—è®°å½•æ—¶é—´ (UTC, ISO 8601)         | 2025-09-12T13:30:00Z       |
| `{when_unix}`    | æ—¥å¿—è®°å½•æ—¶é—´ (Unix æ—¶é—´æˆ³)           | 1757751000                 |
| `{latency}`      | ä»ŽæŽ¥æ”¶è¯·æ±‚åˆ°å“åº”å®Œæˆçš„æ€»è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰ | 32                         |

å“åº”ä¿¡æ¯

| å˜é‡       | è¯´æ˜Ž               | ç¤ºä¾‹å€¼ |
| ---------- | ------------------ | ------ |
| `{status}` | HTTP å“åº”çŠ¶æ€ç     | 200    |
| `{size}`   | å“åº”ä½“å¤§å°ï¼ˆå­—èŠ‚ï¼‰ | 4096   |


åŠ¨æ€å€¼æå–

æ‚¨è¿˜å¯ä»¥ä»Žè¯·æ±‚/å“åº”çš„ä»»æ„ä½ç½®æå–ä¿¡æ¯ã€‚

| å˜é‡è¯­æ³•      | è¯´æ˜Ž                   | ç¤ºä¾‹                 |
| ------------- | ---------------------- | -------------------- |
| `{>name}`     | èŽ·å–è¯·æ±‚å¤´çš„å€¼         | `{>X-User-Id}`       |
| `{<name}`     | èŽ·å–å“åº”å¤´çš„å€¼         | `{<X-Trace-Id}`      |
| `{~name}`     | èŽ·å–Cookie çš„å€¼        | `{~session_id}`      |
| `{$name}`     | èŽ·å–çŽ¯å¢ƒå˜é‡çš„å€¼       | `{$POD_NAME}`        |
| `{$hostname}` | èŽ·å–å½“å‰æœåŠ¡å™¨çš„ä¸»æœºå | `pingap-prod-node-1` |


åº•å±‚è¿žæŽ¥ä¸Žä¸Šä¸‹æ–‡ä¿¡æ¯ `({:name})`
é€šè¿‡ `{:name}` è¯­æ³•ï¼Œå¯ä»¥èŽ·å–æ›´æ·±å±‚æ¬¡çš„è¿žæŽ¥ã€TLSã€Upstream å’Œæ€§èƒ½æŒ‡æ ‡ã€‚

ç”¨æ³•ç¤ºä¾‹ï¼š`{:connection_id}`


è¿žæŽ¥ç›¸å…³
- `connection_id`: è¿žæŽ¥çš„å”¯ä¸€ IDã€‚
- `connection_time`: TCP è¿žæŽ¥çš„æŒç»­æ—¶é—´ã€‚
- `connection_reused`: è¿žæŽ¥æ˜¯å¦è¢«å¤ç”¨ (true/false)ã€‚
- `processing`: å½“å‰æ­£åœ¨å¤„ç†çš„å¹¶å‘è¯·æ±‚æ•°ã€‚
- `service_time`: è¯·æ±‚åœ¨ Pingap å†…éƒ¨çš„æ€»å¤„ç†æ—¶é—´ã€‚

TLS ç›¸å…³ (HTTPS)

- `tls_version`: TLS ç‰ˆæœ¬ï¼Œå¦‚ TLSv1.3ã€‚
- `tls_cipher`: ä½¿ç”¨çš„ TLS åŠ å¯†å¥—ä»¶ã€‚
- `tls_handshake_time`: TLS æ¡æ‰‹è€—æ—¶ã€‚

Upstream ç›¸å…³

- `upstream_addr`: å®žé™…è¯·æ±‚çš„åŽç«¯æœåŠ¡åœ°å€ã€‚
- `upstream_status`: åŽç«¯æœåŠ¡è¿”å›žçš„ HTTP çŠ¶æ€ç ã€‚
- `upstream_reused`: åˆ°åŽç«¯çš„è¿žæŽ¥æ˜¯å¦è¢«å¤ç”¨ (true/false)ã€‚
- `upstream_connected` : å½“å‰ Location åˆ°åŽç«¯çš„æ€»è¿žæŽ¥æ•°ã€‚
- `upstream_connect_time`: è¿žæŽ¥åˆ°åŽç«¯çš„æ€»è€—æ—¶ï¼ˆTCP + TLSï¼‰ã€‚
- `upstream_tcp_connect_time`: TCP è¿žæŽ¥åˆ°åŽç«¯çš„è€—æ—¶ã€‚
- `upstream_tls_handshake_time`: ä¸ŽåŽç«¯è¿›è¡Œ TLS æ¡æ‰‹çš„è€—æ—¶ã€‚
- `upstream_processing_time`: åŽç«¯æœåŠ¡çš„å¤„ç†è€—æ—¶ã€‚
- `upstream_response_time`: ä»Žå‘é€è¯·æ±‚åˆ°æ”¶åˆ°å“åº”çš„å®Œæ•´æ—¶é—´ã€‚

å…¶ä»–æ€§èƒ½æŒ‡æ ‡

- `compression_time`: å“åº”åŽ‹ç¼©çš„è€—æ—¶ã€‚
- `compression_ratio`: åŽ‹ç¼©æ¯”çŽ‡ã€‚
- `cache_lookup_time`: ç¼“å­˜æŸ¥è¯¢è€—æ—¶ã€‚
- `cache_lock_time`: ç¼“å­˜é”ç­‰å¾…è€—æ—¶ã€‚


ðŸ’¡ äººæ€§åŒ–å•ä½åŽç¼€ (_human)

æ‰€æœ‰è¡¨ç¤ºæ—¶é—´ (*_time) æˆ–å¤§å° (*_size) çš„å˜é‡ï¼Œéƒ½æä¾›äº†ä¸€ä¸ªå¸¦ _human åŽç¼€çš„ç‰ˆæœ¬ï¼Œç”¨äºŽè¾“å‡ºå¯¹äººç±»å‹å¥½çš„ã€å¸¦å•ä½çš„æ ¼å¼ã€‚

- `{latency}` â†’ 32 (ms)
- `{latency_human}` â†’ 32ms
- `{size}` â†’ 4096 (bytes)
- `{size_human}` â†’ 4.0KiB
- `{:upstream_processing_time}` â†’ 18 (ms)
- `{:upstream_processing_time_human}` â†’ 18ms

