---
sidebar_position: 82
title: Accept Encoding 插件
description: 优化与上游服务的压缩协商。通过过滤和重排 Accept-Encoding 请求头，确保后端服务仅接收其支持的压缩算法，并可按需指定算法优先级。
---

# Accept Encoding 插件

`accept-encoding` 插件是一个请求转换插件，它允许您在将请求转发到上游服务之前，拦截并修改客户端发送的 `Accept-Encoding` 请求头。

## 功能简介

HTTP 客户端通过 `Accept-Encoding` 请求头告诉服务器它支持哪些压缩算法（如 `gzip`, `br`, `zstd`）。然而，您的后端服务可能只支持其中的一部分，或者您希望优先使用某种更高效的算法。

此插件的核心功能就是充当一个**过滤器和排序器**：
1.  **过滤**：移除后端服务不支持的压缩算法。
2.  **排序**：根据您定义的优先级，重新排列算法顺序。
3.  **限制**：可以选择只向上游服务传递一种（最高优先级的）压缩算法。


## 使用场景

* **优化压缩算法**：您的后端同时支持 `gzip` 和 `br`，但 `br` 的压缩率更高。您可以通过配置 `encodings = "br, gzip"` 来确保当客户端同时支持两者时，优先与后端协商使用 `br` 压缩，以便于缓存时可基于`Accept-Encoding` + `url`进行缓存。
* **CDN 与源站协同**：当您的 CDN 已经能够处理多种压缩格式，但您希望源站只处理 `gzip` 以减轻负载时，此插件可以确保回源请求中只包含 `gzip`。

## 配置参数

在 `plugin.accept-encoding.toml` 文件中进行配置。

| 参数                | 类型    | 是否必需 | 默认值  | 说明                                                                                                 |
| :------------------ | :------ | :------- | :------ | :--------------------------------------------------------------------------------------------------- |
| `encodings`         | String  | 是       | -       | 一个**有序的**、以逗号分隔的压缩算法列表。**列表的顺序代表了优先级**，排在最前面的算法将被优先选择。 |
| `only_one_encoding` | Boolean | 否       | `false` | 是否只向上游服务发送一种（客户端支持的、优先级最高的）编码。                                         |