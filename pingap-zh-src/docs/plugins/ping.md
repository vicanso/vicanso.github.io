---
sidebar_position: 94
title: å¥åº·æ£€æŸ¥ (Ping)
description: æä¾›ä¸€ä¸ªè½»é‡çº§çš„ HTTP ç«¯ç‚¹ï¼Œç”¨äºæœåŠ¡å­˜æ´»æ¢æµ‹ (Liveness Probe) å’Œå°±ç»ªæ¢æµ‹ (Readiness Probe)ï¼Œæ˜¯å®ç°æœåŠ¡é«˜å¯ç”¨å’Œè‡ªåŠ¨åŒ–è¿ç»´çš„åŸºç¡€ã€‚
---

# å¥åº·æ£€æŸ¥ (Ping) æ’ä»¶

`ping` æ’ä»¶æ˜¯ä¸€ä¸ªæå…¶ç®€å•è€Œé‡è¦çš„å·¥å…·ï¼Œå®ƒçš„å”¯ä¸€åŠŸèƒ½å°±æ˜¯æä¾›ä¸€ä¸ª HTTP ç«¯ç‚¹ï¼Œå½“è¯¥ç«¯ç‚¹è¢«è®¿é—®æ—¶ï¼Œä¼šç«‹å³è¿”å›ä¸€ä¸ª `200 OK` å“åº”ï¼Œå“åº”ä½“ä¸ºçº¯æ–‡æœ¬ `pong`ã€‚

## åŠŸèƒ½ç®€ä»‹

è¯¥æ’ä»¶ä¼šç›‘å¬ä¸€ä¸ªæ‚¨æ‰€é…ç½®çš„ç‰¹å®šè·¯å¾„ï¼ˆä¾‹å¦‚ `/ping`ï¼‰ã€‚ä»»ä½•å¯¹è¯¥è·¯å¾„çš„ `GET` è¯·æ±‚éƒ½ä¼šè¢«æ’ä»¶**æ‹¦æˆª**å¹¶**ç«‹å³å“åº”**ï¼Œè€Œä¸ä¼šå°†è¯·æ±‚è½¬å‘åˆ°ä»»ä½•ä¸Šæ¸¸æœåŠ¡ã€‚

è¿™ä¸ªå¿«é€Ÿçš„â€œä¸€é—®ä¸€ç­”â€æœºåˆ¶æ˜¯å®ç°æœåŠ¡å¥åº·æ£€æŸ¥çš„ç†æƒ³æ–¹å¼ã€‚

## ä½¿ç”¨åœºæ™¯

* **å®¹å™¨ç¼–æ’å¥åº·æ£€æŸ¥ (Kubernetes, Docker Swarm)**ï¼š
    * **å­˜æ´»æ¢æµ‹ (Liveness Probe)**: K8s å¯ä»¥å®šæœŸè¯·æ±‚ `/ping` æ¥å£ã€‚å¦‚æœ Pingap å®ä¾‹æ— å“åº”ï¼ŒK8s ä¼šè®¤ä¸ºè¯¥å®ä¾‹å·²æ­»é”æˆ–å´©æºƒï¼Œå¹¶ä¼šè‡ªåŠ¨é‡å¯å®¹å™¨ï¼Œå®ç°æœåŠ¡è‡ªæ„ˆã€‚
    * **å°±ç»ªæ¢æµ‹ (Readiness Probe)**: K8s å¯ä»¥é€šè¿‡æ­¤æ¥å£åˆ¤æ–­ Pingap å®ä¾‹æ˜¯å¦å·²å‡†å¤‡å¥½æ¥æ”¶æµé‡ã€‚åªæœ‰å½“ `/ping` æ¥å£è¿”å›æˆåŠŸæ—¶ï¼ŒK8s æ‰ä¼šå°†æµé‡è½¬å‘åˆ°è¯¥å®ä¾‹ã€‚

* **è´Ÿè½½å‡è¡¡å™¨å¥åº·æ£€æŸ¥ (AWS ELB, Nginx)**ï¼š
    * è´Ÿè½½å‡è¡¡å™¨ä¼šå‘¨æœŸæ€§åœ°å‘åç«¯çš„æ¯ä¸ª Pingap å®ä¾‹å‘é€å¥åº·æ£€æŸ¥è¯·æ±‚ã€‚å¦‚æœæŸä¸ªå®ä¾‹çš„ `/ping` æ¥å£ä¸è¿”å› `200 OK`ï¼Œè´Ÿè½½å‡è¡¡å™¨ä¼šæš‚æ—¶å°†å…¶ä»å¯ç”¨èŠ‚ç‚¹æ± ä¸­ç§»é™¤ï¼Œç›´åˆ°å®ƒæ¢å¤æ­£å¸¸ã€‚

* **æœåŠ¡ç›‘æ§ä¸å‘Šè­¦ (Prometheus, Zabbix)**ï¼š
    * ç›‘æ§ç³»ç»Ÿå¯ä»¥é€šè¿‡å®šæœŸè¯·æ±‚æ­¤æ¥å£æ¥ç›‘æ§ Pingap æœåŠ¡çš„å¯ç”¨æ€§ï¼Œå¹¶åœ¨æœåŠ¡ä¸­æ–­æ—¶åŠæ—¶å‘å‡ºå‘Šè­¦ã€‚

* **è¿é€šæ€§æµ‹è¯•**ï¼š
    * å¼€å‘æˆ–è¿ç»´äººå‘˜å¯ä»¥å¿«é€Ÿé€šè¿‡ `curl` å‘½ä»¤è®¿é—®æ­¤æ¥å£ï¼Œä»¥éªŒè¯ Pingap æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œå¹¶ä¸”ç½‘ç»œå¯è¾¾ã€‚

## é…ç½®å‚æ•°

åœ¨ `plugins.ping.toml` æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ã€‚

| å‚æ•°   | ç±»å‹   | æ˜¯å¦å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜                                                               |
| :----- | :----- | :------- | :----- | :----------------------------------------------------------------- |
| `path` | String | **æ˜¯**   | -      | **ï¼ˆå¿…éœ€ï¼‰** ç”¨äºå¥åº·æ£€æŸ¥çš„ URL è·¯å¾„ã€‚æ’ä»¶ä¼šå¯¹æ­¤è·¯å¾„è¿›è¡Œç²¾ç¡®åŒ¹é…ã€‚ |

---

## å®Œæ•´ç¤ºä¾‹

**ç›®æ ‡**ï¼šä¸ºæˆ‘ä»¬çš„ Pingap æœåŠ¡æ·»åŠ ä¸€ä¸ªä½äº `/healthz` çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹ã€‚

1.  **é…ç½®æ’ä»¶ (`plugins.ping-healthcheck.toml`)**:
    ```toml
    # æŒ‡å®šå¥åº·æ£€æŸ¥çš„ç«¯ç‚¹è·¯å¾„
    path = "/healthz"
    ```

2.  **åœ¨ Location ä¸­åº”ç”¨æ’ä»¶ (`location.toml`)**:
    > ğŸ’¡ **æœ€ä½³å®è·µ**ï¼šå¥åº·æ£€æŸ¥çš„ `Location` åº”è¯¥æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ã€ä¸é…ç½® `upstream` çš„è§„åˆ™ï¼Œå› ä¸ºå®ƒç”±æ’ä»¶ç›´æ¥å“åº”ã€‚é€šå¸¸ï¼Œè¿™ä¸ªç«¯ç‚¹åº”è¯¥åªåœ¨å†…éƒ¨ç½‘ç»œæˆ–ç‰¹å®šçš„ç®¡ç†ç«¯å£ä¸Šæš´éœ²ã€‚

    ```toml
    # location.toml
    [locations.route-for-my-app]
    path = "/"
    upstream = "my-main-service"
    plugins = [
        "ping-healthcheck",
    ]
    ```

### å¦‚ä½•éªŒè¯

å¯åŠ¨ Pingap åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `curl` æ¥æµ‹è¯•è¯¥ç«¯ç‚¹ï¼š

```bash
curl http://<your-pingap-address>/healthz