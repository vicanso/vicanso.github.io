---
sidebar_position: 1
---


## ä»€ä¹ˆæ˜¯ Pingapï¼Ÿ

Pingap æ˜¯ä¸€æ¬¾çŽ°ä»£åŒ–ã€é«˜æ€§èƒ½çš„åå‘ä»£ç†æœåŠ¡ï¼Œå®ƒæž„å»ºäºŽ Cloudflare å¼€æºçš„ Rust æ¡†æž¶ [Pingora](https://github.com/cloudflare/pingora) ä¹‹ä¸Šã€‚

Pingap çš„æ ¸å¿ƒä½¿å‘½æ˜¯å°† [Pingora](https://github.com/cloudflare/pingora) æ¡†æž¶å¼ºå¤§çš„æ€§èƒ½å’Œç¨³å®šæ€§ï¼Œé€šè¿‡ç®€æ´çš„ TOML é…ç½®å’Œæ’ä»¶åŒ–ä½“ç³»ï¼Œå¸¦ç»™æ¯ä¸€ä½å¼€å‘è€…ï¼Œå³ä½¿æ‚¨ä¸ç†Ÿæ‚‰ Rust è¯­è¨€ï¼Œä¹Ÿèƒ½è½»æ¾é©¾é©­ã€‚

æ‚¨å¯ä»¥éšæ—¶ä»Ž[Releases](https://github.com/vicanso/pingap/releases)é¡µé¢ä¸‹è½½é€‚ç”¨äºŽå„ç§ç³»ç»Ÿæž¶æž„çš„é¢„ç¼–è¯‘ç‰ˆæœ¬ã€‚

## ä¸ºä»€ä¹ˆé€‰æ‹© Pingapï¼Ÿ

- ðŸš€ æžè‡´æ€§èƒ½ä¸Žå¯é æ€§
  ç»§æ‰¿è‡ª Pingora çš„å¼‚æ­¥å¤šçº¿ç¨‹æž¶æž„ï¼Œæä¾›æžä½Žå»¶è¿Ÿå’Œé«˜åžåé‡çš„ç½‘ç»œå¤„ç†èƒ½åŠ›ï¼Œç¡®ä¿æ‚¨çš„æœåŠ¡ç¨³å®šã€é«˜æ•ˆã€‚

- âœï¸ ç®€å•ç›´è§‚çš„é…ç½®
  å‘Šåˆ«å¤æ‚çš„é…ç½®è¯­æ³•ã€‚é€šè¿‡äººæ€§åŒ–çš„ TOML æ–‡ä»¶æˆ–ç›´è§‚çš„ Web UI ç•Œé¢ï¼Œå³å¯å®Œæˆæ‰€æœ‰é…ç½®ã€‚æ”¯æŒé…ç½®çƒ­æ›´æ–°ï¼Œå®žçŽ°é›¶åœæœºå˜æ›´ã€‚

- ðŸ§© é«˜åº¦çµæ´»çš„æ‰©å±•
  å¼ºå¤§çš„æ’ä»¶ä½“ç³»è´¯ç©¿è¯·æ±‚å¤„ç†çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼Œæ— è®ºæ˜¯è®¤è¯ã€é™æµã€ç¼“å­˜è¿˜æ˜¯è‡ªå®šä¹‰é€»è¾‘ï¼Œéƒ½èƒ½åƒç§¯æœ¨ä¸€æ ·è½»æ¾ç»„åˆï¼Œæ»¡è¶³å„ç§å¤æ‚åœºæ™¯ã€‚


## æ ¸å¿ƒç‰¹æ€§

å¼ºå¤§çš„è·¯ç”±ä¸Žè´Ÿè½½å‡è¡¡

- ç²¾ç»†åŒ–è·¯ç”±ï¼šæ”¯æŒåŸºäºŽ Hostã€Path çš„å¤šç§åŒ¹é…æ¨¡å¼ï¼ˆå‰ç¼€ã€æ­£åˆ™ã€ç²¾ç¡®ï¼‰ï¼Œè½»æ¾å®žçŽ°å•æœåŠ¡çš„å¤æ‚è·¯ç”±åˆ†å‘ã€‚
- çµæ´»é‡å†™ï¼šå†…ç½®å¼ºå¤§çš„URLé‡å†™å¼•æ“Žï¼Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯è½»æ¾ä¿®æ”¹è·¯å¾„æˆ–æ·»åŠ å‰ç¼€ã€‚
- æ™ºèƒ½è´Ÿè½½å‡è¡¡ï¼šæä¾›è½®è¯¢ã€æƒé‡ã€ä¼šè¯ä¿æŒï¼ˆåŸºäºŽ IPã€Header ç­‰ï¼‰ç­‰å¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚

çŽ°ä»£åŒ–åè®®ä¸Žå®‰å…¨

- å…¨é¢åè®®æ”¯æŒï¼šå®Œæ•´æ”¯æŒ HTTP/1.xã€HTTP/2ï¼Œå¹¶èƒ½å¤„ç† gRPC-web å’Œ h2c æµé‡ã€‚
- è‡ªåŠ¨åŒ– TLSï¼šé›†æˆ Let's Encryptï¼Œå®žçŽ°è¯ä¹¦çš„è‡ªåŠ¨ç”³è¯·ä¸Žç»­æœŸã€‚æ”¯æŒåŸºäºŽ SNI åŠ¨æ€é€‰æ‹©è¯ä¹¦ï¼Œè½»æ¾ç®¡ç†å¤šåŸŸå HTTPS æœåŠ¡ã€‚

åŠ¨æ€åŒ–ä¸Žè‡ªåŠ¨åŒ–

- åŠ¨æ€é…ç½®ï¼šæ”¯æŒä»Žæ–‡ä»¶ç³»ç»Ÿæˆ– etcd åŠ è½½é…ç½®ï¼Œæ ¸å¿ƒé…ç½®ï¼ˆè·¯ç”±ã€ä¸Šæ¸¸ç­‰ï¼‰å˜æ›´å¯åœ¨ 10ç§’å†…çƒ­åŠ è½½ï¼Œæ— éœ€é‡å¯ã€‚
- æœåŠ¡å‘çŽ°ï¼šé™¤äº†é™æ€åœ°å€é…ç½®ï¼Œè¿˜æ”¯æŒåŸºäºŽ DNS å’Œ Docker Label çš„åŠ¨æ€æœåŠ¡å‘çŽ°ï¼Œæ— ç¼å¯¹æŽ¥å®¹å™¨åŒ–çŽ¯å¢ƒã€‚

å¯è§‚æµ‹æ€§ä¸Žè¿ç»´

- å¤šç»´åº¦ç›‘æŽ§ï¼šåŽŸç”Ÿé›†æˆ Prometheusï¼Œè½»æ¾æš´éœ²ä¸°å¯Œçš„æ€§èƒ½æŒ‡æ ‡ï¼Œæ”¯æŒ Pull å’Œ Push ä¸¤ç§æ¨¡å¼ã€‚
- åˆ†å¸ƒå¼è¿½è¸ªï¼šå†…ç½® OpenTelemetry æ”¯æŒï¼ŒåŠ©åŠ›æ‚¨æž„å»ºå®Œæ•´çš„åˆ†å¸ƒå¼è°ƒç”¨é“¾ç›‘æŽ§ã€‚
- é«˜åº¦å¯å®šåˆ¶æ—¥å¿—ï¼šæä¾›è¶…è¿‡ 30ç§ æ¨¡æ¿å˜é‡ï¼Œè®©æ‚¨éšå¿ƒæ‰€æ¬²åœ°å®šåˆ¶è®¿é—®æ—¥å¿—æ ¼å¼ã€‚
- Webç®¡ç†ç•Œé¢ï¼šæä¾›å¼€ç®±å³ç”¨çš„ Web UIï¼Œè®©é…ç½®ç®¡ç†å’ŒæœåŠ¡çŠ¶æ€ç›‘æŽ§æ›´åŠ ç›´è§‚ã€‚

## è¯·æ±‚å¤„ç†æµç¨‹

å½“ä¸€ä¸ª HTTP è¯·æ±‚åˆ°è¾¾ Pingap æ—¶ï¼Œå®ƒä¼šç»åŽ†ä¸€å¥—æ ‡å‡†åŒ–çš„å¤„ç†æµç¨‹ã€‚æ‚¨å¯ä»¥å°†å…¶ç†è§£ä¸ºä¸€æ¡ç”±å¤šä¸ªå¤„ç†ç«™ç»„æˆçš„æµæ°´çº¿ï¼š

1ã€æœåŠ¡ç›‘å¬ï¼šServer åœ¨æŒ‡å®šç«¯å£æŽ¥æ”¶åˆ°è¯·æ±‚ã€‚
2ã€è·¯ç”±åŒ¹é…ï¼šæ ¹æ®è¯·æ±‚çš„ Host å’Œ Pathï¼ŒåŒ¹é…åˆ°æœ€åˆé€‚çš„ Location è§„åˆ™ã€‚
3ã€è¯·æ±‚å¤„ç†ï¼ˆæ’ä»¶ï¼‰ï¼šåœ¨è¯·æ±‚è½¬å‘åˆ°ä¸Šæ¸¸æœåŠ¡å‰ï¼Œé¡ºåºæ‰§è¡Œè¯¥ Location ç»‘å®šçš„è¯·æ±‚æ’ä»¶ï¼ˆä¾‹å¦‚ï¼šè®¤è¯ã€é™æµã€è¯·æ±‚å¤´ä¿®æ”¹ï¼‰ã€‚
4ã€è½¬å‘è‡³ä¸Šæ¸¸ï¼šæ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå°†è¯·æ±‚è½¬å‘ç»™ä¸€ä¸ªå¥åº·çš„ Upstream åŽç«¯æœåŠ¡ã€‚
5ã€å“åº”å¤„ç†ï¼ˆæ’ä»¶ï¼‰ï¼šæŽ¥æ”¶åˆ°ä¸Šæ¸¸æœåŠ¡çš„å“åº”åŽï¼Œé¡ºåºæ‰§è¡Œå“åº”æ’ä»¶ï¼ˆä¾‹å¦‚ï¼šåŽ‹ç¼©ã€ç¼“å­˜ã€ä¿®æ”¹å“åº”å¤´ï¼‰ã€‚
6ã€è¿”å›žå®¢æˆ·ç«¯ï¼šå°†æœ€ç»ˆå¤„ç†è¿‡çš„å“åº”è¿”å›žç»™å®¢æˆ·ç«¯ã€‚
7ã€è®°å½•æ—¥å¿—ï¼šæ ¹æ®é…ç½®çš„æ ¼å¼ï¼Œè®°å½•è®¿é—®æ—¥å¿—ã€‚


ä»¥ä¸‹æ˜¯è¯¥æµç¨‹çš„å¯è§†åŒ–å›¾è§£ï¼š

```mermaid
graph TD;
    server["HTTPæœåŠ¡"];
    locationA["Location A"];
    locationB["Location B"];
    locationPluginListA["è½¬å‘æ’ä»¶åˆ—è¡¨A"];
    locationPluginListB["è½¬å‘æ’ä»¶åˆ—è¡¨B"];
    upstreamA1["ä¸Šæ¸¸æœåŠ¡A1"];
    upstreamA2["ä¸Šæ¸¸æœåŠ¡A2"];
    upstreamB1["ä¸Šæ¸¸æœåŠ¡B1"];
    upstreamB2["ä¸Šæ¸¸æœåŠ¡B2"];
    locationResponsePluginListA["å“åº”æ’ä»¶åˆ—è¡¨A"];
    locationResponsePluginListB["å“åº”æ’ä»¶åˆ—è¡¨B"];

    start("æ–°çš„è¯·æ±‚") --> server

    server -- "host:HostA, Path:/api/*" --> locationA

    server -- "Path:/rest/*"--> locationB

    locationA -- "é¡ºåºæ‰§è¡Œè½¬å‘æ’ä»¶" --> locationPluginListA

    locationB -- "é¡ºåºæ‰§è¡Œè½¬å‘æ’ä»¶" --> locationPluginListB

    locationPluginListA -- "è½¬å‘è‡³: 10.0.0.1:8001" --> upstreamA1

    locationPluginListA -- "è½¬å‘è‡³: 10.0.0.2:8001" --> upstreamA2

    locationPluginListA -- "å¤„ç†å®Œæˆ" --> response

    locationPluginListB -- "è½¬å‘è‡³: 10.0.0.1:8002" --> upstreamB1

    locationPluginListB -- "è½¬å‘è‡³: 10.0.0.2:8002" --> upstreamB2

    locationPluginListB -- "å¤„ç†å®Œæˆ" --> response

    upstreamA1 -- "é¡ºåºæ‰§è¡Œå“åº”æ’ä»¶" --> locationResponsePluginListA
    upstreamA2 -- "é¡ºåºæ‰§è¡Œå“åº”æ’ä»¶" --> locationResponsePluginListA

    upstreamB1 -- "é¡ºåºæ‰§è¡Œå“åº”æ’ä»¶" --> locationResponsePluginListB
    upstreamB2 -- "é¡ºåºæ‰§è¡Œå“åº”æ’ä»¶" --> locationResponsePluginListB

    locationResponsePluginListA --> response
    locationResponsePluginListB --> response

    response["HTTPå“åº”"] --> stop("æ—¥å¿—è®°å½•");
```
