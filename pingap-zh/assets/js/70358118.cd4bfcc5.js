"use strict";(self.webpackChunkpingap=self.webpackChunkpingap||[]).push([[3196],{6258:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>t,default:()=>a,frontMatter:()=>l,metadata:()=>d,toc:()=>o});var s=i(4848),c=i(8453);const l={sidebar_position:41},t="Location\u8bf4\u660e",d={id:"location",title:"Location\u8bf4\u660e",description:"Location\u4e3b\u8981\u914d\u7f6e\u8bf7\u6c42\u7684\u5339\u914d\u89c4\u5219\u3001\u8bf7\u6c42\u5934\u54cd\u5e94\u5934\u7684\u63d2\u5165\uff0c\u4ee5\u53ca\u5404\u79cd\u63d2\u4ef6\u7684\u5173\u8054\uff0c\u662f\u6574\u4e2a\u6d41\u7a0b\u4e2d\u7684\u5173\u8054\u7ec4\u6210\u90e8\u5206\u3002\u4e0b\u9762\u662f\u76f8\u5173\u53c2\u6570\u7684\u8be6\u7ec6\u8bf4\u660e\uff1a",source:"@site/docs/location.md",sourceDirName:".",slug:"/location",permalink:"/pingap-zh/docs/location",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/location.md",tags:[],version:"current",sidebarPosition:41,frontMatter:{sidebar_position:41},sidebar:"tutorialSidebar",previous:{title:"\u914d\u7f6e\u8bf4\u660e",permalink:"/pingap-zh/docs/config"},next:{title:"Upsteam\u8bf4\u660e",permalink:"/pingap-zh/docs/upstream"}},r={},o=[{value:"\u6dfb\u52a0\u8bf7\u6c42\u5934",id:"\u6dfb\u52a0\u8bf7\u6c42\u5934",level:3},{value:"\u91cd\u5199\u8bf7\u6c42\u8def\u5f84",id:"\u91cd\u5199\u8bf7\u6c42\u8def\u5f84",level:3},{value:"\u63d2\u4ef6",id:"\u63d2\u4ef6",level:3}];function h(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"location\u8bf4\u660e",children:"Location\u8bf4\u660e"})}),"\n",(0,s.jsx)(n.p,{children:"Location\u4e3b\u8981\u914d\u7f6e\u8bf7\u6c42\u7684\u5339\u914d\u89c4\u5219\u3001\u8bf7\u6c42\u5934\u54cd\u5e94\u5934\u7684\u63d2\u5165\uff0c\u4ee5\u53ca\u5404\u79cd\u63d2\u4ef6\u7684\u5173\u8054\uff0c\u662f\u6574\u4e2a\u6d41\u7a0b\u4e2d\u7684\u5173\u8054\u7ec4\u6210\u90e8\u5206\u3002\u4e0b\u9762\u662f\u76f8\u5173\u53c2\u6570\u7684\u8be6\u7ec6\u8bf4\u660e\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"upstream"}),": \u914d\u7f6e\u8be5location\u5bf9\u5e94\u7684upstream\uff0c\u82e5\u8be5location\u6240\u6709\u7684\u5904\u7406\u5747\u7531\u63d2\u4ef6\u5b8c\u6210\uff0c\u5219\u53ef\u4e0d\u914d\u7f6e\u3002\u5982\u9488\u5bf9http\u91cd\u5b9a\u5411\u81f3https\u7684\u903b\u8f91\uff0c\u5219\u53ea\u9700\u8981\u6dfb\u52a0\u4e2d\u95f4\u4ef6\u5373\u53ef"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"path"}),": \u5339\u914d\u7684\u8def\u5f84\uff0c\u5177\u4f53\u4f7f\u7528\u65b9\u6cd5\u540e\u7eed\u5185\u5bb9\u7ec6\u8bf4"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"host"}),": \u5339\u914d\u7684\u57df\u540d\uff0c\u5982\u679c\u662f\u591a\u4e2a\u57df\u540d\u5219\u4f7f\u7528",(0,s.jsx)(n.code,{children:","}),"\u5206\u9694"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"proxy_set_headers"}),": \u8f6c\u53d1\u81f3upstream\u65f6\u8bbe\u7f6e\u7684\u8bf7\u6c42\u5934\uff0c\u82e5\u8be5\u8bf7\u6c42\u5934\u5df2\u5b58\u5728\u5219\u8986\u76d6"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"proxy_add_headers"}),": \u8f6c\u53d1\u81f3upstream\u65f6\u6dfb\u52a0\u7684\u8bf7\u6c42\u5934"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"rewrite"}),": \u8bf7\u6c42\u8def\u5f84\u7684\u91cd\u5199\u89c4\u5219"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"weight"}),": \u81ea\u5b9a\u4e49\u7684\u6743\u91cd\uff0c\u53ef\u4ee5\u8c03\u6574\u8be5location\u7684\u6743\u91cd\uff0c\u4f8b\u5982mock\u4e3a\u670d\u52a1\u4e0d\u53ef\u7528\u540e\uff0c\u518d\u8c03\u6574\u8be5\u6743\u91cd\u6700\u9ad8\uff0c\u5219\u53ef\u7981\u7528\u6240\u6709\u8bf7\u6c42\u3002\u5982\u975e\u7279\u522b\u5219\u4e0d\u9700\u8981\u8bbe\u7f6e\uff0c\u6743\u91cd\u4f1a\u81ea\u52a8\u8ba1\u7b97"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"plugins"}),": \u6dfb\u52a0\u81f3\u8be5location\u7684\u63d2\u4ef6\u5217\u8868\uff0c\u6309\u987a\u5e8f\u6267\u884c"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"client_max_body_size"}),": \u5ba2\u6237\u7aef\u8bf7\u6c42\u7684body\u6700\u5927\u957f\u5ea6"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Location\u652f\u6301\u914d\u7f6e\u5bf9\u5e94host(\u652f\u6301\u591a\u4e2a\uff09\u4e0epath\u89c4\u5219\uff0cpath\u652f\u6301\u4ee5\u4e0b\u7684\u89c4\u5219\uff0c\u6743\u91cd\u7531\u9ad8\u81f3\u4f4e\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5168\u7b49\u6a21\u5f0f\uff0c\u914d\u7f6e\u4ee5",(0,s.jsx)(n.code,{children:"="}),"\u5f00\u59cb\uff0c\u5982",(0,s.jsx)(n.code,{children:"=/api"}),"\u8868\u793a\u5339\u914dpath\u7b49\u4e8e",(0,s.jsx)(n.code,{children:"/api"}),"\u7684\u8bf7\u6c42"]}),"\n",(0,s.jsxs)(n.li,{children:["\u6b63\u5219\u6a21\u5f0f\uff0c\u914d\u7f6e\u4ee5",(0,s.jsx)(n.code,{children:"~"}),"\u5f00\u59cb\uff0c\u5982",(0,s.jsx)(n.code,{children:"~^/(api|rest)"}),"\u8868\u793a\u5339\u914dpath\u4ee5",(0,s.jsx)(n.code,{children:"/api"}),"\u6216",(0,s.jsx)(n.code,{children:"/rest"}),"\u5f00\u59cb\u8bf7\u6c42"]}),"\n",(0,s.jsxs)(n.li,{children:["\u524d\u7f00\u6a21\u5f0f\uff0c\u5982",(0,s.jsx)(n.code,{children:"/api"}),"\u8868\u793a\u5339\u914dpath\u4e3a",(0,s.jsx)(n.code,{children:"/api"}),"\u5f00\u59cb\u7684\u8bf7\u6c42"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u5728server\u4e2d\u4f1a\u6839\u636e\u6240\u6dfb\u52a0\u7684\u6240\u6709location\u5217\u8868\uff0c\u8ba1\u7b97\u5bf9\u5e94\u7684\u6743\u91cd\u91cd\u65b0\u6392\u5e8f\uff0c\u4e5f\u53ef\u81ea\u5b9a\u4e49\u6743\u91cd\uff0clocation\u7684\u8ba1\u7b97\u6743\u9650\u903b\u8f91\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"pub fn get_weight(&self) -> u16 {\n    if let Some(weight) = self.weight {\n        return weight;\n    }\n    // path starts with\n    // = 1024\n    // prefix(default) 512\n    // ~ 256\n    // host exist 128\n    let mut weight: u16 = 0;\n    let path = self.path.clone().unwrap_or(\"\".to_string());\n    if path.len() > 1 {\n        if path.starts_with('=') {\n            weight += 1024;\n        } else if path.starts_with('~') {\n            weight += 256;\n        } else {\n            weight += 512;\n        }\n        weight += path.len().min(64) as u16;\n    };\n    if self.host.is_some() {\n        weight += 128;\n    }\n    weight\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u4e00\u822c\u800c\u8a00\uff0c\u6743\u91cd\u5747\u65e0\u9700\u81ea\u5b9a\u4e49\uff0c\u7531\u89c4\u5219\u8ba1\u7b97\u5373\u53ef\u3002\u6709\u65f6\u53ef\u5b9a\u4e49\u4e00\u4e2a\u7528\u4e8e\u7981\u7528\u670d\u52a1\u7684location\uff0c\u5176\u5339\u914d\u89c4\u5219\u4e3a\u65e0",(0,s.jsx)(n.code,{children:"host"}),"\u4e0e",(0,s.jsx)(n.code,{children:"path"}),"\u9650\u5236\u5e76\u6307\u5b9a\u6700\u9ad8\u7684\u6743\u91cd",(0,s.jsx)(n.code,{children:"2048"}),"\uff0c\u5728\u5e73\u65f6\u5e76\u4e0d\u6dfb\u52a0\u6b64location\uff0c\u4ec5\u5728\u6709\u65f6\u9700\u8981\u7981\u7528\u8be5Server\u4e0b\u6240\u6709\u8bf7\u6c42\u65f6\u6dfb\u52a0\u4f7f\u7528\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u6dfb\u52a0\u8bf7\u6c42\u5934",children:"\u6dfb\u52a0\u8bf7\u6c42\u5934"}),"\n",(0,s.jsxs)(n.p,{children:["\u53ef\u6309\u9700\u914d\u7f6e\u8be5location\u5bf9\u5e94\u7684\u8bf7\u6c42\u5934\uff0c\u4e24\u4e2a\u914d\u7f6e\u7684\u65b9\u5f0f\u5747\u6bd4\u8f83\u7b80\u5355\u4e00\u79cd\u662f\u76f4\u63a5\u6dfb\u52a0\uff0c\u4e00\u79cd\u662f\u8bbe\u7f6e\uff08\u82e5\u5df2\u5b58\u5728\u5219\u8986\u76d6\uff09\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6709\u4e9b",(0,s.jsx)(n.code,{children:"upstream"}),"\u662f\u9700\u8981\u5339\u914d\u5bf9\u5e94\u7684",(0,s.jsx)(n.code,{children:"Host"}),"\u7684\uff0c\u6709\u6b64\u8981\u6c42\u7684\u5219\u9700\u8981\u5728\u8bf7\u6c42\u5934\u4e2d\u8bbe\u7f6e\u5bf9\u5e94\u7684\u914d\u7f6e",(0,s.jsx)(n.code,{children:"Host:xxx"}),"(\u4f7f\u7528\u8bbe\u7f6e\u800c\u975e\u6dfb\u52a0)\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u91cd\u5199\u8bf7\u6c42\u8def\u5f84",children:"\u91cd\u5199\u8bf7\u6c42\u8def\u5f84"}),"\n",(0,s.jsx)(n.p,{children:"\u53ef\u6309\u9700\u914d\u7f6e\u8bf7\u6c42\u8def\u5f84\u91cd\u5199\u89c4\u5219\uff0c\u652f\u6301\u6b63\u5219\u5339\u914d\u5904\u7406(\u4e0enginx\u7c7b\u4f3c)\uff0c\u4ec5\u652f\u6301\u914d\u7f6e\u4e00\u4e2a\u91cd\u5199\u89c4\u5219\uff0c\u82e5\u903b\u8f91\u8fc7\u4e8e\u590d\u6742\u5efa\u8bae\u53ef\u914d\u7f6e\u591a\u4e2alocation\u6765\u5206\u5f00\u5b9e\u73b0\u3002\u914d\u7f6e\u901a\u8fc7\u7a7a\u683c\u5206\u9694\u4e3a\u524d\u540e\u4e24\u90e8\u5206\uff0c\u5904\u7406\u903b\u8f91\u5219\u662f\u6309\u6b63\u5219\u5339\u914d\u5c06\u524d\u90e8\u5206\u66ff\u6362\u4e3a\u540e\u90e8\u5206\uff0c\u4e0b\u9762\u662f\u5e38\u7528\u7684\u4e00\u4e9b\u4f8b\u5982\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"^/api/ /"}),": \u8868\u793a\u5c06\u8bf7\u6c42\u524d\u7f00\u7684",(0,s.jsx)(n.code,{children:"/api/"}),"\u66ff\u6362\u4e3a",(0,s.jsx)(n.code,{children:"/"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"^/(\\S*?)/ /api/$1/"}),": \u8868\u793a\u5728\u8bf7\u6c42\u8def\u5f84\u6dfb\u52a0\u524d\u7f00",(0,s.jsx)(n.code,{children:"/api"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"^/(\\S*?)/api/(\\S*?) /$1/$2"}),": \u8868\u793a\u5c06\u8bf7\u6c42\u8def\u5f84\u4e2d\u7684",(0,s.jsx)(n.code,{children:"/api"}),"\u90e8\u5206\u5220\u9664"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u63d2\u4ef6",children:"\u63d2\u4ef6"}),"\n",(0,s.jsxs)(n.p,{children:["Location\u53ef\u6839\u636e\u9700\u8981\u6dfb\u52a0\u5bf9\u5e94\u7684\u63d2\u4ef6\uff0c\u9700\u8981\u6ce8\u610f\u63d2\u4ef6\u662f\u6309\u987a\u5e8f\u6267\u884c\u7684\uff0c\u56e0\u6b64\u8981\u914d\u7f6e\u65f6\u8981\u4fdd\u8bc1\u5176\u987a\u5e8f(\u82e5\u5728web\u4e0a\u914d\u7f6e\u5219\u52fe\u9009\u540e\u8c03\u6574\u987a\u5e8f\u5373\u53ef)\uff0c\u901a\u8fc7\u63d2\u4ef6\u53ef\u652f\u6301\u5404\u79cd\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\uff0c\u5177\u4f53\u67e5\u770b",(0,s.jsx)(n.a,{href:"./plugin",children:"\u7ec6\u8bf4\u63d2\u4ef6\u4f53\u7cfb"}),"\u3002"]})]})}function a(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);