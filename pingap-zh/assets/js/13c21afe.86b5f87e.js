"use strict";(self.webpackChunkpingap=self.webpackChunkpingap||[]).push([[2757],{5374:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>o,frontMatter:()=>d,metadata:()=>r,toc:()=>h});var i=s(4848),c=s(8453);const d={sidebar_position:71},l="\u63d2\u4ef6\u4f53\u7cfb",r={id:"plugin",title:"\u63d2\u4ef6\u4f53\u7cfb",description:"Pingap\u4e2d\u901a\u8fc7Locaton\u6dfb\u52a0\u5404\u79cd\u63d2\u4ef6\u652f\u6301\u66f4\u591a\u7684\u5e94\u7528\u573a\u666f\uff0c\u5982\u9274\u6743\u3001\u6d41\u63a7\u3001\u8bbe\u7f6e\u54cd\u5e94\u5934\u7b49\u573a\u666f\u3002",source:"@site/docs/plugin.md",sourceDirName:".",slug:"/plugin",permalink:"/pingap-zh/docs/plugin",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/plugin.md",tags:[],version:"current",sidebarPosition:71,frontMatter:{sidebar_position:71},sidebar:"tutorialSidebar",previous:{title:"https\u8bc1\u4e66\u7ba1\u7406",permalink:"/pingap-zh/docs/certificate"},next:{title:"Docker",permalink:"/pingap-zh/docs/docker"}},t={},h=[{value:"\u63d2\u4ef6\u6267\u884c\u65f6\u70b9",id:"\u63d2\u4ef6\u6267\u884c\u65f6\u70b9",level:2},{value:"Stats",id:"stats",level:2},{value:"Ping",id:"ping",level:2},{value:"Admin",id:"admin",level:2},{value:"Directory",id:"directory",level:2},{value:"Mock",id:"mock",level:2},{value:"Redirect",id:"redirect",level:2},{value:"Cache",id:"cache",level:2},{value:"RequestId",id:"requestid",level:2},{value:"Compression",id:"compression",level:2},{value:"AcceptEncoding",id:"acceptencoding",level:2},{value:"KeyAuth",id:"keyauth",level:2},{value:"BasicAuth",id:"basicauth",level:2},{value:"Jwt",id:"jwt",level:2},{value:"CombinedAuth",id:"combinedauth",level:2},{value:"Limit",id:"limit",level:2},{value:"IpRestriction",id:"iprestriction",level:2},{value:"RefererRestriction",id:"refererrestriction",level:2},{value:"Csrf",id:"csrf",level:2},{value:"Cors",id:"cors",level:2},{value:"ResponseHeaders",id:"responseheaders",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u63d2\u4ef6\u4f53\u7cfb",children:"\u63d2\u4ef6\u4f53\u7cfb"})}),"\n",(0,i.jsx)(n.p,{children:"Pingap\u4e2d\u901a\u8fc7Locaton\u6dfb\u52a0\u5404\u79cd\u63d2\u4ef6\u652f\u6301\u66f4\u591a\u7684\u5e94\u7528\u573a\u666f\uff0c\u5982\u9274\u6743\u3001\u6d41\u63a7\u3001\u8bbe\u7f6e\u54cd\u5e94\u5934\u7b49\u573a\u666f\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u63d2\u4ef6\u6267\u884c\u65f6\u70b9",children:"\u63d2\u4ef6\u6267\u884c\u65f6\u70b9"}),"\n",(0,i.jsx)(n.p,{children:"\u73b0\u652f\u6301\u5c06\u63d2\u4ef6\u6dfb\u52a0\u5230\u4ee5\u4e0b\u5404\u9636\u6bb5\u65f6\u70b9\u4e2d\u6267\u884c\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Request"}),": \u8bf7\u6c42\u7684\u6700\u5f00\u59cb\u9636\u6bb5\uff0c\u9002\u7528\u4e8e\u9488\u5bf9\u4e00\u4e9b\u6743\u9650\u7c7b\u7684\u62e6\u622a\u7b49\u5904\u7406"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ProxyUpstream"}),": \u8bf7\u6c42\u8f6c\u53d1\u81f3\u4e0a\u6d41\u8282\u70b9\u4e4b\u524d\uff0c\u56e0\u4e3a\u6b64\u6d41\u7a0b\u662f\u5728\u8bfb\u53d6\u7f13\u5b58\u4e4b\u540e\uff0c\u56e0\u6b64\u82e5\u4e0d\u5e0c\u671b\u9488\u5bf9\u7f13\u5b58\u524d\u9650\u5236\uff0c\u4f46\u8f6c\u53d1\u81f3\u4e0a\u6e38\u524d\u9650\u5236\u7684\u53ef\u914d\u7f6e\u4e3a\u6b64\u9636\u6bb5\u3002\u5982\u9650\u5236IP\u8bbf\u95ee\u9891\u7e41\uff0c\u4f46\u5141\u8bb8\u9ad8\u5e76\u53d1\u8bfb\u53d6\u7f13\u5b58\u6570\u636e\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Response"}),": \u4e0a\u6e38\u6570\u636e\u54cd\u5e94\u4e4b\u540e\uff0c\u7528\u4e8e\u9488\u5bf9\u4e0a\u6e38\u54cd\u5e94\u6570\u636e\u505a\u8c03\u6574\u65f6\u4f7f\u7528\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"#[async_trait]\npub trait Plugin: Sync + Send {\n    fn category(&self) -> PluginCategory;\n    fn step(&self) -> String;\n    async fn handle_request(\n        &self,\n        _step: PluginStep,\n        _session: &mut Session,\n        _ctx: &mut State,\n    ) -> pingora::Result<Option<HttpResponse>> {\n        Ok(None)\n    }\n    async fn handle_response(\n        &self,\n        _step: PluginStep,\n        _session: &mut Session,\n        _ctx: &mut State,\n        _upstream_response: &mut ResponseHeader,\n    ) -> pingora::Result<Option<Bytes>> {\n        Ok(None)\n    }\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u4e3b\u8981\u5206\u4e09\u4e2a\u5b9e\u73b0\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"category"}),": \u63d2\u4ef6\u7c7b\u578b\uff0c\u7528\u4e8e\u533a\u5206\u8be5\u63d2\u4ef6\u662f\u54ea\u7c7b\u5f62\u5f0f\u7684\u63d2\u4ef6"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"step"}),": \u63d2\u4ef6\u7684\u6267\u884c\u9636\u6bb5\uff0c\u73b0\u53ea\u652f\u6301\u5728",(0,i.jsx)(n.code,{children:"request_filter"}),"\u4e0e",(0,i.jsx)(n.code,{children:"proxy_upstream_filter"}),"\u9636\u6bb5\u6267\u884c"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"handle_request"}),": \u63d2\u4ef6\u7684\u8f6c\u53d1\u524d\u6267\u884c\u903b\u8f91\uff0c\u82e5\u8fd4\u56de\u7684\u662f",(0,i.jsx)(n.code,{children:"Ok(Some(HttpResponse))"}),"\uff0c\u5219\u8868\u793a\u8bf7\u6c42\u5df2\u5904\u7406\u5b8c\u6210\uff0c\u4e0d\u518d\u8f6c\u53d1\u5230\u4e0a\u6e38\u8282\u70b9\uff0c\u5e76\u5c06\u8be5\u54cd\u5e94\u4f20\u8f93\u81f3\u8bf7\u6c42\u7aef"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"handle_response"}),": \u63d2\u4ef6\u7684\u54cd\u5e94\u524d\u6267\u903b\u8f91\uff0c\u82e5\u8fd4\u56de\u7684\u662f",(0,i.jsx)(n.code,{children:"Ok(Some(Bytes))"}),"\uff0c\u5219\u8868\u793a\u8981\u91cd\u5199\u54cd\u5e94\u6570\u636e"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"stats",children:"Stats"}),"\n",(0,i.jsxs)(n.p,{children:["\u83b7\u53d6\u5e94\u7528\u6027\u80fd\u6307\u6807\u7b49\u7edf\u8ba1\u6027\u80fd\uff0c\u914d\u7f6e\u662f\u6307\u5b9a\u5bf9\u5e94\u7684\u8bbf\u95ee\u8def\u5f84\u5373\u53ef\uff0c\u4e5f\u53ef\u76f4\u63a5\u4f7f\u7528\u81ea\u5e26\u7684",(0,i.jsx)(n.code,{children:"pingap:stats"}),"\u3002\u5982\u914d\u7f6e\u4e3a",(0,i.jsx)(n.code,{children:"/stats"}),"\u540e\uff0c\u8bbf\u95ee\u8be5location\u7684",(0,i.jsx)(n.code,{children:"/stats"}),"\u76ee\u5f55\u5373\u53ef\u83b7\u53d6\u5230\u5e94\u7528\u7684\u7edf\u8ba1\u6307\u6807\u3002\u5177\u4f53\u914d\u7f6e\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.stats]\ncategory = "stats"\npath = "/stats"\nremark = "\u7528\u4e8e\u83b7\u53d6\u6027\u80fd\u6307\u6807"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"path"}),": \u54cd\u5e94\u6027\u80fd\u6307\u6807\u7684\u8def\u5f84"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u754c\u9762\u914d\u7f6e\u5982\u56fe\u6240\u793a\uff0c\u4e3b\u8981\u662f\u914d\u7f6e\u5176\u5bf9\u5e94\u7684\u8bf7\u6c42\u8def\u5f84\u5373\u53ef\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Stats",src:s(1793).A+"",width:"1984",height:"1266"})}),"\n",(0,i.jsx)(n.h2,{id:"ping",children:"Ping"}),"\n",(0,i.jsx)(n.p,{children:"Ping->pong\u7684\u54cd\u5e94\u5904\u7406\uff0c\u53ef\u7528\u4e8e\u5224\u65ad\u7a0b\u5e8f\u662f\u5426\u6b63\u5e38\u8fd0\u884c\u7b49\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.pingpong]\ncategory = "ping"\npath = "/ping"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"path"}),": \u54cd\u5e94pong\u7684\u8def\u5f84"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"admin",children:"Admin"}),"\n",(0,i.jsxs)(n.p,{children:["\u7ba1\u7406\u540e\u53f0\u914d\u7f6e\uff0c\u53ef\u5728\u73b0\u5728\u7684\u73b0\u6709\u7684location\u4e2d\u6dfb\u52a0\u652f\u6301\u7ba1\u7406\u540e\u53f0\u670d\u52a1\uff0c",(0,i.jsx)(n.code,{children:"YWRtaW46MTIzMTIz"}),"\u4e3a",(0,i.jsx)(n.code,{children:"base64(admin:123123)"}),"\uff0c\u5c06\u8be5\u914d\u7f6e\u5173\u8054\u81f3\u5bf9\u5e94location\u540e\uff0c\u5373\u53ef\u4f7f\u7528\u8be5location\u7684/pingap/\u8bbf\u95ee\u7ba1\u7406\u540e\u53f0\uff0c\u8d26\u53f7\u4e3a",(0,i.jsx)(n.code,{children:"admin"}),"\uff0c\u5bc6\u7801\u4e3a",(0,i.jsx)(n.code,{children:"123123"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.admin]\nauthorizations = ["YWRtaW46MTIzMTIz"]\ncategory = "admin"\nip_fail_limit = 10\npath = "/pingap"\nremark = "\u7ba1\u7406\u540e\u53f0"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"authorizations"}),": Basic\u8ba4\u8bc1\u7684\u5bc6\u94a5\u5217\u8868"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ip_fail_limit"}),": \u8ba4\u8bc1\u5931\u8d25\u65f6\u7684IP\u9650\u5236\u6b21\u6570"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"path"}),": \u7ba1\u7406\u540e\u53f0\u7684\u8def\u5f84"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Admin",src:s(6549).A+"",width:"1976",height:"1414"})}),"\n",(0,i.jsx)(n.h2,{id:"directory",children:"Directory"}),"\n",(0,i.jsx)(n.p,{children:"\u9759\u6001\u6587\u4ef6\u76ee\u5f55\u670d\u52a1\uff0c\u4e3a\u6307\u5b9a\u76ee\u5f55\u63d0\u4f9b\u9759\u6001\u6587\u4ef6\u670d\u52a1\uff0c\u8bf4\u660e\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.downloadsServe]\ncategory = "directory"\ncharset = "utf-8"\nchunk_size = "4kb"\nindex = "index.html"\nmax_age = "1h"\npath = "~/Downloads"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"path"}),": \u9759\u6001\u6587\u4ef6\u76ee\u5f55\u8def\u5f84"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"chunk_size"}),": Http chunk\u7684\u5927\u5c0f\uff0c\u9ed8\u8ba4\u4e3a",(0,i.jsx)(n.code,{children:"8192"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"max_age"}),": \u8bbe\u7f6ehttp\u54cd\u5e94\u7684\u7684\u7f13\u5b58\u65f6\u95f4\uff0c\u9ed8\u8ba4\u65e0\u3002\u6b64\u503c\u5bf9\u4e8e",(0,i.jsx)(n.code,{children:"text/html"}),"\u65e0\u6548\uff0chtml\u5747\u8bbe\u7f6e\u4e3a\u4e0d\u53ef\u7f13\u5b58\u3002\u5982\u8bbe\u7f6e\u4e3a",(0,i.jsx)(n.code,{children:"1h"}),"\u8868\u793a\u7f13\u5b58\u6709\u6548\u671f1\u5c0f\u65f6"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"private"}),": \u7f13\u5b58\u662f\u5426\u8bbe\u7f6e\u4e3a",(0,i.jsx)(n.code,{children:"private"}),"\uff0c\u9ed8\u8ba4\u4e3a",(0,i.jsx)(n.code,{children:"public"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"index"}),": \u8bbe\u7f6e\u9ed8\u8ba4\u7684index\u6587\u4ef6\uff0c\u9ed8\u8ba4\u4e3a",(0,i.jsx)(n.code,{children:"index.html"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"charset"}),": \u6307\u5b9acharset\u7c7b\u578b\uff0c\u9ed8\u8ba4\u65e0"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"autoindex"}),": \u662f\u5426\u5141\u8bb8\u76ee\u5f55\u4ee5\u6d4f\u89c8\u5f62\u5f0f\u5c55\u793a\uff0c\u9700\u8981\u6ce8\u610f\u82e5\u6307\u5b9a\u4e86\u76ee\u5f55\u5141\u8bb8\u6d4f\u89c8\uff0c\u5219",(0,i.jsx)(n.code,{children:"index"}),"\u53c2\u6570\u65e0\u6548"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"download"}),": \u662f\u5426\u652f\u6301\u4e0b\u8f7d\uff0c\u6307\u5b9a\u8be5\u53c2\u6570\u540e\u54cd\u5e94\u65f6\u4f1a\u8bbe\u7f6e\u54cd\u5e94\u5934",(0,i.jsx)(n.code,{children:"Content-Disposition"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"headers"}),": \u9700\u8981\u6dfb\u52a0\u7684http\u54cd\u5e94\u5934\u5217\u8868"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u754c\u9762\u914d\u7f6e\u5982\u56fe\u6240\u793a\uff0c\u914d\u7f6e\u5bf9\u5e94\u7684\u9759\u6001\u6587\u4ef6\u76ee\u5f55\uff0c\u5e76\u6309\u9700\u8981\u6dfb\u52a0\u5bf9\u5e94\u7684query\u53c2\u6570\u5373\u53ef\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Directory",src:s(9421).A+"",width:"1980",height:"1404"})}),"\n",(0,i.jsx)(n.h2,{id:"mock",children:"Mock"}),"\n",(0,i.jsx)(n.p,{children:"\u7528\u4e8e\u5bf9\u7279\u5b9a\u8def\u5f84(\u82e5\u4e0d\u8bbe\u7f6e\u5219\u6240\u6709)mock\u54cd\u5e94\uff0c\u7528\u4e8e\u6d4b\u8bd5\u6216\u6682\u505c\u670d\u52a1\u4f7f\u7528\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.errorMock]\ncategory = "mock"\ndata = \'{"error": "error message"}\'\ndelay = "1s"\nheaders = [\n    "X-Error:CustomRrror",\n    "Content-Type:application/json",\n]\nname = "errorMock"\npath = "/"\nstatus = 500\nstep = "request"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"data"}),": Mock\u7684\u54cd\u5e94\u6570\u636e"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"headers"}),": Mock\u7684\u54cd\u5e94\u5934"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"path"}),": Mock\u8bf7\u6c42\u7684\u8def\u5f84\uff0c\u5982\u679c\u4e0d\u914d\u7f6e\u5219\u5339\u914d\u6240\u6709"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"status"}),": Mock\u54cd\u5e94\u7684\u72b6\u6001\u7801"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"delay"}),": \u5ef6\u65f6\u54cd\u5e94"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u754c\u9762\u914d\u7f6e\u5982\u56fe\u6240\u793a\uff0c\u914d\u7f6e\u5bf9\u5e94\u54cd\u5e94\u6570\u636e\u65e2\u53ef\uff0c\u9700\u8981\u6ce8\u610f\u5982\u679c\u6307\u5b9a\u54cd\u5e94\u7c7b\u578b\uff0c\u5982json\u7b49\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Mock",src:s(2368).A+"",width:"1984",height:"1502"})}),"\n",(0,i.jsx)(n.h2,{id:"redirect",children:"Redirect"}),"\n",(0,i.jsx)(n.p,{children:"http\u91cd\u5b9a\u5411\uff0c\u53ef\u5728\u91cd\u5b9a\u5411\u65f6\u6dfb\u52a0\u524d\u7f00\u6216\u6307\u5b9a\u4e3ahttps\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.http2https]\ncategory = "redirect"\nhttp_to_https = true\nname = "http2https"\nprefix = "/api"\nstep = "request"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"http_to_https"}),": \u662f\u5426\u4ecehttp\u91cd\u5b9a\u5411\u81f3https"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"prefix"}),": \u91cd\u5b9a\u5411\u65f6\u6dfb\u52a0\u7684\u524d\u7f00"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u754c\u9762\u914d\u7f6e\u5982\u56fe\u6240\u793a\uff0c\u82e5\u9700\u8981\u91cd\u5b9a\u5411\u65f6\u6dfb\u52a0\u524d\u7f00\uff0c\u53ef\u914d\u7f6e\u5bf9\u5e94\u7684\u524d\u7f00\uff0c\u82e5\u65e0\u9700\u8981\u8c03\u6574\u5219\u4e0d\u914d\u7f6e\u503c\u5373\u53ef\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Redirect Https",src:s(4846).A+"",width:"1982",height:"908"})}),"\n",(0,i.jsx)(n.h2,{id:"cache",children:"Cache"}),"\n",(0,i.jsx)(n.p,{children:"\u7f13\u5b58\u4e2d\u95f4\u4ef6\uff0c\u7528\u4e8e\u7f13\u5b58http\u8bf7\u6c42\uff0c\u7531\u4e8e\u7f13\u5b58\u6a21\u5757\u662f\u5168\u5c40\u4f7f\u7528\uff0c\u56e0\u6b64\u5982\u679c\u4e0d\u540c\u7684Location\u5747\u4f7f\u7528\u7f13\u5b58\uff0c\u5219\u9700\u8981\u8bbe\u7f6e\u4e0d\u540c\u7684namespace\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.chartsCache]\ncategory = "cache"\neviction = true\nheaders = ["Accept-Encoding"]\nlock = "3s"\nmax_file_size = "100kb"\nmax_ttl = "1h"\nnamespace = "charts"\npredictor = true\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"lock"}),": \u7f13\u5b58\u4e0d\u5b58\u5728\u65f6\uff0c\u76f8\u540c\u8bf7\u6c42\u7684\u7b49\u5f85\u65f6\u957f"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"max_file_size"}),": \u5355\u4e2a\u7f13\u5b58\u6587\u4ef6\u7684\u6700\u5927\u957f\u5ea6\uff0c\u5efa\u8bae\u8bbe\u7f6e\u5408\u7406\u7684\u503c\uff0c\u907f\u514d\u8fc7\u5927\u7684\u54cd\u5e94\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\u5bfc\u81f4\u5185\u5b58\u5360\u7528\u8fc7\u9ad8"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"namespace"}),": \u7531\u4e8e\u7f13\u5b58\u662f\u5e94\u7528\u5171\u4eab\uff0c\u800c\u7f13\u5b58\u7684key\u662f\u57fa\u4e8epath+querystring\uff0c\u56e0\u6b64\u5982\u679c\u662f\u591a\u57df\u540d\u5171\u4eab\u65f6\uff0c\u4e0d\u540c\u7684\u57df\u540d\u4f7f\u7528\u4e0d\u540c\u7684\u7f13\u5b58\u4e2d\u95f4\u4ef6\uff0c\u5e76\u8bbe\u7f6e\u5bf9\u5e94\u7684namespace"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"max_ttl"}),": \u8bbe\u7f6e\u7f13\u5b58\u7684\u6700\u957f\u6709\u6548\u671f\uff0c\u4e00\u822c\u5efa\u8bae\u7531upstream\u670d\u52a1\u54cd\u5e94\u65f6\uff0c\u82e5",(0,i.jsx)(n.code,{children:"Cache-Control"}),"\u7684",(0,i.jsx)(n.code,{children:"max-age"}),"\u8f83\u957f\uff0c\u5219\u8bbe\u7f6e\u8f83\u77ed\u7684",(0,i.jsx)(n.code,{children:"s-maxage"}),"\uff0c\u82e5",(0,i.jsx)(n.code,{children:"upstream"}),"\u672a\u8bbe\u7f6e",(0,i.jsx)(n.code,{children:"s-maxage"}),"\uff0c\u53ef\u901a\u8fc7\u6b64\u914d\u7f6e\u9650\u5236\u7f13\u5b58\u7684\u6700\u5927\u6709\u6548\u671f"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"eviction"}),": \u5f53\u7f13\u5b58\u8d85\u9650\u65f6\uff0c\u89e6\u53d1\u7f13\u5b58\u6e05\u9664\uff0c\u9700\u8981\u6ce8\u610f\uff0c\u5982tinyufo\u6682\u65f6\u4e0d\u652f\u6301\u4e3b\u52a8\u6e05\u9664"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"predictor"}),": \u662f\u5426\u8bb0\u5f55\u65e0\u6cd5\u7f13\u5b58\u7684\u8bf7\u6c42\uff0c\u53ef\u907f\u514d\u540e\u7eed\u91cd\u590d\u7684\u7b49\u5f85\u786e\u8ba4\u8bf7\u6c42\u662f\u5426\u53ef\u7f13\u5b58"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Cache",src:s(6306).A+"",width:"1976",height:"1188"})}),"\n",(0,i.jsx)(n.h2,{id:"requestid",children:"RequestId"}),"\n",(0,i.jsxs)(n.p,{children:["\u7528\u4e8e\u5728\u8bf7\u6c42\u5934\u4e2d\u6dfb\u52a0",(0,i.jsx)(n.code,{children:"X-Request-Id"}),"(\u4e5f\u53ef\u6307\u5b9a\u5bf9\u5e94\u7684\u8bf7\u6c42\u5934\uff09\uff0c\u82e5\u5df2\u6709\u5219\u5ffd\u7565\uff0c\u53ef\u6307\u5b9a\u4f7f\u7528",(0,i.jsx)(n.code,{children:"uuid"}),"\u6216",(0,i.jsx)(n.code,{children:"nanoid"}),"\u4e24\u79cd\u5f62\u5f0f\uff0c",(0,i.jsx)(n.code,{children:"nanoid"}),"\u53ef\u4ee5\u6307\u5b9a\u957f\u5ea6\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.customReqId]\nalgorithm = "nanoid"\ncategory = "request_id"\nsize = 8\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"algorithm"}),": \u751f\u6210\u8bf7\u6c42id\u7684\u7b97\u6cd5"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"size"}),": \u8bf7\u6c42id\u7684\u957f\u5ea6\uff0c\u53ea\u5bf9\u4e8e",(0,i.jsx)(n.code,{children:"nanoid"}),"\u6709\u6548\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u754c\u9762\u914d\u7f6e\u5982\u56fe\u6240\u793a\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Request Id",src:s(2041).A+"",width:"1974",height:"908"})}),"\n",(0,i.jsx)(n.h2,{id:"compression",children:"Compression"}),"\n",(0,i.jsxs)(n.p,{children:["\u538b\u7f29\u4e2d\u95f4\u4ef6\uff0c\u5904\u7406\u4ece\u4e0a\u6e38\u8fd4\u56de\u7684\u76f8\u5173\u6570\u636e\u538b\u7f29\uff0c\u7531\u4e8e",(0,i.jsx)(n.code,{children:"pingora"}),"\u5bf9\u4e8e\u538b\u7f29\u7684\u5339\u914d\u987a\u5e8f\u4e3a",(0,i.jsx)(n.code,{children:"gzip --\x3e br --\x3e zstd"}),"\uff0c\u5b98\u65b9\u6682\u672a\u652f\u6301\u8c03\u6574\u4f18\u5148\u7ea7\uff0c\u800c\u5bf9\u4e8e\u73b0\u4ee3\u6d4f\u89c8\u5668\uff0c\u57fa\u672c\u90fd\u652f\u6301",(0,i.jsx)(n.code,{children:"gzip"}),"\uff0c\u5927\u90e8\u5206\u652f\u6301",(0,i.jsx)(n.code,{children:"br"}),"\uff0c\u5c11\u90e8\u5206\u652f\u6301",(0,i.jsx)(n.code,{children:"zstd"}),"\uff0c\u4e3a\u4e86\u4f7f\u7528\u66f4\u597d\u7684\u538b\u7f29\u65b9\u5f0f\uff0c\u6b64\u63d2\u4ef6\u4f1a\u8c03\u6574\u8bf7\u6c42\u7684",(0,i.jsx)(n.code,{children:"Accept-Encoding"}),"\uff0c\u8ba9\u538b\u7f29\u7684\u987a\u5e8f\u8c03\u6574\u4e3a",(0,i.jsx)(n.code,{children:"zstd --\x3e br --\x3e gzip"}),"\u3002\u914d\u7f6e\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.commonCompression]\nbr_level = 6\ncategory = "compression"\ngzip_level = 6\nzstd_level = 5\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"br_level"}),": brotli\u538b\u7f29\u7b97\u6cd5\u7684\u538b\u7f29\u7ea7\u522b"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gzip_level"}),": gzip\u538b\u7f29\u7b97\u6cd5\u7684\u538b\u7f29\u7ea7\u522b"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"zstd_level"}),": zstd\u538b\u7f29\u7b97\u6cd5\u7684\u538b\u7f29\u7ea7\u522b"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u9700\u8981\u6ce8\u610f\u4e09\u79cd\u538b\u7f29\u7b97\u6cd5\u7684\u538b\u7f29\u7ea7\u522b\u4e0d\u4e00\u6837\uff0c\u6309\u9700\u9009\u62e9\u5373\u53ef\uff0c\u4e5f\u53ef\u4f7f\u7528\u81ea\u5e26\u7684",(0,i.jsx)(n.code,{children:"pingap:compression"}),"\uff0c\u5b83\u7684\u538b\u7f29\u7ea7\u522b\u914d\u7f6e\u4e3a",(0,i.jsx)(n.code,{children:"gzip_level = 6"}),", ",(0,i.jsx)(n.code,{children:"br_level = 6"}),", ",(0,i.jsx)(n.code,{children:"zstd_level = 3"}),"\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u754c\u9762\u914d\u7f6e\u5982\u56fe\u6240\u793a\uff0c\u6309\u9700\u5206\u522b\u914d\u7f6e\u5bf9\u5e94\u7684\u538b\u7f29\u7ea7\u522b\u5373\u53ef\uff0c\u82e5\u4e0d\u60f3\u542f\u7528\u8be5\u538b\u7f29\u7b97\u6cd5\u5219\u914d\u7f6e\u4e3a0\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Compression",src:s(6198).A+"",width:"1976",height:"896"})}),"\n",(0,i.jsx)(n.h2,{id:"acceptencoding",children:"AcceptEncoding"}),"\n",(0,i.jsx)(n.p,{children:"\u8c03\u6574\u5ba2\u6237\u7aef\u63a5\u53d7\u7f16\u7801\u7684\u65b9\u5f0f\uff0c\u53ef\u8bbe\u7f6e\u652f\u6301\u7684\u7f16\u7801\uff0c\u6839\u636e\u5ba2\u6237\u7aef\u4e0e\u8bbe\u7f6e\u7684\u7f16\u7801\u8c03\u6574\u76f8\u5e94\u7684\u7f16\u7801\u987a\u5e8f\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.acceptEncoding]\ncategory = "accept_encoding"\nencodings = "zstd, br, gzip"\nonly_one_encoding = true\nstep = "request"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"encodings"}),": \u652f\u6301\u7684\u7f16\u7801"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"only_one_encoding"}),": \u662f\u5426\u53ea\u4f7f\u7528\u5355\u4e00\u7f16\u7801"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"keyauth",children:"KeyAuth"}),"\n",(0,i.jsx)(n.p,{children:"KeyAuth\u7528\u4e8e\u63d0\u4f9b\u7b80\u5355\u7684\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u652f\u6301\u914d\u7f6e\u4ecequery\u6216header\u4e2d\u83b7\u53d6\u503c\uff0c\u53ef\u914d\u7f6e\u591a\u4e2a\u6821\u9a8c\u503c\uff0c\u65b9\u4fbf\u591a\u7cfb\u7edf\u63a5\u5165\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u4ecequery\u4e2d\u7684app\u5b57\u6bb5\u4e2d\u83b7\u53d6\u6821\u9a8c\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'category = "key_auth"\ndelay = "1s"\nhide_credentials = true\nkeys = [\n    "KOXQaw",\n    "GKvXY2",\n]\nquery = "app"\nstep = "request"\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u4eceheader\u4e2d\u7684X-App\u5b57\u6bb5\u4e2d\u83b7\u53d6\u6821\u9a8c\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.appAuth]\ncategory = "key_auth"\ndelay = "1s"\nhide_credentials = true\nkeys = [\n    "KOXQaw",\n    "GKvXY2",\n]\nheader = "X-App"\nstep = "request"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hide_credentials"}),": \u8f6c\u53d1\u81f3upstream\u65f6\u662f\u5426\u5220\u9664\u8ba4\u8bc1\u4fe1\u606f"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"query"}),": \u4ecequery\u4e2d\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"header"}),": \u4ece\u8bf7\u6c42\u5934\u4e2d\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f\uff08\u4e0equery\u4e8c\u9009\u4e00,\uff0c\u4f7f\u7528\u4f7f\u7528query)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"keys"}),": \u8ba4\u8bc1\u7684key\u5217\u8868"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u754c\u9762\u914d\u7f6e\u5982\u56fe\u6240\u793a\uff0c\u914d\u7f6ekey\u7684\u540d\u79f0\uff0c\u518d\u914d\u7f6e\u7b26\u5408\u7684\u503c\u5373\u53ef\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Key Auth",src:s(6074).A+"",width:"1978",height:"1344"})}),"\n",(0,i.jsx)(n.h2,{id:"basicauth",children:"BasicAuth"}),"\n",(0,i.jsxs)(n.p,{children:["BasicAuth\u9274\u6743\uff0c\u914d\u7f6e\u65f6\u9700\u8981\u4f7f\u7528\u4fdd\u5b58",(0,i.jsx)(n.code,{children:"base64(user:pass)"}),"\u7684\u503c\uff0c\u82e5\u6709\u591a\u4e2a\u5219\u914d\u7f6e\u591a\u4e2a\u5373\u53ef\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.testBasicAuth]\nauthorizations = [\n    "YWRtaW46dGVzdA==",\n    "YWRtaW46MTIzMTIz",\n]\ncategory = "basic_auth"\ndelay = "1s"\nhide_credentials = true\nstep = "request"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"authorizations"}),": Basic\u8ba4\u8bc1\u7684\u4fe1\u606f\uff0c\u5b83\u4f7f\u7528\u7684\u662fbase64(user",":password",")\u540e\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hide_credentials"}),": \u8f6c\u53d1\u81f3upstream\u65f6\u662f\u5426\u5220\u9664\u8ba4\u8bc1\u4fe1\u606f"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u754c\u9762\u914d\u7f6e\u5982\u56fe\u6240\u793a\uff0c\u914d\u7f6ebasic auth\u7684\u503c\uff0c\u9700\u8981\u6ce8\u610f\u914d\u7f6e\u5df2\u505abase64\u5904\u7406\u540e\u7684\u503c\u5373\u53ef\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Basic Auth",src:s(8091).A+"",width:"1984",height:"1164"})}),"\n",(0,i.jsx)(n.h2,{id:"jwt",children:"Jwt"}),"\n",(0,i.jsx)(n.p,{children:"\u7528\u4e8e\u751f\u6210jwt\u8ba4\u8bc1\u4fe1\u606f\u4ee5\u53ca\u9488\u5bf9\u76f8\u5173\u8bf7\u6c42\u5224\u65adjwt\u76f8\u5173\u4fe1\u606f\u662f\u5426\u7b26\u5408\u3002\u9700\u8981\u6ce8\u610f\u8bf7\u6c42\u8def\u5f84\u7684\u54cd\u5e94\u6570\u636e\u4f1a\u4f7f\u7528jwt\u7684\u5f62\u5f0f\u91cd\u65b0\u7b7e\u540d\u751f\u6210\u5bf9\u5e94\u7684token\u8fd4\u56de\uff0c\u5176\u5b83\u8def\u5f84\u5219\u6821\u9a8c\u5176token\u662f\u5426\u7b26\u5408\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.jwtAuth]\nalgorithm = "HS256"\nauth_path = "/jwt-sign"\ncategory = "jwt"\ndelay = "1s"\nheader = "X-Jwt"\nsecret = "123123"\nstep = "request"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"header"}),": jwt\u8ba4\u8bc1\u65f6\u4eceheader\u4e2d\u83b7\u53d6\u7684\u8bf7\u6c42\u5934\u540d\uff08\u4e0ecookie\uff0cquery\u4e09\u9009\u4e00\uff0c\u4f18\u5148\u7ea7\u4e3aheader > cookie -> query)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cookie"}),": jwt\u8ba4\u8bc1\u65f6\u4ececookie\u4e2d\u83b7\u53d6\u7684cookie\u540d"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"query"}),": jwt\u8ba4\u8bc1\u65f6\u4ecequery\u4e2d\u83b7\u53d6\u7684\u5b57\u6bb5"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"auth_path"}),": \u751f\u6210jwt\u8ba4\u8bc1\u4fe1\u606f\u7684\u8def\u5f84"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"algorithm"}),": \u8ba4\u8bc1\u4f7f\u7528\u7684\u7b97\u6cd5"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"secret"}),": \u8ba4\u8bc1\u4f7f\u7528\u7684\u5bc6\u94a5"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Jwt",src:s(8267).A+"",width:"1982",height:"1404"})}),"\n",(0,i.jsx)(n.h2,{id:"combinedauth",children:"CombinedAuth"}),"\n",(0,i.jsx)(n.p,{children:"\u57fa\u4e8e\u5e94\u7528id+\u5bc6\u94a5\uff0c\u5e76\u4f7f\u7528\u65f6\u95f4\u6233\u751f\u6210\u6458\u8981\u7684\u7ec4\u5408\u5f0f\u8ba4\u8bc1\u65b9\u5f0f"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.appAuth]\ncategory = "combined_auth"\nstep = "request"\n\n[[plugins.appAuth.authorizations]]\napp_id = "pingap"\ndeviation = 10\nip_list = [\n    "192.168.1.1/24",\n    "127.0.0.1",\n]\nsecret = "123123"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"app_id"}),": \u9274\u6743\u4f7f\u7528\u7684id"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"deviation"}),": \u5ba2\u6237\u7aef\u53c2\u6570\u7684\u65f6\u95f4\u6233\u4e0e\u670d\u52a1\u5668\u7684\u504f\u5dee\u65f6\u95f4"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ip_list"}),": \u5141\u8bb8\u7684ip\u5217\u8868"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"secret"}),": \u5bc6\u94a5"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8bf7\u6c42\u7684query\u53c2\u6570\u5982\u4e0b\uff1a",(0,i.jsx)(n.code,{children:"app_id=pingap&ts=1727582506&digest=85c623c389177a69860adfd572212507ef98c197ba5105677919e0663eeae091"}),"\uff0c",(0,i.jsx)(n.code,{children:"digest"}),"\u901a\u8fc7sha256\u8ba1\u7b97\u5bc6\u94a5\u4e0e\u65f6\u95f4\u6233\u7684hash\u503c\u5f97\u51fa\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'let mut hasher = Sha256::new();\nhasher.update(format!("{}:{ts}", auth_param.secret).as_bytes());\nlet hash256 = hasher.finalize();\nif digest.to_lowercase() != hash256.encode_hex::<String>() {\n    return Err(Error::Invalid {\n        category: category.to_string(),\n        message: "digest is invalid".to_string(),\n    });\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"limit",children:"Limit"}),"\n",(0,i.jsxs)(n.p,{children:["\u53ef\u57fa\u4e8ecookie\u3001\u8bf7\u6c42\u5934\u6216query\u53c2\u6570\u6765\u9650\u5236\u5e76\u53d1\u8bbf\u95ee\uff0c\u652f\u6301",(0,i.jsx)(n.code,{children:"inflight"}),"(\u5e76\u53d1)\u4e0e",(0,i.jsx)(n.code,{children:"rate"}),"(\u8bbf\u95ee\u9891\u7387)\u4e24\u79cd\u9650\u5236\u7c7b\u578b\uff0c\u82e5\u914d\u7f6e\u7684\u5b57\u6bb5\u83b7\u53d6\u5230\u7684\u503c\u4e3a\u7a7a\uff0c\u5219\u4e0d\u9650\u5236\uff0c\u652f\u6301",(0,i.jsx)(n.code,{children:"inflight"}),"\u4e0e",(0,i.jsx)(n.code,{children:"rate"}),"\u4e24\u79cd\u9650\u5236\u7c7b\u578b\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u6839\u636ecookie\u7684",(0,i.jsx)(n.code,{children:"bigtree"}),"\u9650\u5236\u5e76\u53d1\u6570\u4e3a",(0,i.jsx)(n.code,{children:"10"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.cookieBigTreeLimit]\ncategory = "limit"\ninterval = "1m"\nkey = "bigtree"\nmax = 10\nstep = "request"\ntag = "cookie"\ntype = "inflight"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u6839\u636e\u8bf7\u6c42\u5934\u7684",(0,i.jsx)(n.code,{children:"X-App"}),"\u53c2\u6570\u9650\u5236\u5e76\u53d1\u6570",(0,i.jsx)(n.code,{children:"10"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.headerAppLimit]\ncategory = "limit"\nkey = "X-App"\nmax = 10\ntag = "header"\ntype = "inflight"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u6839\u636equery\u4e2d\u7684",(0,i.jsx)(n.code,{children:"app"}),"\u53c2\u6570\u9650\u52361\u79d2\u949f\u4ec5\u80fd\u8bbf\u95ee",(0,i.jsx)(n.code,{children:"10"}),"\u6b21:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.queryAppLimit]\ncategory = "limit"\ninterval = "1s""\nkey = "app"\nmax = 10\ntag = "query"\ntype = "rate"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u6839\u636eip\u9650\u52361\u5206\u949f\u6700\u591a\u8bbf\u95ee",(0,i.jsx)(n.code,{children:"10"}),"\u6b21(ip\u83b7\u53d6\u7684\u987a\u5e8f\u4e3aX-Forwarded-For --\x3e X-Real-Ip --\x3e Remote Addr):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.ipLimit]\ncategory = "limit"\ninterval = "1m"\nmax = 10\ntag = "ip"\ntype = "rate"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"type"}),": \u9650\u5236\u7684\u7c7b\u578b\uff0c\u6709",(0,i.jsx)(n.code,{children:"inflight"}),"\u5e76\u53d1\u9650\u5236\u4e0e",(0,i.jsx)(n.code,{children:"rate"}),"\u901f\u7387\u9650\u5236"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tag"}),": \u9650\u6d41\u7684key\u7684\u83b7\u53d6\u7c7b\u578b\uff0c\u6709",(0,i.jsx)(n.code,{children:"cookie"}),", ",(0,i.jsx)(n.code,{children:"header"}),"\uff0c",(0,i.jsx)(n.code,{children:"query"}),"\u4e0e",(0,i.jsx)(n.code,{children:"ip"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"key"}),": \u9650\u5236\u4f7f\u7528\u7684key\uff0c\u5bf9\u4e8e",(0,i.jsx)(n.code,{children:"ip"}),"\u7c7b\u578b\u65e0\u9700\u6307\u5b9a"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"max"}),": \u9650\u6d41\u6700\u5927\u503c"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"interval"}),": \u9650\u6d41\u95f4\u9694\uff0c\u7528\u4e8e",(0,i.jsx)(n.code,{children:"rate"}),"\u7c7b\u578b"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u754c\u9762\u914d\u7f6e\u5982\u56fe\u6240\u793a\uff0c\u4e3b\u8981\u662f\u914d\u7f6e\u9650\u5236\u6761\u4ef6\u4ee5\u53ca\u5bf9\u5e94\u7684\u6700\u5927\u5e76\u53d1\u8bbf\u95ee\u91cf\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Limit",src:s(2537).A+"",width:"1980",height:"1206"})}),"\n",(0,i.jsx)(n.h2,{id:"iprestriction",children:"IpRestriction"}),"\n",(0,i.jsx)(n.p,{children:"Ip\u9650\u5236\u5206\u4e3a\u4e24\u79cd\u6a21\u5f0f\uff0c\u5141\u8bb8\u6216\u7981\u6b62\uff0cip\u53ef\u652f\u6301\u914d\u7f6e\u4e3a\u5355ip\u6216ip\u7ec4\uff0c\u914d\u7f6e\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.ipDeny]\ncategory = "ip_restriction"\nip_list = [\n    "192.168.1.1",\n    "1.1.1.0/24",\n]\nmessage = "\u7981\u6b62\u8be5IP\u8bbf\u95ee"\nstep = "request"\ntype = "deny"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"type"}),": \u7c7b\u578b\uff0c\u662f\u5141\u8bb8\u8fd8\u662f\u7981\u6b62"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ip_list"}),": IP\u6216IP\u7f51\u6bb5\u5217\u8868"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"message"}),": \u62e6\u622a\u65f6\u7684\u51fa\u9519\u4fe1\u606f"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u754c\u9762\u914d\u7f6e\u5982\u56fe\u6240\u793a\uff0c\u914d\u7f6eIP\u5217\u8868\u540e\uff0c\u586b\u5199\u662f\u5141\u8bb8\u8fd8\u662f\u7981\u6b62\u5373\u53ef\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Ip Restriction",src:s(4800).A+"",width:"1982",height:"1312"})}),"\n",(0,i.jsx)(n.h2,{id:"refererrestriction",children:"RefererRestriction"}),"\n",(0,i.jsx)(n.p,{children:"Referer\u9650\u5236\u5206\u4e3a\u4e24\u79cd\u6a21\u5f0f\uff0c\u5141\u8bb8\u6216\u7981\u6b62\uff0c\u914d\u7f6e\u65f6\u53ef\u4f7f\u7528*\u524d\u7f00\u5339\u914d\uff0c\u914d\u7f6e\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.referer]\ncategory = "referer_restriction"\nmessage = "\u7981\u6b62\u8bbf\u95ee"\nreferer_list = ["*.github.com"]\nstep = "request"\ntype = "allow"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"type"}),": \u7c7b\u578b\uff0c\u662f\u5141\u8bb8\u8fd8\u662f\u7981\u6b62"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"referer_list"}),": referer\u5217\u8868"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"message"}),": \u62e6\u622a\u65f6\u7684\u51fa\u9519\u4fe1\u606f"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u754c\u9762\u914d\u7f6e\u5982\u56fe\u6240\u793a\uff0c\u914d\u7f6eReferer\u5217\u8868\u540e\uff0c\u586b\u5199\u662f\u5141\u8bb8\u8fd8\u662f\u7981\u6b62\u5373\u53ef\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Referer Restriction",src:s(5838).A+"",width:"1978",height:"1208"})}),"\n",(0,i.jsx)(n.h2,{id:"csrf",children:"Csrf"}),"\n",(0,i.jsx)(n.p,{children:"Csrf\u6821\u9a8c\uff0c\u6821\u9a8c\u8bf7\u6c42\u65f6\u7684cookie\u4e0e\u8bf7\u6c42\u5934\u7684\u662f\u5426\u4e00\u81f4\uff0c\u82e5\u4e0d\u4e00\u81f4\u5219\u8fd4\u56de\u51fa\u9519\u3002\u83b7\u53d6\u4ee4\u724c\u7684\u8def\u5f84\u5219\u4f1a\u751f\u6210\u5bf9\u5e94\u7684cookie\uff0c\u5e76\u8bbe\u7f6e\u4e3a\u975ehttp\u7684\u6a21\u5f0f\u5141\u8bb8\u6d4f\u89c8\u5668\u83b7\u53d6\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.csrf]\ncategory = "csrf"\nkey = "WjrXUG47wu"\nname = "x-csrf-token"\ntoken_path = "/csrf-token"\nttl = "1h"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"key"}),": \u751f\u6210csrf\u4fe1\u606f\u65f6\u4f7f\u7528\u7684key"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"name"}),": csrf\u7684\u540d\u79f0"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"token_path"}),": \u751f\u6210token\u7684\u76ee\u5f55"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ttl"}),": \u6709\u6548\u671f"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Csrf",src:s(6096).A+"",width:"1982",height:"1062"})}),"\n",(0,i.jsx)(n.h2,{id:"cors",children:"Cors"}),"\n",(0,i.jsx)(n.p,{children:"Cors\u63d2\u4ef6\uff0c\u7528\u4e8e\u8bbe\u7f6e\u8de8\u57df\u8bf7\u6c42\u76f8\u5173\u914d\u7f6e\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.cors]\nallow_credentials = true\nallow_headers = "Content-Type, X-User-Id"\nallow_methods = "GET, POST, OPTIONS"\nallow_origin = "$http_origin"\ncategory = "cors"\nexpose_headers = "Content-Type, X-Device"\nmax_age = "1h"\npath = "^/api"\nstep = "request"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allow_credentials"}),": \u662f\u5426\u5141\u8bb8\u643a\u5e26\u8ba4\u8bc1\u4fe1\u606f"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allow_headers"}),": \u5141\u8bb8\u7684\u8bf7\u6c42\u5934"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allow_methods"}),": \u5141\u8bb8\u7684http\u65b9\u6cd5"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allow_origin"}),": \u5141\u8bb8\u7684origin\uff0c\u82e5\u8bbe\u7f6e\u4e3a",(0,i.jsx)(n.code,{children:"$http_origin"}),"\u5219\u8868\u793a\u6309\u6765\u6e90\u8bbe\u7f6e\u5141\u8bb8\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528\u6b64\u5f62\u5f0f\uff0c\u5efa\u8bae\u6309\u9700\u8bbe\u7f6e"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"max_age"}),": \u8bbe\u7f6e\u6709\u6548\u671f"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"path"}),": \u8bbe\u7f6e\u5141\u8bb8cors\u7684\u8def\u5f84\uff0c\u53ef\u4e3a\u6b63\u5219\u8868\u8fbe\u5f0f"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"expose_headers"}),": \u66b4\u9732\u7ed9\u6d4f\u89c8\u5668\u8bbf\u95ee\u7684\u54cd\u5e94\u5934"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Cors",src:s(9493).A+"",width:"1980",height:"1392"})}),"\n",(0,i.jsx)(n.h2,{id:"responseheaders",children:"ResponseHeaders"}),"\n",(0,i.jsxs)(n.p,{children:["\u54cd\u5e94\u5934\u7684\u63d2\u4ef6\u4e3b\u8981\u662f\u8bbe\u7f6e\u3001\u6dfb\u52a0\u4ee5\u53ca\u5220\u9664\u8bf7\u6c42\u5934\u3002\u82e5\u54cd\u5e94\u5934\u7684\u503c\u8bbe\u7f6e\u4e3a",(0,i.jsx)(n.code,{children:"$hostname"}),"\u8868\u793a\u83b7\u53d6\u673a\u5668\u7684hostname\uff0c\u82e5\u4ee5",(0,i.jsx)(n.code,{children:"$"}),"\u5f00\u5934\u7684\u5219\u8868\u793a\u4ece\u73af\u5883\u53d8\u91cf\u4e2d\u83b7\u53d6\u5bf9\u5e94\u7684\u503c\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[plugins.commonResponseHeaders]\nadd_headers = ["X-Server:pingap"]\ncategory = "response_headers"\nremove_headers = ["X-User"]\nset_headers = ["X-Response-Id:123"]\nstep = "response"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"add_headers"}),": \u9700\u8981\u6dfb\u52a0\u7684\u54cd\u5e94\u5934"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"set_headers"}),": \u9700\u8981\u8bbe\u7f6e\u7684\u54cd\u5e94\u5934\uff0c\u4f1a\u8986\u76d6\u539f\u6709\u503c"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"remove_headers"}),": \u9700\u8981\u5220\u9664\u7684\u54cd\u5e94\u5934"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u6267\u884c\u987a\u5e8f\u4e3a",(0,i.jsx)(n.code,{children:"add_headers --\x3e remove_headers --\x3e set_headers"}),"\u3002\u754c\u9762\u914d\u7f6e\u5982\u56fe\u6240\u793a\uff0c\u6309\u9700\u8981\u914d\u7f6e\u8981\u8bbe\u7f6e\u3001\u6dfb\u52a0\u6216\u5220\u9664\u7684\u54cd\u5e94\u5934\uff0c\u82e5\u4e0d\u9700\u8981\u5219\u4e0d\u8bbe\u7f6e\u5373\u53ef\uff1a"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Pingap Plugin Response Headers",src:s(5954).A+"",width:"1976",height:"1250"})})]})}function o(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},6549:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-admin-19e07a532d23d7ed85842ddaf1378c92.jpg"},8091:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-basic-auth-bf0f3ba50ce374bd681524a341c65f4b.jpg"},6306:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-cache-eacc320e713177b0de604c0cdfb7bba7.jpg"},6198:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-compression-56f1454f72a4e3eda2b80932fb97ae92.jpg"},9493:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-cors-a38b9c1d72c4490e43260f0724efa122.jpg"},6096:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-csrf-a16fdb639090dbf5c8d5ae8963bd0a31.jpg"},9421:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-directory-dad08a13e1beb1f9ab47027390e810bf.jpg"},4800:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-ip-restriction-ea3128dad4b9f4d161cde62df0b1a640.jpg"},8267:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-jwt-3cba11d07bdb18aee47a38be86863cba.jpg"},6074:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-key-auth-d037a72785a6c0eb9696f3b071c4dad8.jpg"},2537:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-limit-c016e02fbd62da4ea27b7561e719d31d.jpg"},2368:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-mock-6a6b065d82f57593deae50cf2a1ce372.jpg"},4846:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-redirect-https-aef9831a149fdf7a6ce9e95df5d901db.jpg"},5838:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-referer-restriction-f0823b2e38506b1979d905bd86e54765.jpg"},2041:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-request-id-ae623eaa9246e73ed460c7a95d085c97.jpg"},5954:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-response-headers-4739bf70418396a02e7ac86121f5dc17.jpg"},1793:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/plugin-stats-69553af040d3e4a0827ff2c383f042d4.jpg"}}]);