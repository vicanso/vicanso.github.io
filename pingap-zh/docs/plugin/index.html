<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-plugin" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">插件体系 | Pingap</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://vicanso.github.io/pingap-zh/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://vicanso.github.io/pingap-zh/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://vicanso.github.io/pingap-zh/docs/plugin"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="插件体系 | Pingap"><meta data-rh="true" name="description" content="插件系统允许您通过添加各类插件来扩展 Location 的功能,支持鉴权、流控、响应头设置等多种场景。通过插件,您可以灵活地定制请求处理流程。"><meta data-rh="true" property="og:description" content="插件系统允许您通过添加各类插件来扩展 Location 的功能,支持鉴权、流控、响应头设置等多种场景。通过插件,您可以灵活地定制请求处理流程。"><link data-rh="true" rel="icon" href="/pingap-zh/img/pingap.png"><link data-rh="true" rel="canonical" href="https://vicanso.github.io/pingap-zh/docs/plugin"><link data-rh="true" rel="alternate" href="https://vicanso.github.io/pingap-zh/docs/plugin" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://vicanso.github.io/pingap-zh/docs/plugin" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://502YBQO3PX-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"插件体系","item":"https://vicanso.github.io/pingap-zh/docs/plugin"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="Pingap" href="/pingap-zh/opensearch.xml"><link rel="stylesheet" href="/pingap-zh/assets/css/styles.975a7111.css">
<script src="/pingap-zh/assets/js/runtime~main.4476f578.js" defer="defer"></script>
<script src="/pingap-zh/assets/js/main.ee418143.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/pingap-zh/"><div class="navbar__logo"><img src="/pingap-zh/img/pingap.png" alt="Pingap Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/pingap-zh/img/pingap.png" alt="Pingap Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Pingap</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pingap-zh/docs/introduction">文档说明</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="http://pingap.io/pingap-en/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">English<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/vicanso/pingap" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-zh/docs/introduction">什么是 Pingap？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-zh/docs/getting_started">入门教程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-zh/docs/argument">命令行参数与环境变量</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-zh/docs/config">配置项详解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-zh/docs/log">访问日志格式化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-zh/docs/certificate">轻松管理 HTTPS 证书</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/pingap-zh/docs/plugin">插件体系</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-zh/docs/docker">使用 Docker 部署 Pingap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-zh/docs/question">常见问题 (FAQ)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-zh/docs/performance">性能测试</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/pingap-zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">插件体系</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>插件体系</h1></header>
<p>插件系统允许您通过添加各类插件来扩展 Location 的功能,支持鉴权、流控、响应头设置等多种场景。通过插件,您可以灵活地定制请求处理流程。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="插件执行时点">插件执行时点<a href="#插件执行时点" class="hash-link" aria-label="插件执行时点的直接链接" title="插件执行时点的直接链接">​</a></h2>
<p>插件可以在请求处理的不同阶段执行,目前支持以下三个时点:</p>
<ul>
<li>
<p><code>Request</code>: 请求最开始阶段</p>
<ul>
<li>适用于权限验证等需要早期拦截的场景</li>
</ul>
</li>
<li>
<p><code>ProxyUpstream</code>: 转发至上游节点之前</p>
<ul>
<li>在读取缓存之后执行</li>
<li>适用于需要限制上游访问但允许缓存访问的场景</li>
<li>例如:限制对上游的请求频率,但允许高并发读取缓存</li>
</ul>
</li>
<li>
<p><code>Response</code>: 上游响应之后</p>
<ul>
<li>用于处理和修改上游返回的响应数据</li>
</ul>
</li>
</ul>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[async_trait]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">trait</span><span class="token plain"> </span><span class="token type-definition class-name">Plugin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Sync</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token class-name">Send</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Returns a unique key that identifies this specific plugin instance.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// # Purpose</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// - Can be used for caching plugin results</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// - Helps differentiate between multiple instances of the same plugin type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// - Useful for tracking and debugging</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// # Default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Returns an empty string by default, which means no specific instance identification.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">hash_key</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">to_string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Processes an HTTP request at a specified lifecycle step.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// # Parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// * `_step` - Current processing step in the request lifecycle (e.g., pre-routing, post-routing)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// * `_session` - Mutable reference to the HTTP session containing request data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// * `_ctx` - Mutable reference to the request context for storing state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// # Returns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// * `Ok((executed, response))` where:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///   * `executed` - Boolean flag:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///     - `true`: Plugin performed meaningful logic for this request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///     - `false`: Plugin was skipped or did nothing for this request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///   * `response` - Optional HTTP response:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///     - `Some(response)`: Terminates request processing and returns this response to client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///     - `None`: Allows request to continue to next plugin or upstream</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// * `Err` - Returns error if plugin processing failed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">handle_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _step</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">PluginStep</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _session</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token class-name">Session</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ctx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token class-name">Ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">pingora</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Result</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">bool</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Option</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">HttpResponse</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Processes an HTTP response at a specified lifecycle step.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// # Parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// * `_step` - Current processing step in the response lifecycle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// * `_session` - Mutable reference to the HTTP session</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// * `_ctx` - Mutable reference to the request context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// * `_upstream_response` - Mutable reference to the upstream response header</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// # Returns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// * `Ok(modified)` - Boolean flag:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///   - `true`: Plugin modified the response in some way</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///   - `false`: Plugin did not modify the response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// * `Err` - Returns error if plugin processing failed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">handle_response</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _step</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">PluginStep</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _session</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token class-name">Session</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ctx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token class-name">Ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _upstream_response</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token class-name">ResponseHeader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">pingora</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Result</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">bool</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>主要分三个实现：</p>
<ul>
<li><code>category</code>: 插件类型，用于区分该插件是哪类形式的插件</li>
<li><code>step</code>: 插件的执行时序，按需选择插件的执行时序，不同的插件可选择的选择不一样</li>
<li><code>handle_request</code>: 插件的转发前执行逻辑，若返回的是<code>Ok(Some(HttpResponse))</code>，则表示请求已处理完成，不再转发到上游节点，并将该响应传输至请求端</li>
<li><code>handle_response</code>: 插件的响应前执逻辑，若返回的是<code>Ok(true)</code>，则表示该插件被成功执行</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="stats-性能统计插件">Stats 性能统计插件<a href="#stats-性能统计插件" class="hash-link" aria-label="Stats 性能统计插件的直接链接" title="Stats 性能统计插件的直接链接">​</a></h2>
<p>Stats插件用于暴露应用的性能指标数据,方便第三方系统采集监控。可以通过以下两种方式使用:</p>
<ol>
<li>使用内置的 <code>pingap:stats</code> 插件</li>
<li>自定义配置新的 Stats 插件</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例">配置示例<a href="#配置示例" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.stats]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;stats&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path = &quot;/stats&quot;  # 访问路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remark = &quot;性能指标采集&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数">配置参数<a href="#配置参数" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>path</code>: 指标数据访问路径,如配置为 <code>/stats</code> 则可通过该路径获取性能指标</li>
<li><code>step</code>: 插件执行时机,可选 <code>request</code> 或 <code>proxy_upstream</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用方式">使用方式<a href="#使用方式" class="hash-link" aria-label="使用方式的直接链接" title="使用方式的直接链接">​</a></h3>
<p>配置完成后,可以通过访问对应 location 下的 <code>/stats</code> 路径获取性能指标数据。</p>
<p><img decoding="async" loading="lazy" alt="Stats插件配置界面" src="/pingap-zh/assets/images/plugin-stats-5ff87bc9937068be03763c8e278d2a57.jpg" width="1984" height="1266" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ping">Ping<a href="#ping" class="hash-link" aria-label="Ping的直接链接" title="Ping的直接链接">​</a></h2>
<p>Ping插件提供了一个简单的健康检查端点,用于监控服务是否正常运行。当配置了反向代理时,也可以作为 pingap 的健康检查机制，该插件固定执行在<code>request</code>阶段。</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.pingpong]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;ping&quot; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path = &quot;/ping&quot;  # 健康检查路径</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-1">配置参数<a href="#配置参数-1" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>path</code>: 健康检查的访问路径,访问该路径时会返回 &quot;pong&quot; 响应</li>
<li><code>step</code>: 插件执行时机,仅支持 <code>request</code> 阶段</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用方式-1">使用方式<a href="#使用方式-1" class="hash-link" aria-label="使用方式的直接链接" title="使用方式的直接链接">​</a></h3>
<p>配置完成后,访问对应的 path 路径(如 <code>/ping</code>)即可获得 &quot;pong&quot; 响应,用于验证服务是否存活。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="admin">Admin<a href="#admin" class="hash-link" aria-label="Admin的直接链接" title="Admin的直接链接">​</a></h2>
<p>Admin 插件用于为现有 location 添加管理后台功能。配置示例：</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.admin]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">authorizations = [&quot;YWRtaW46MTIzMTIz&quot;] # base64(admin:123123)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;admin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip_fail_limit = 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_age = &quot;7d&quot; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path = &quot;/pingap&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remark = &quot;管理后台&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-2">配置参数<a href="#配置参数-2" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>authorizations</code>: Basic 认证的密钥列表，使用 base64 编码的 <code>用户名:密码</code> 格式</li>
<li><code>ip_fail_limit</code>: 单个 IP 允许的最大认证失败次数</li>
<li><code>path</code>: 管理后台访问路径</li>
<li><code>max_age</code>: 登录会话有效期，默认为 2 天</li>
<li><code>step</code>: 插件执行时机，可选 <code>request</code> 或 <code>proxy_upstream</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用方式-2">使用方式<a href="#使用方式-2" class="hash-link" aria-label="使用方式的直接链接" title="使用方式的直接链接">​</a></h3>
<ol>
<li>将插件配置关联到指定 location</li>
<li>访问该 location 下的配置路径(如 <code>/pingap/</code>)即可进入管理后台</li>
<li>使用配置的账号密码登录(示例中为 <code>admin/123123</code>)</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Admin" src="/pingap-zh/assets/images/plugin-admin-7b7f00d541be19f4f937de40455e549a.jpg" width="1976" height="1414" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="directory">Directory<a href="#directory" class="hash-link" aria-label="Directory的直接链接" title="Directory的直接链接">​</a></h2>
<p>Directory 插件提供静态文件服务功能，支持文件浏览和下载。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-1">配置示例<a href="#配置示例-1" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.downloadsServe]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;directory&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path = &quot;~/Downloads&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chunk_size = &quot;4kb&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_age = &quot;1h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">index = &quot;index.html&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">charset = &quot;utf-8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">autoindex = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">download = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">headers = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;X-Server:pingap&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-3">配置参数<a href="#配置参数-3" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>path</code>: 静态文件目录路径</li>
<li><code>chunk_size</code>: HTTP 分块传输大小，默认 <code>8kb</code></li>
<li><code>max_age</code>: HTTP 缓存时间<!-- -->
<ul>
<li>默认不设置缓存</li>
<li>对 <code>text/html</code> 类型始终禁用缓存</li>
<li>如 <code>1h</code> 表示缓存 1 小时</li>
</ul>
</li>
<li><code>private</code>: 是否将缓存设为 <code>private</code>（默认为 <code>public</code>）</li>
<li><code>index</code>: 默认索引文件名，默认为 <code>index.html</code></li>
<li><code>charset</code>: 指定字符集编码，默认不设置</li>
<li><code>autoindex</code>: 是否启用目录浏览<!-- -->
<ul>
<li>启用后 <code>index</code> 参数将失效</li>
</ul>
</li>
<li><code>download</code>: 是否启用文件下载<!-- -->
<ul>
<li>启用后将设置 <code>Content-Disposition</code> 响应头</li>
</ul>
</li>
<li><code>headers</code>: 自定义 HTTP 响应头列表</li>
<li><code>step</code>: 插件执行时机，可选 <code>request</code> 或 <code>proxy_upstream</code>，若设置为<code>proxy_upstream</code>并添加相应的缓存插件，可大幅度提供性能</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用方式-3">使用方式<a href="#使用方式-3" class="hash-link" aria-label="使用方式的直接链接" title="使用方式的直接链接">​</a></h3>
<p>在界面中配置静态文件目录路径，根据需要调整其他参数：</p>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Directory" src="/pingap-zh/assets/images/plugin-directory-9d893ef23a6f62735ac1fec859372023.jpg" width="1980" height="1404" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mock">Mock<a href="#mock" class="hash-link" aria-label="Mock的直接链接" title="Mock的直接链接">​</a></h2>
<p>Mock 插件用于模拟 HTTP 响应，可用于测试或临时服务降级。支持自定义响应内容、状态码和响应头，访插件固定执行在<code>request</code>阶段。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-2">配置示例<a href="#配置示例-2" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.errorMock]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;mock&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data = &#x27;{&quot;error&quot;: &quot;error message&quot;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">delay = &quot;1s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">headers = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;X-Error:CustomRrror&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Content-Type:application/json&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path = &quot;/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">status = 500</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-4">配置参数<a href="#配置参数-4" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>data</code>: 模拟的响应数据<!-- -->
<ul>
<li>对于不同类型的数据，需在 <code>headers</code> 中指定对应的 <code>Content-Type</code></li>
</ul>
</li>
<li><code>headers</code>: 自定义响应头列表</li>
<li><code>path</code>: 需要模拟响应的请求路径<!-- -->
<ul>
<li>不配置则匹配所有路径</li>
</ul>
</li>
<li><code>status</code>: HTTP 响应状态码</li>
<li><code>delay</code>: 响应延迟时间</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用方式-4">使用方式<a href="#使用方式-4" class="hash-link" aria-label="使用方式的直接链接" title="使用方式的直接链接">​</a></h3>
<p>在界面中配置响应数据和相关参数，注意根据响应数据类型设置正确的 Content-Type：</p>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Mock" src="/pingap-zh/assets/images/plugin-mock-1a6527a151e843a0829a681e03530032.jpg" width="1984" height="1502" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="redirect">Redirect<a href="#redirect" class="hash-link" aria-label="Redirect的直接链接" title="Redirect的直接链接">​</a></h2>
<p>Redirect 插件用于 HTTP 请求重定向，支持添加 URL 前缀或将 HTTP 请求重定向至 HTTPS，访插件固定执行在<code>request</code>阶段。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-3">配置示例<a href="#配置示例-3" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.http2https]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;redirect&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http_to_https = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prefix = &quot;/api&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-5">配置参数<a href="#配置参数-5" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>http_to_https</code>: 是否将 HTTP 请求重定向至 HTTPS</li>
<li><code>prefix</code>: 重定向时要添加的 URL 前缀</li>
<li><code>step</code>: 插件执行时机，仅支持 <code>request</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用方式-5">使用方式<a href="#使用方式-5" class="hash-link" aria-label="使用方式的直接链接" title="使用方式的直接链接">​</a></h3>
<p>在界面中配置重定向参数：</p>
<ul>
<li>启用 HTTPS 重定向：勾选 <code>http_to_https</code></li>
<li>添加 URL 前缀：在 <code>prefix</code> 字段中填写（可选）</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Redirect Https" src="/pingap-zh/assets/images/plugin-redirect-https-645046ed833d3919e9c0ee356080916e.jpg" width="1982" height="908" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cache">Cache<a href="#cache" class="hash-link" aria-label="Cache的直接链接" title="Cache的直接链接">​</a></h2>
<p>缓存中间件，用于缓存 HTTP 请求 。由于缓存暂时仅支持全局初始化，为避免相同 URL 的冲突，建议每个 location 使用不同的插件设置不同的 namespace，该插件固定在<code>request</code>阶段执行。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-4">配置示例<a href="#配置示例-4" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.chartsCache]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;cache&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eviction = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">headers = [&quot;Accept-Encoding&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lock = &quot;3s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_file_size = &quot;100kb&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_ttl = &quot;1h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace = &quot;charts&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">predictor = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">purge_ip_list = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;127.0.0.1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;192.168.1.1/24&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_cache_control = false</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-6">配置参数<a href="#配置参数-6" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>lock</code>: 缓存不存在请求转发至upstream等待时，相同请求的等待时长，默认为 1 秒<!-- -->
<ul>
<li>用于避免缓存击穿</li>
</ul>
</li>
<li><code>max_file_size</code>: 单个缓存文件的最大长度，默认为 1MB<!-- -->
<ul>
<li>建议设置合理的值，避免过大的响应占用过多内存</li>
</ul>
</li>
<li><code>namespace</code>: 缓存命名空间<!-- -->
<ul>
<li>缓存键基于 namespace + path + querystring 生成</li>
<li>多域名场景建议使用不同的命名空间</li>
<li>文件缓存时对应单独的文件目录</li>
</ul>
</li>
<li><code>max_ttl</code>: 缓存的最长有效期<!-- -->
<ul>
<li>当上游响应的 <code>Cache-Control</code> 的 <code>max-age</code> 较长时，建议设置较短的 <code>s-maxage</code></li>
<li>当上游未设置 <code>s-maxage</code> 时，可通过此配置限制缓存时间</li>
</ul>
</li>
<li><code>eviction</code>: 是否启用缓存清除机制<!-- -->
<ul>
<li>当缓存超限时触发清除</li>
<li>文件缓存会自动清除长期未访问的缓存，可不设置</li>
</ul>
</li>
<li><code>predictor</code>: 是否记录无法缓存的请求<!-- -->
<ul>
<li>避免重复判断请求是否可缓存</li>
</ul>
</li>
<li><code>headers</code>: 作为缓存键一部分的请求头列表<!-- -->
<ul>
<li>当响应的缓存依赖特定请求头时配置</li>
<li>例如：上游支持不同压缩算法时，需包含 <code>Accept-Encoding</code></li>
</ul>
</li>
<li><code>purge_ip_list</code>: 允许执行 purge 请求的 IP 列表，默认为空</li>
<li><code>skip</code>: 跳过缓存的正则表达式，请求url匹配则跳过缓存插件，默认为空<!-- -->
<ul>
<li>用于快速跳过某些请求的缓存判断</li>
</ul>
</li>
<li><code>check_cache_control</code>: 校验cache-control响应头，若无均认为不可缓存</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="界面配置">界面配置<a href="#界面配置" class="hash-link" aria-label="界面配置的直接链接" title="界面配置的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Cache" src="/pingap-zh/assets/images/plugin-cache-3521d7ea6c9e8e7f9fe0dd9a5f41810a.jpg" width="1976" height="1188" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="requestid">RequestId<a href="#requestid" class="hash-link" aria-label="RequestId的直接链接" title="RequestId的直接链接">​</a></h2>
<p>为每个请求添加唯一标识符。默认添加到 <code>X-Request-Id</code> 请求头中(可自定义请求头名称)。如果请求中已存在该请求头，则保留原值不做修改。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-5">配置示例<a href="#配置示例-5" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.customReqId]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">algorithm = &quot;nanoid&quot;  # 可选: uuid 或 nanoid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;request_id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">size = 8              # nanoid 长度，仅在 algorithm=nanoid 时有效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">header = &quot;X-Request-Id&quot;  # 可选：自定义请求头名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">step = &quot;request&quot;      # 可选: request 或 proxy_upstream</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-7">配置参数<a href="#配置参数-7" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>algorithm</code>: 生成请求 ID 的算法<!-- -->
<ul>
<li><code>uuid</code>: 使用 UUID v4 格式</li>
<li><code>nanoid</code>: 使用 NanoID 格式(更短、URL 安全)</li>
</ul>
</li>
<li><code>size</code>: NanoID 长度，仅当 algorithm=nanoid 时有效</li>
<li><code>header</code>: 自定义请求头名称，默认为 <code>X-Request-Id</code></li>
<li><code>step</code>: 插件执行时机，可选 <code>request</code> 或 <code>proxy_upstream</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用场景">使用场景<a href="#使用场景" class="hash-link" aria-label="使用场景的直接链接" title="使用场景的直接链接">​</a></h3>
<ul>
<li>请求追踪：方便在分布式系统中追踪请求链路</li>
<li>日志关联：通过请求 ID 关联不同服务的日志</li>
<li>问题排查：使用请求 ID 快速定位问题</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Request Id" src="/pingap-zh/assets/images/plugin-request-id-90c58507972a8f17fd31be1f21878998.jpg" width="1974" height="908" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="compression">Compression<a href="#compression" class="hash-link" aria-label="Compression的直接链接" title="Compression的直接链接">​</a></h2>
<p>HTTP 响应压缩插件，用于处理上游返回数据的压缩。支持 gzip、brotli(br) 和 zstd 三种压缩算法。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="工作原理">工作原理<a href="#工作原理" class="hash-link" aria-label="工作原理的直接链接" title="工作原理的直接链接">​</a></h3>
<p>由于 Pingora 默认的压缩算法匹配顺序为 <code>gzip --&gt; br --&gt; zstd</code>，而现代浏览器对这些算法的支持情况为：</p>
<ul>
<li>gzip: 基本全部支持</li>
<li>br(brotli): 大部分支持</li>
<li>zstd: 部分支持</li>
</ul>
<p>为了优化压缩效果，pingap会根据配置以及浏览器支持的压缩算法，按<code>zstd --&gt; br --&gt; gzip</code>的规则设置，只设置一个压缩算法。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-6">配置示例<a href="#配置示例-6" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.commonCompression]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;compression&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">br_level = 6      # brotli 压缩级别 (0-11)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gzip_level = 6    # gzip 压缩级别 (0-9)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zstd_level = 5    # zstd 压缩级别 (0-22)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">decompression = true</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-8">配置参数<a href="#配置参数-8" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>br_level</code>: brotli 压缩级别，范围 0-11，0 表示禁用</li>
<li><code>gzip_level</code>: gzip 压缩级别，范围 0-9，0 表示禁用</li>
<li><code>zstd_level</code>: zstd 压缩级别，范围 0-22，0 表示禁用</li>
<li><code>decompression</code>: 是否解压上游返回的压缩数据</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="内置配置">内置配置<a href="#内置配置" class="hash-link" aria-label="内置配置的直接链接" title="内置配置的直接链接">​</a></h3>
<p>可以使用内置的 <code>pingap:compression</code> 插件，其默认配置为：</p>
<ul>
<li>gzip_level = 6</li>
<li>br_level = 6</li>
<li>zstd_level = 3</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="执行阶段">执行阶段<a href="#执行阶段" class="hash-link" aria-label="执行阶段的直接链接" title="执行阶段的直接链接">​</a></h3>
<p>插件固定在 <code>early_request</code> 阶段执行，无需手动指定。</p>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Compression" src="/pingap-zh/assets/images/plugin-compression-5b4c2d60570f33ea2bc289ed1ee0a215.jpg" width="1976" height="896" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="acceptencoding">AcceptEncoding<a href="#acceptencoding" class="hash-link" aria-label="AcceptEncoding的直接链接" title="AcceptEncoding的直接链接">​</a></h2>
<p>用于管理和优化 HTTP 请求的 Accept-Encoding 头，允许自定义支持的压缩算法及其优先顺序，顺序建议为zdt &gt; br &gt; gzip。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-7">配置示例<a href="#配置示例-7" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.acceptEncoding]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;accept_encoding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">encodings = &quot;zstd, br, gzip&quot;    # 支持的编码及优先顺序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">only_one_encoding = true        # 是否仅使用单一编码</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-9">配置参数<a href="#配置参数-9" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>encodings</code>: 指定支持的压缩算法及其优先顺序<!-- -->
<ul>
<li>多个算法用逗号分隔</li>
<li>顺序从左到右表示优先级从高到低</li>
<li>支持的算法: zstd、br、gzip</li>
</ul>
</li>
<li><code>only_one_encoding</code>: 是否仅保留一种编码方式<!-- -->
<ul>
<li><code>true</code>: 仅使用优先级最高的支持的编码</li>
<li><code>false</code>: 保留所有支持的编码，按优先级排序</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="执行阶段-1">执行阶段<a href="#执行阶段-1" class="hash-link" aria-label="执行阶段的直接链接" title="执行阶段的直接链接">​</a></h3>
<p>插件固定在 <code>early_request</code> 阶段执行，无需手动指定。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="keyauth">KeyAuth<a href="#keyauth" class="hash-link" aria-label="KeyAuth的直接链接" title="KeyAuth的直接链接">​</a></h2>
<p>提供简单的 API 密钥认证机制，支持从请求参数(query)或请求头(header)中获取认证信息。可配置多个有效密钥，方便多系统接入，访插件固定执行在<code>request</code>阶段。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-8">配置示例<a href="#配置示例-8" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="从请求参数获取认证信息">从请求参数获取认证信息<a href="#从请求参数获取认证信息" class="hash-link" aria-label="从请求参数获取认证信息的直接链接" title="从请求参数获取认证信息的直接链接">​</a></h4>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.queryAuth]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;key_auth&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">query = &quot;app&quot;           # 从 URL 参数 app 中获取密钥</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keys = [               # 允许的密钥列表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;KOXQaw&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;GKvXY2&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">delay = &quot;1s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hide_credentials = true</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="从请求头获取认证信息">从请求头获取认证信息<a href="#从请求头获取认证信息" class="hash-link" aria-label="从请求头获取认证信息的直接链接" title="从请求头获取认证信息的直接链接">​</a></h4>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.headerAuth]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;key_auth&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">header = &quot;X-App&quot;        # 从请求头 X-App 中获取密钥</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keys = [               # 允许的密钥列表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;KOXQaw&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;GKvXY2&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">delay = &quot;1s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hide_credentials = true</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-10">配置参数<a href="#配置参数-10" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>query</code>: 从请求参数中获取密钥的参数名</li>
<li><code>header</code>: 从请求头中获取密钥的头部名称<!-- -->
<ul>
<li><code>query</code> 和 <code>header</code> 二选一，同时配置时优先使用 <code>query</code></li>
</ul>
</li>
<li><code>keys</code>: 允许的密钥列表</li>
<li><code>delay</code>: 认证失败时的响应延迟时间</li>
<li><code>hide_credentials</code>: 是否在转发请求时移除认证信息</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="界面配置-1">界面配置<a href="#界面配置-1" class="hash-link" aria-label="界面配置的直接链接" title="界面配置的直接链接">​</a></h3>
<p>配置密钥获取方式（请求参数或请求头）及对应的有效密钥列表：</p>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Key Auth" src="/pingap-zh/assets/images/plugin-key-auth-debf3560dc2c102e574de9cb7946562a.jpg" width="1978" height="1344" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="basicauth">BasicAuth<a href="#basicauth" class="hash-link" aria-label="BasicAuth的直接链接" title="BasicAuth的直接链接">​</a></h2>
<p>提供 HTTP Basic Authentication 认证功能。支持配置多组用户名/密码对,需以 base64 编码格式配置，该插件固定在<code>request</code>阶段执行。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-9">配置示例<a href="#配置示例-9" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.testBasicAuth]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">authorizations = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;YWRtaW46dGVzdA==&quot;,    # admin:test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;YWRtaW46MTIzMTIz&quot;,    # admin:123123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;basic_auth&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">delay = &quot;1s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hide_credentials = true</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-11">配置参数<a href="#配置参数-11" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>authorizations</code>: 认证凭据列表<!-- -->
<ul>
<li>格式为 <code>base64(username:password)</code></li>
<li>可配置多组凭据</li>
</ul>
</li>
<li><code>delay</code>: 认证失败时的响应延迟时间</li>
<li><code>hide_credentials</code>: 是否在转发请求时移除认证信息</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明">使用说明<a href="#使用说明" class="hash-link" aria-label="使用说明的直接链接" title="使用说明的直接链接">​</a></h3>
<ol>
<li>将用户名和密码按 <code>username:password</code> 格式拼接</li>
<li>对拼接结果进行 base64 编码</li>
<li>将编码后的字符串添加到 <code>authorizations</code> 列表中</li>
</ol>
<p>例如:</p>
<ul>
<li><code>admin:test</code> -&gt; <code>YWRtaW46dGVzdA==</code></li>
<li><code>admin:123123</code> -&gt; <code>YWRtaW46MTIzMTIz</code></li>
</ul>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Basic Auth" src="/pingap-zh/assets/images/plugin-basic-auth-b82d10df2c920a3dc48fe43663b4c775.jpg" width="1984" height="1164" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="jwt">JWT<a href="#jwt" class="hash-link" aria-label="JWT的直接链接" title="JWT的直接链接">​</a></h2>
<p>提供 JWT (JSON Web Token) 认证功能，该插件固定执行在<code>request</code>阶段。包含两个主要功能:</p>
<ol>
<li>在指定路径生成 JWT token</li>
<li>验证请求中携带的 JWT token 是否有效</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-10">配置示例<a href="#配置示例-10" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.jwtAuth]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">algorithm = &quot;HS256&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth_path = &quot;/jwt-sign&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;jwt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">delay = &quot;1s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">header = &quot;X-Jwt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secret = &quot;123123&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-12">配置参数<a href="#配置参数-12" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>auth_path</code>: 用于生成 JWT token 的路径<!-- -->
<ul>
<li>访问该路径时,会将响应数据作为 payload 生成 token</li>
</ul>
</li>
<li><code>algorithm</code>: JWT 签名算法,目前支持 HS256</li>
<li><code>secret</code>: 签名密钥</li>
<li><code>header</code>: 从请求头获取 token 的字段名</li>
<li><code>cookie</code>: 从 cookie 获取 token 的字段名</li>
<li><code>query</code>: 从 URL 参数获取 token 的字段名<!-- -->
<ul>
<li>token 获取优先级: header &gt; cookie &gt; query</li>
<li>三个参数至少配置其中一个</li>
</ul>
</li>
<li><code>delay</code>: 认证失败时的响应延迟时间</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="工作流程">工作流程<a href="#工作流程" class="hash-link" aria-label="工作流程的直接链接" title="工作流程的直接链接">​</a></h3>
<ol>
<li>
<p>生成 token:</p>
<ul>
<li>访问 <code>auth_path</code> 配置的路径</li>
<li>将响应数据作为 payload 签名生成 token</li>
<li>返回生成的 token</li>
</ul>
</li>
<li>
<p>验证 token:</p>
<ul>
<li>访问其他路径时,按优先级获取 token</li>
<li>验证 token 的签名和有效性</li>
<li>验证通过则继续处理,否则返回认证错误</li>
</ul>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Jwt" src="/pingap-zh/assets/images/plugin-jwt-9c8b576d7298c6ad5299e1e89bebf90b.jpg" width="1982" height="1404" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="combinedauth">CombinedAuth<a href="#combinedauth" class="hash-link" aria-label="CombinedAuth的直接链接" title="CombinedAuth的直接链接">​</a></h2>
<p>提供基 于应用 ID、密钥和时间戳的组合式认证机制。支持为每个应用配置独立的认证参数和 IP 白名单，该插件固定在<code>request</code>阶段执行。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-11">配置示例<a href="#配置示例-11" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.appAuth]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;combined_auth&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[[plugins.appAuth.authorizations]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app_id = &quot;pingap&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deviation = 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip_list = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;192.168.1.1/24&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;127.0.0.1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secret = &quot;123123&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-13">配置参数<a href="#配置参数-13" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>app_id</code>: 应用标识符</li>
<li><code>secret</code>: 用于生成摘要的密钥</li>
<li><code>deviation</code>: 允许的时间戳偏差(单位:秒)<!-- -->
<ul>
<li>用于处理客户端与服务器时间不完全同步的情况</li>
</ul>
</li>
<li><code>ip_list</code>: 允许访问的 IP 白名单<!-- -->
<ul>
<li>支持单个 IP 和 CIDR 格式的网段</li>
</ul>
</li>
<li><code>step</code>: 插件执行时机,仅支持 <code>request</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="认证流程">认证流程<a href="#认证流程" class="hash-link" aria-label="认证流程的直接链接" title="认证流程的直接链接">​</a></h3>
<ol>
<li>
<p>客户端构造请求参数:</p>
<ul>
<li><code>app_id</code>: 配置的应用标识符</li>
<li><code>ts</code>: 当前时间戳</li>
<li><code>digest</code>: 通过 SHA256 算法计算得出的摘要值<!-- -->
<ul>
<li>计算公式: <code>SHA256(secret:timestamp)</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>请求示例:</p>
</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /api?app_id=pingap&amp;ts=1727582506&amp;digest=85c623c389177a69860adfd572212507ef98c197ba5105677919e0663eeae091</span><br></span></code></pre></div></div>
<ol start="3">
<li>服务端验证:<!-- -->
<ul>
<li>检查请求 IP 是否在白名单中</li>
<li>验证时间戳是否在允许的偏差范围内</li>
<li>使用相同算法计算摘要并比对</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="limit">Limit<a href="#limit" class="hash-link" aria-label="Limit的直接链接" title="Limit的直接链接">​</a></h2>
<p>提供基于多种条件的访问限制功能。支持并发数(inflight)和访问频率(rate)两种限制类型，可以根据 Cookie、请求头、URL 参数或 IP 地址进行限制。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-14">配置参数<a href="#配置参数-14" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>type</code>: 限制类型<!-- -->
<ul>
<li><code>inflight</code>: 并发访问数限制</li>
<li><code>rate</code>: 访问频率限制</li>
</ul>
</li>
<li><code>tag</code>: 限制条件来源<!-- -->
<ul>
<li><code>cookie</code>: 从 Cookie 获取</li>
<li><code>header</code>: 从请求头获取</li>
<li><code>query</code>: 从 URL 参数获取</li>
<li><code>ip</code>: 基于访问者 IP</li>
</ul>
</li>
<li><code>key</code>: 获取限制值的字段名称<!-- -->
<ul>
<li>使用 <code>ip</code> 类型时无需指定</li>
</ul>
</li>
<li><code>max</code>: 最大允许值</li>
<li><code>interval</code>: 统计时间间隔(仅用于 rate 类型)</li>
<li><code>step</code>: 插件执行时机，可选 <code>request</code> 或 <code>proxy_upstream</code>。若设置为<code>proxy_upstream</code>再增加对应的缓存插件，则可只针对转发至upstream的请求才会增加次数</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-12">配置示例<a href="#配置示例-12" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<ol>
<li>基于 Cookie 的并发限制:</li>
</ol>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.cookieBigTreeLimit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;limit&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = &quot;inflight&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tag = &quot;cookie&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key = &quot;bigtree&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max = 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">step = &quot;request&quot;</span><br></span></code></pre></div></div>
<ol start="2">
<li>基于请求头的并发限制:</li>
</ol>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.headerAppLimit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;limit&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = &quot;inflight&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tag = &quot;header&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key = &quot;X-App&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max = 10</span><br></span></code></pre></div></div>
<ol start="3">
<li>基于 URL 参数的频率限制:</li>
</ol>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.queryAppLimit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;limit&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = &quot;rate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tag = &quot;query&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key = &quot;app&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max = 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">interval = &quot;1s&quot;</span><br></span></code></pre></div></div>
<ol start="4">
<li>基于 IP 的频率限制:</li>
</ol>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.ipLimit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;limit&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = &quot;rate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tag = &quot;ip&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max = 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">interval = &quot;1m&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="补充说明">补充说明<a href="#补充说明" class="hash-link" aria-label="补充说明的直接链接" title="补充说明的直接链接">​</a></h3>
<ul>
<li>IP 获取优先级: X-Forwarded-For &gt; X-Real-Ip &gt; Remote Addr</li>
<li>当限制条件值为空时不进行限制</li>
<li>频率限制需要配置 <code>interval</code> 参数</li>
<li>并发限制不需要配置 <code>interval</code> 参数</li>
<li>rate限制现仅简单的分区间限制，每次仅计算上一区间的访问频率是否超限，后续调整为两个区间按权重计算</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Limit" src="/pingap-zh/assets/images/plugin-limit-65becc584e8ba4f355fc3478c2fe4167.jpg" width="1980" height="1206" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="iprestriction">IpRestriction<a href="#iprestriction" class="hash-link" aria-label="IpRestriction的直接链接" title="IpRestriction的直接链接">​</a></h2>
<p>提供基于 IP 地址的访问控制功能。支持设置允许(allow)或禁止(deny)两种模式，可配置单个 IP 地址或 CIDR 格式的网段，该插件固定执行在<code>request</code>阶段。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-13">配置示例<a href="#配置示例-13" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.ipDeny]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;ip_restriction&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip_list = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;192.168.1.1&quot;,      # 单个 IP 地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;1.1.1.0/24&quot;,       # CIDR 格式网段</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message = &quot;禁止该IP访问&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = &quot;deny&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-15">配置参数<a href="#配置参数-15" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>type</code>: 访问控制模式<!-- -->
<ul>
<li><code>allow</code>: 仅允许列表中的 IP 访问</li>
<li><code>deny</code>: 禁止列表中的 IP 访问</li>
</ul>
</li>
<li><code>ip_list</code>: IP 地址列表<!-- -->
<ul>
<li>支持单个 IP 地址</li>
<li>支持 CIDR 格式的网段</li>
</ul>
</li>
<li><code>message</code>: 访问被拒绝时的提示信息</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明-1">使用说明<a href="#使用说明-1" class="hash-link" aria-label="使用说明的直接链接" title="使用说明的直接链接">​</a></h3>
<ol>
<li>选择访问控制模式(允许/禁止)</li>
<li>添加需要控制的 IP 地址或网段</li>
<li>配置被拒绝访问时的提示信息</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Ip Restriction" src="/pingap-zh/assets/images/plugin-ip-restriction-422c90c9ffe03bd8391a44a873f34e9d.jpg" width="1982" height="1312" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="uarestriction">UaRestriction<a href="#uarestriction" class="hash-link" aria-label="UaRestriction的直接链接" title="UaRestriction的直接链接">​</a></h2>
<p>提供基于 User-Agent 的访问控制功能。支持设置允许(allow)或禁止(deny)两种模式，可使用正则表达式进行匹配。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-14">配置示例<a href="#配置示例-14" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.userAgentDeny]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;ua_restriction&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ua_list = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;go-http-client/1.1&quot;,                  # 精确匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;(Twitterspider)/(\\d+)\\.(\\d+)&quot;     # 正则匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message = &quot;禁止访问&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">step = &quot;request&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = &quot;deny&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-16">配置参数<a href="#配置参数-16" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>type</code>: 访问控制模式<!-- -->
<ul>
<li><code>allow</code>: 仅允许列表中匹配的 User-Agent</li>
<li><code>deny</code>: 禁止列表中匹配的 User-Agent</li>
</ul>
</li>
<li><code>ua_list</code>: User-Agent 匹配规则列表<!-- -->
<ul>
<li>支持精确匹配</li>
<li>支持正则表达式匹配</li>
</ul>
</li>
<li><code>message</code>: 访问被拒绝时的提示信息</li>
<li><code>step</code>: 插件执行时机，仅支持 <code>request</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明-2">使用说明<a href="#使用说明-2" class="hash-link" aria-label="使用说明的直接链接" title="使用说明的直接链接">​</a></h3>
<ol>
<li>选择访问控制模式(允许/禁止)</li>
<li>添加 User-Agent 匹配规则<!-- -->
<ul>
<li>直接填写完整的 User-Agent 字符串进行精确匹配</li>
<li>使用正则表达式匹配特定模式的 User-Agent</li>
</ul>
</li>
<li>配置被拒绝访问时的提示信息</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin User Agent Restriction" src="/pingap-zh/assets/images/plugin-ua-restriction-1c88d52d40cf96ab5822190cbf5a86e3.jpg" width="1942" height="1308" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="refererrestriction">RefererRestriction<a href="#refererrestriction" class="hash-link" aria-label="RefererRestriction的直接链接" title="RefererRestriction的直接链接">​</a></h2>
<p>提供基于 HTTP Referer 的访问控制功能。支持设置允许(allow)或禁止(deny)两种模式，可使用通配符(*)进行域名匹配，该插件固定执行在<code>request</code>阶段。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-15">配置示例<a href="#配置示例-15" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.referer]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;referer_restriction&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">referer_list = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;*.github.com&quot;,     # 匹配所有 github.com 的子域名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;example.com&quot;       # 精确匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message = &quot;禁止访问&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = &quot;allow&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-17">配置参数<a href="#配置参数-17" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>type</code>: 访问控制模式<!-- -->
<ul>
<li><code>allow</code>: 仅允许列表中匹配的 Referer</li>
<li><code>deny</code>: 禁止列表中匹配的 Referer</li>
</ul>
</li>
<li><code>referer_list</code>: Referer 匹配规则列表<!-- -->
<ul>
<li>支持精确匹配</li>
<li>支持使用 * 作为通配符匹配子域名</li>
</ul>
</li>
<li><code>message</code>: 访问被拒绝时的提示信息</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明-3">使用说明<a href="#使用说明-3" class="hash-link" aria-label="使用说明的直接链接" title="使用说明的直接链接">​</a></h3>
<ol>
<li>选择访问控制模式(允许/禁止)</li>
<li>添加 Referer 匹配规则<!-- -->
<ul>
<li>直接填写域名进行精确匹配</li>
<li>使用 <code>*.domain.com</code> 格式匹配所有子域名</li>
</ul>
</li>
<li>配置被拒绝访问时的提示信息</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Referer Restriction" src="/pingap-zh/assets/images/plugin-referer-restriction-0614ca00ede446f45ca56f5dacf5158b.jpg" width="1978" height="1208" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="csrf">CSRF<a href="#csrf" class="hash-link" aria-label="CSRF的直接链接" title="CSRF的直接链接">​</a></h2>
<p>提供跨站请求伪造(Cross-Site Request Forgery)防护功能。通过比对请求中的 cookie 和请求头中的 token 值来验证请求的合法性，该插件固定在<code>request</code>阶段执行。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-16">配置示例<a href="#配置示例-16" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.csrf]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;csrf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key = &quot;WjrXUG47wu&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name = &quot;x-csrf-token&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">token_path = &quot;/csrf-token&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ttl = &quot;1h&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-18">配置参数<a href="#配置参数-18" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>key</code>: 用于生成 token 的密钥</li>
<li><code>name</code>: CSRF token 的名称<!-- -->
<ul>
<li>用作 cookie 名和请求头名</li>
</ul>
</li>
<li><code>token_path</code>: 获取 token 的路径<!-- -->
<ul>
<li>访问该路径时会生成新的 token</li>
<li>同时设置同名的 cookie，启用 SameSite 保护</li>
</ul>
</li>
<li><code>ttl</code>: token 的有效期</li>
<li><code>step</code>: 插件执行时机，仅支持 <code>request</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="工作流程-1">工作流程<a href="#工作流程-1" class="hash-link" aria-label="工作流程的直接链接" title="工作流程的直接链接">​</a></h3>
<ol>
<li>
<p>获取 token:</p>
<ul>
<li>客户端访问 <code>token_path</code> 配置的路径</li>
<li>服务器生成 token 并设置到 cookie 中</li>
<li>cookie 设置为 SameSite 模式以增强安全性</li>
</ul>
</li>
<li>
<p>请求验证:</p>
<ul>
<li>客户端在请求头中携带 token</li>
<li>服务器比对请求头和 cookie 中的 token</li>
<li>若不一致则拒绝请求</li>
</ul>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Csrf" src="/pingap-zh/assets/images/plugin-csrf-41d4179053152b208abb8bc829ba3e36.jpg" width="1982" height="1062" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cors">CORS<a href="#cors" class="hash-link" aria-label="CORS的直接链接" title="CORS的直接链接">​</a></h2>
<p>提供跨域资源共享(Cross-Origin Resource Sharing)配置功能，用于控制浏览器跨域访问策略，该插件固定在<code>request</code>阶段执行。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-17">配置示例<a href="#配置示例-17" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.cors]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allow_credentials = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allow_headers = &quot;Content-Type, X-User-Id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allow_methods = &quot;GET, POST, OPTIONS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allow_origin = &quot;$http_origin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;cors&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expose_headers = &quot;Content-Type, X-Device&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_age = &quot;1h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path = &quot;^/api&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-19">配置参数<a href="#配置参数-19" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>allow_origin</code>: 允许跨域请求的源<!-- -->
<ul>
<li>可以指定具体域名，如 <code>https://example.com</code></li>
<li>设置为 <code>$http_origin</code> 表示允许请求来源，不建议在生产环境使用</li>
<li>建议明确指定允许的域名列表，不建议直接使用<code>*</code></li>
</ul>
</li>
<li><code>allow_credentials</code>: 是否允许携带认证信息<!-- -->
<ul>
<li>包括 Cookie、HTTP 认证及客户端 SSL 证书</li>
</ul>
</li>
<li><code>allow_methods</code>: 允许的 HTTP 请求方法<!-- -->
<ul>
<li>多个方法用逗号分隔，如 <code>GET, POST, OPTIONS</code></li>
</ul>
</li>
<li><code>allow_headers</code>: 允许的自定义请求头，若不设置则默认所有<!-- -->
<ul>
<li>多个请求头用逗号分隔</li>
</ul>
</li>
<li><code>expose_headers</code>: 允许浏览器访问的响应头<!-- -->
<ul>
<li>默认情况下浏览器只能访问基本响应头</li>
<li>通过此参数可以暴露自定义响应头</li>
</ul>
</li>
<li><code>max_age</code>: 预检请求结果的缓存时间</li>
<li><code>path</code>: CORS 配置生效的路径范围<!-- -->
<ul>
<li>支持正则表达式匹配</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="安全建议">安全建议<a href="#安全建议" class="hash-link" aria-label="安全建议的直接链接" title="安全建议的直接链接">​</a></h3>
<ol>
<li>避免使用 <code>$http_origin</code>，应明确指定允许的域名</li>
<li>仅配置必要的请求方法和请求头</li>
<li>谨慎配置 <code>allow_credentials</code>，可能带来安全风险</li>
<li>合理设置 <code>max_age</code> 以平衡性能和安全性</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Cors" src="/pingap-zh/assets/images/plugin-cors-5d47a63ecbbd547499a4e1f246b14de9.jpg" width="1980" height="1392" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="responseheaders">ResponseHeaders<a href="#responseheaders" class="hash-link" aria-label="ResponseHeaders的直接链接" title="ResponseHeaders的直接链接">​</a></h2>
<p>提供 HTTP 响应头的管理功能，支持添加、设置和删除响应头，该插件固定执行在<code>response</code>阶段。支持使用变量引用:</p>
<ul>
<li><code>$hostname</code>: 引用服务器主机名</li>
<li><code>$变量名</code>: 引用环境变量值</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置示例-18">配置示例<a href="#配置示例-18" class="hash-link" aria-label="配置示例的直接链接" title="配置示例的直接链接">​</a></h3>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.commonResponseHeaders]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_headers = [&quot;X-Server:pingap&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;response_headers&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remove_headers = [&quot;X-User&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set_headers = [&quot;X-Response-Id:123&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rename_headers = [&quot;x-old-header:x-new-header&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set_headers_not_exists = [&quot;x-server-ip:192.168.1.1&quot;]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-20">配置参数<a href="#配置参数-20" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>add_headers</code>: 需要添加的响应头<!-- -->
<ul>
<li>不会覆盖已存在的同名响应头</li>
</ul>
</li>
<li><code>set_headers</code>: 需要设置的响应头<!-- -->
<ul>
<li>会覆盖已存在的同名响应头</li>
</ul>
</li>
<li><code>remove_headers</code>: 需要删除的响应头<!-- -->
<ul>
<li>删除指定名称的响应头</li>
</ul>
</li>
<li><code>rename_headers</code>: 需要重命名的响应头</li>
<li><code>set_headers_not_exists</code>: 如果响应头不存在才设置</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="执行顺序">执行顺序<a href="#执行顺序" class="hash-link" aria-label="执行顺序的直接链接" title="执行顺序的直接链接">​</a></h3>
<p>操作按以下顺序执行:</p>
<ol>
<li><code>add_headers</code>: 添加新的响应头</li>
<li><code>remove_headers</code>: 删除指定的响应头</li>
<li><code>set_headers</code>: 设置(覆盖)响应头</li>
<li><code>rename_headers</code>: 重命名响应头</li>
<li><code>set_headers_not_exists</code>: 设置不存在的响应头</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明-4">使用说明<a href="#使用说明-4" class="hash-link" aria-label="使用说明的直接链接" title="使用说明的直接链接">​</a></h3>
<ol>
<li>根据需要配置要添加、设置或删除的响应头</li>
<li>每个配置项都是可选的，不需要的可以不设置</li>
<li>响应头的值可以使用变量:<!-- -->
<ul>
<li><code>$hostname</code> 获取服务器主机名</li>
<li><code>$VARIABLE_NAME</code> 获取环境变量值</li>
</ul>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Pingap Plugin Response Headers" src="/pingap-zh/assets/images/plugin-response-headers-eceba3cc3c0dfa694a9cdd4146060020.jpg" width="1976" height="1250" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="subfilter">SubFilter<a href="#subfilter" class="hash-link" aria-label="SubFilter的直接链接" title="SubFilter的直接链接">​</a></h2>
<p>支持常规或正则形式的文本匹配，用于替换http的响应内容，该插件固定执行在<code>response</code>阶段。</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[plugins.textReplace]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category = &quot;sub_filter&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filters = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;subs_filter &#x27;mobile&#x27; &#x27;Mobile&#x27; ig&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;sub_filter &#x27;online&#x27; &#x27;ONLINE&#x27;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path = &quot;^/api/&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置参数-21">配置参数<a href="#配置参数-21" class="hash-link" aria-label="配置参数的直接链接" title="配置参数的直接链接">​</a></h3>
<ul>
<li><code>path</code>: 匹配需要对响应改造的路径，按正则匹配</li>
<li><code>filters</code>: 配置内容替换规则，可以配置多条规则，支持两种类型<!-- -->
<ul>
<li><code>subs_filter</code>: 正则匹配替换模式</li>
<li><code>sub_filter</code>: 普通文本替换模式</li>
</ul>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/plugin.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/pingap-zh/docs/certificate"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">轻松管理 HTTPS 证书</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/pingap-zh/docs/docker"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">使用 Docker 部署 Pingap</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#插件执行时点" class="table-of-contents__link toc-highlight">插件执行时点</a></li><li><a href="#stats-性能统计插件" class="table-of-contents__link toc-highlight">Stats 性能统计插件</a><ul><li><a href="#配置示例" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#使用方式" class="table-of-contents__link toc-highlight">使用方式</a></li></ul></li><li><a href="#ping" class="table-of-contents__link toc-highlight">Ping</a><ul><li><a href="#配置参数-1" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#使用方式-1" class="table-of-contents__link toc-highlight">使用方式</a></li></ul></li><li><a href="#admin" class="table-of-contents__link toc-highlight">Admin</a><ul><li><a href="#配置参数-2" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#使用方式-2" class="table-of-contents__link toc-highlight">使用方式</a></li></ul></li><li><a href="#directory" class="table-of-contents__link toc-highlight">Directory</a><ul><li><a href="#配置示例-1" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-3" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#使用方式-3" class="table-of-contents__link toc-highlight">使用方式</a></li></ul></li><li><a href="#mock" class="table-of-contents__link toc-highlight">Mock</a><ul><li><a href="#配置示例-2" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-4" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#使用方式-4" class="table-of-contents__link toc-highlight">使用方式</a></li></ul></li><li><a href="#redirect" class="table-of-contents__link toc-highlight">Redirect</a><ul><li><a href="#配置示例-3" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-5" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#使用方式-5" class="table-of-contents__link toc-highlight">使用方式</a></li></ul></li><li><a href="#cache" class="table-of-contents__link toc-highlight">Cache</a><ul><li><a href="#配置示例-4" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-6" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#界面配置" class="table-of-contents__link toc-highlight">界面配置</a></li></ul></li><li><a href="#requestid" class="table-of-contents__link toc-highlight">RequestId</a><ul><li><a href="#配置示例-5" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-7" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#使用场景" class="table-of-contents__link toc-highlight">使用场景</a></li></ul></li><li><a href="#compression" class="table-of-contents__link toc-highlight">Compression</a><ul><li><a href="#工作原理" class="table-of-contents__link toc-highlight">工作原理</a></li><li><a href="#配置示例-6" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-8" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#内置配置" class="table-of-contents__link toc-highlight">内置配置</a></li><li><a href="#执行阶段" class="table-of-contents__link toc-highlight">执行阶段</a></li></ul></li><li><a href="#acceptencoding" class="table-of-contents__link toc-highlight">AcceptEncoding</a><ul><li><a href="#配置示例-7" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-9" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#执行阶段-1" class="table-of-contents__link toc-highlight">执行阶段</a></li></ul></li><li><a href="#keyauth" class="table-of-contents__link toc-highlight">KeyAuth</a><ul><li><a href="#配置示例-8" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-10" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#界面配置-1" class="table-of-contents__link toc-highlight">界面配置</a></li></ul></li><li><a href="#basicauth" class="table-of-contents__link toc-highlight">BasicAuth</a><ul><li><a href="#配置示例-9" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-11" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#使用说明" class="table-of-contents__link toc-highlight">使用说明</a></li></ul></li><li><a href="#jwt" class="table-of-contents__link toc-highlight">JWT</a><ul><li><a href="#配置示例-10" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-12" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#工作流程" class="table-of-contents__link toc-highlight">工作流程</a></li></ul></li><li><a href="#combinedauth" class="table-of-contents__link toc-highlight">CombinedAuth</a><ul><li><a href="#配置示例-11" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-13" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#认证流程" class="table-of-contents__link toc-highlight">认证流程</a></li></ul></li><li><a href="#limit" class="table-of-contents__link toc-highlight">Limit</a><ul><li><a href="#配置参数-14" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#配置示例-12" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#补充说明" class="table-of-contents__link toc-highlight">补充说明</a></li></ul></li><li><a href="#iprestriction" class="table-of-contents__link toc-highlight">IpRestriction</a><ul><li><a href="#配置示例-13" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-15" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#使用说明-1" class="table-of-contents__link toc-highlight">使用说明</a></li></ul></li><li><a href="#uarestriction" class="table-of-contents__link toc-highlight">UaRestriction</a><ul><li><a href="#配置示例-14" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-16" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#使用说明-2" class="table-of-contents__link toc-highlight">使用说明</a></li></ul></li><li><a href="#refererrestriction" class="table-of-contents__link toc-highlight">RefererRestriction</a><ul><li><a href="#配置示例-15" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-17" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#使用说明-3" class="table-of-contents__link toc-highlight">使用说明</a></li></ul></li><li><a href="#csrf" class="table-of-contents__link toc-highlight">CSRF</a><ul><li><a href="#配置示例-16" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-18" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#工作流程-1" class="table-of-contents__link toc-highlight">工作流程</a></li></ul></li><li><a href="#cors" class="table-of-contents__link toc-highlight">CORS</a><ul><li><a href="#配置示例-17" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-19" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#安全建议" class="table-of-contents__link toc-highlight">安全建议</a></li></ul></li><li><a href="#responseheaders" class="table-of-contents__link toc-highlight">ResponseHeaders</a><ul><li><a href="#配置示例-18" class="table-of-contents__link toc-highlight">配置示例</a></li><li><a href="#配置参数-20" class="table-of-contents__link toc-highlight">配置参数</a></li><li><a href="#执行顺序" class="table-of-contents__link toc-highlight">执行顺序</a></li><li><a href="#使用说明-4" class="table-of-contents__link toc-highlight">使用说明</a></li></ul></li><li><a href="#subfilter" class="table-of-contents__link toc-highlight">SubFilter</a><ul><li><a href="#配置参数-21" class="table-of-contents__link toc-highlight">配置参数</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024-2025 Tree Xie.</div></div></div></footer></div>
</body>
</html>