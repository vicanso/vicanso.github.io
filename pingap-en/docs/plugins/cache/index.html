<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-plugins/cache" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Cache | Pingap</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://vicanso.github.io/pingap-en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://vicanso.github.io/pingap-en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://vicanso.github.io/pingap-en/docs/plugins/cache"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Cache | Pingap"><meta data-rh="true" name="description" content="Dramatically improve the performance of frequently accessed APIs, reduce latency, and effectively lighten the load on backend services by caching responses from upstream services. Supports advanced features like dual-layer memory and file caching, cache eviction, and cache purging."><meta data-rh="true" property="og:description" content="Dramatically improve the performance of frequently accessed APIs, reduce latency, and effectively lighten the load on backend services by caching responses from upstream services. Supports advanced features like dual-layer memory and file caching, cache eviction, and cache purging."><link data-rh="true" rel="icon" href="/pingap-en/img/pingap.png"><link data-rh="true" rel="canonical" href="https://vicanso.github.io/pingap-en/docs/plugins/cache"><link data-rh="true" rel="alternate" href="https://vicanso.github.io/pingap-en/docs/plugins/cache" hreflang="en"><link data-rh="true" rel="alternate" href="https://vicanso.github.io/pingap-en/docs/plugins/cache" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QJ6H7139JP-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Plugin Overview and Index","item":"https://vicanso.github.io/pingap-en/docs/plugins/"},{"@type":"ListItem","position":2,"name":"Cache","item":"https://vicanso.github.io/pingap-en/docs/plugins/cache"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="Pingap" href="/pingap-en/opensearch.xml"><link rel="stylesheet" href="/pingap-en/assets/css/styles.3cf97c19.css">
<script src="/pingap-en/assets/js/runtime~main.866935b6.js" defer="defer"></script>
<script src="/pingap-en/assets/js/main.e099d997.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/pingap-en/"><div class="navbar__logo"><img src="/pingap-en/img/pingap.png" alt="Pingap Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/pingap-en/img/pingap.png" alt="Pingap Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Pingap</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pingap-en/docs/introduction">Documentation</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="http://pingap.io/pingap-zh/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">中文<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/vicanso/pingap" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-en/docs/introduction"><span title="What is Pingap?" class="linkLabel_WmDU">What is Pingap?</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-en/docs/getting_started"><span title="Getting Started Tutorial" class="linkLabel_WmDU">Getting Started Tutorial</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-en/docs/argument"><span title="Command-Line Arguments and Environment Variables" class="linkLabel_WmDU">Command-Line Arguments and Environment Variables</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-en/docs/config"><span title="Detailed Configuration Reference" class="linkLabel_WmDU">Detailed Configuration Reference</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-en/docs/log"><span title="Access Log Formatting" class="linkLabel_WmDU">Access Log Formatting</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-en/docs/certificate"><span title="Easily Manage HTTPS Certificates" class="linkLabel_WmDU">Easily Manage HTTPS Certificates</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-en/docs/plugin"><span title="Plugin System" class="linkLabel_WmDU">Plugin System</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/pingap-en/docs/plugins/"><span title="Plugin Overview and Index" class="categoryLinkLabel_W154">Plugin Overview and Index</span></a><button aria-label="Collapse sidebar category &#x27;Plugin Overview and Index&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/accept-encoding"><span title="Accept Encoding Plugin" class="linkLabel_WmDU">Accept Encoding Plugin</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/basic-auth"><span title="Basic Auth" class="linkLabel_WmDU">Basic Auth</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/pingap-en/docs/plugins/cache"><span title="Cache" class="linkLabel_WmDU">Cache</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/combined-auth"><span title="Combined Auth" class="linkLabel_WmDU">Combined Auth</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/compression"><span title="Response Compression" class="linkLabel_WmDU">Response Compression</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/cors"><span title="Cross-Origin Resource Sharing (CORS)" class="linkLabel_WmDU">Cross-Origin Resource Sharing (CORS)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/csrf"><span title="CSRF Protection" class="linkLabel_WmDU">CSRF Protection</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/directory"><span title="Static File Service (Directory)" class="linkLabel_WmDU">Static File Service (Directory)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/ip-restriction"><span title="IP Restriction" class="linkLabel_WmDU">IP Restriction</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/jwt"><span title="JWT Authentication (JWT)" class="linkLabel_WmDU">JWT Authentication (JWT)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/key-auth"><span title="API Key Auth" class="linkLabel_WmDU">API Key Auth</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/limit"><span title="Rate Limit" class="linkLabel_WmDU">Rate Limit</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/mock"><span title="Mock Service" class="linkLabel_WmDU">Mock Service</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/ping"><span title="Health Check (Ping)" class="linkLabel_WmDU">Health Check (Ping)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/redirect"><span title="HTTP Redirect" class="linkLabel_WmDU">HTTP Redirect</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/referer-restriction"><span title="Referer Restriction" class="linkLabel_WmDU">Referer Restriction</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/request-id"><span title="Request ID" class="linkLabel_WmDU">Request ID</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/response-headers"><span title="Response Headers" class="linkLabel_WmDU">Response Headers</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/sub-filter"><span title="Content Substitution (Sub Filter)" class="linkLabel_WmDU">Content Substitution (Sub Filter)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/traffic-splitting"><span title="Traffic Splitting" class="linkLabel_WmDU">Traffic Splitting</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pingap-en/docs/plugins/ua-restriction"><span title="User-Agent Restriction" class="linkLabel_WmDU">User-Agent Restriction</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-en/docs/docker"><span title="Deploying Pingap with Docker" class="linkLabel_WmDU">Deploying Pingap with Docker</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-en/docs/question"><span title="Frequently Asked Questions (FAQ)" class="linkLabel_WmDU">Frequently Asked Questions (FAQ)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pingap-en/docs/performance"><span title="Performance Testing" class="linkLabel_WmDU">Performance Testing</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/pingap-en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/pingap-en/docs/plugins/"><span>Plugin Overview and Index</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Cache</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Cache Plugin</h1></header>
<p>The <code>cache</code> plugin is a powerful and highly configurable HTTP caching plugin. It can store responses from upstream services in Pingap, allowing subsequent identical requests to be served directly from the cache without needing to contact the backend service again.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="feature-introduction">Feature Introduction<a href="#feature-introduction" class="hash-link" aria-label="Direct link to Feature Introduction" title="Direct link to Feature Introduction" translate="no">​</a></h2>
<p>This plugin implements comprehensive HTTP caching logic and offers several advanced features to meet the demands of complex production environments:</p>
<ul>
<li class=""><strong>Intelligent Caching Strategy</strong>: Adheres to HTTP <code>Cache-Control</code> response headers (like <code>max-age</code>, <code>private</code>, <code>no-store</code>) to automatically determine if a response can be cached and for how long.</li>
<li class=""><strong>Multiple Cache Backends</strong>: Supports storing cache simultaneously in <strong>memory</strong> and on the <strong>filesystem</strong>, balancing access speed with storage capacity.</li>
<li class=""><strong>Cache Eviction</strong>: When the memory cache reaches its limit, it uses an LRU (Least Recently Used) algorithm to automatically remove the oldest items. File cache does not require eviction to be enabled.</li>
<li class=""><strong>Cache Purge</strong>: Supports <strong>proactively clearing</strong> specific cache entries by sending a special <code>PURGE</code> HTTP request, with access control via an IP whitelist.</li>
<li class=""><strong>Cache Stampede Protection (Lock)</strong>: In high-concurrency scenarios, for the first request of a resource, only one request is allowed to go to the origin. Other requests will wait for the result of the first one, effectively preventing the backend from being overwhelmed when a cache item expires (also known as the &quot;thundering herd&quot; or &quot;dogpiling&quot; effect).</li>
<li class=""><strong>Vary Cache</strong>: For instance, enabling the compression plugin will include <code>Accept-Encoding</code> as part of the cache key, allowing different compressed versions of the cache to be stored for the same <code>URL</code>, reducing the performance overhead of data compression.</li>
<li class=""><strong>Flexible Control Options</strong>: You can override the backend&#x27;s caching policy through configuration or set rules to bypass caching for certain requests.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="use-cases">Use Cases<a href="#use-cases" class="hash-link" aria-label="Direct link to Use Cases" title="Direct link to Use Cases" translate="no">​</a></h2>
<ul>
<li class=""><strong>High-Frequency Read APIs</strong>: For APIs that are read frequently but whose content does not change often (e.g., fetching product lists, article details, configuration info), enabling the cache can lead to significant performance gains.</li>
<li class=""><strong>Static and Semi-Static Assets</strong>: Although there are dedicated static file serving plugins, the cache plugin is also very effective for assets generated by backend services that do not change often (e.g., dynamically generated CSS, profile pictures).</li>
<li class=""><strong>Protecting Backend Services</strong>: During traffic spikes, the cache can act as a solid barrier, absorbing the vast majority of repetitive read requests and protecting backend databases and services from being overwhelmed.</li>
<li class=""><strong>Reducing External API Call Costs</strong>: If your service relies on third-party APIs that charge per call, caching their responses can significantly reduce costs.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration-parameters">Configuration Parameters<a href="#configuration-parameters" class="hash-link" aria-label="Direct link to Configuration Parameters" title="Direct link to Configuration Parameters" translate="no">​</a></h2>
<p>Configuration is done in the <code>plugin.cache.toml</code> file.</p>
<table><thead><tr><th style="text-align:left">Parameter</th><th style="text-align:left">Type</th><th style="text-align:left">Required</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left"><strong><code>directory</code></strong></td><td style="text-align:left">String</td><td style="text-align:left">No</td><td style="text-align:left">Specifies the <strong>disk directory</strong> for storing cache files. If this is configured, file caching is enabled; otherwise, memory caching is used. <br>Note that if multiple cache plugins are configured for memory caching, they share the same cache, which is initialized by the first plugin that is invoked.</td></tr><tr><td style="text-align:left"><strong><code>max_size</code></strong></td><td style="text-align:left">String</td><td style="text-align:left">No</td><td style="text-align:left">Specifies the maximum capacity of the <strong>memory cache</strong>, e.g., <code>&quot;128MB&quot;</code>, <code>&quot;1GB&quot;</code>.</td></tr><tr><td style="text-align:left"><strong><code>eviction</code></strong></td><td style="text-align:left">Boolean</td><td style="text-align:left">No</td><td style="text-align:left">Whether to enable the LRU-based <strong>cache eviction</strong> mechanism. Typically used with <code>max_size</code>.</td></tr><tr><td style="text-align:left"><code>max_ttl</code></td><td style="text-align:left">String</td><td style="text-align:left">No</td><td style="text-align:left"><strong>Forcibly</strong> sets the maximum cache validity period (e.g., <code>&quot;1h&quot;</code>, <code>&quot;10m&quot;</code>). This setting will <strong>override</strong> the <code>Cache-Control</code> header from the upstream service&#x27;s response.</td></tr><tr><td style="text-align:left"><code>max_file_size</code></td><td style="text-align:left">String</td><td style="text-align:left">No</td><td style="text-align:left">The maximum size of a single response body that can be cached, e.g., <code>&quot;1MB&quot;</code>. Responses larger than this will not be cached.</td></tr><tr><td style="text-align:left"><code>check_cache_control</code></td><td style="text-align:left">Boolean</td><td style="text-align:left">No</td><td style="text-align:left"><code>false</code>. Whether to check the <code>Cache-Control</code> header. If <code>true</code> and the response has no <code>Cache-Control</code> header, it will not be cached.</td></tr><tr><td style="text-align:left"><code>namespace</code></td><td style="text-align:left">String</td><td style="text-align:left">No</td><td style="text-align:left">Assigns a namespace to cache items, used to isolate different <code>Location</code>s or types of caches.</td></tr><tr><td style="text-align:left"><code>headers</code></td><td style="text-align:left">Array of Strings</td><td style="text-align:left">No</td><td style="text-align:left">Specifies a set of request header names whose values will be included in the Cache Key calculation. Used to implement Vary caching.</td></tr><tr><td style="text-align:left"><code>lock</code></td><td style="text-align:left">String</td><td style="text-align:left">No</td><td style="text-align:left">Enables <strong>cache stampede protection</strong> and sets the lock wait timeout. Optional values are <code>&quot;1s&quot;</code>, <code>&quot;2s&quot;</code>, <code>&quot;3s&quot;</code>.</td></tr><tr><td style="text-align:left"><code>purge_ip_list</code></td><td style="text-align:left">Array of Strings</td><td style="text-align:left">No</td><td style="text-align:left">An IP whitelist. Only <code>PURGE</code> requests from these IPs are allowed to clear the cache.</td></tr><tr><td style="text-align:left"><code>skip</code></td><td style="text-align:left">String</td><td style="text-align:left">No</td><td style="text-align:left">A regular expression to match against the request URI. Any request that matches will <strong>bypass</strong> the caching logic.</td></tr></tbody></table>
<p>The <code>directory</code> parameter supports two formats:</p>
<ul>
<li class=""><code>memory</code>: Memory cache, using memory as the cache backend. It supports an LRU eviction mechanism and is the default if not configured. The format is <code>memory://?max_size=100MB</code>. If <code>max_size</code> is not specified, it defaults to 1/4 of available memory. If set to <code>max_size=10</code>, it will initialize the memory cache using <code>10%</code> of available memory.</li>
<li class=""><code>file</code>: File cache, using files as the cache backend. It supports an LRU eviction mechanism and is the default if a path is provided. The format is <code>/var/cache/pingap/articles?levels=1:2&amp;inactive=7d&amp;reading_max=1000&amp;writing_max=500&amp;cache_max=100&amp;cache_file_max_size=1MB</code>. The parameters are as follows:</li>
</ul>
<table><thead><tr><th style="text-align:left">Parameter</th><th style="text-align:left">Type</th><th style="text-align:left">Default</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left">levels</td><td style="text-align:left">String</td><td style="text-align:left">0</td><td style="text-align:left">Sets the subdirectory levels for the cache, default is not set. This distributes cache files across multiple subdirectory levels to avoid performance degradation from too many files in a single directory. For high-traffic caches, it is strongly recommended to set this to <code>1:2</code>.</td></tr><tr><td style="text-align:left">inactive</td><td style="text-align:left">String</td><td style="text-align:left">&quot;48h&quot;</td><td style="text-align:left">Inactive file cleanup threshold. If a cache file is not accessed within this time, it is considered inactive and may be cleaned up. The format is a time string, e.g., &quot;7d&quot; (7 days), &quot;24h&quot; (24 hours).</td></tr><tr><td style="text-align:left">reading_max</td><td style="text-align:left">Integer</td><td style="text-align:left">1000</td><td style="text-align:left">The maximum number of concurrent reads allowed for cache files.</td></tr><tr><td style="text-align:left">writing_max</td><td style="text-align:left">Integer</td><td style="text-align:left">1000</td><td style="text-align:left">The maximum number of concurrent writes allowed for cache files.</td></tr><tr><td style="text-align:left">cache_max</td><td style="text-align:left">Integer</td><td style="text-align:left">0</td><td style="text-align:left">The maximum number of files that can be held in the in-memory hot cache. This is a second-level cache (tinyLFU) in memory used for storing the most popular small files for extreme read performance.</td></tr><tr><td style="text-align:left">cache_file_max_size</td><td style="text-align:left">Integer (Bytes)</td><td style="text-align:left">1MB</td><td style="text-align:left">The maximum size of a single file allowed to enter the in-memory hot cache. Files larger than this will only be stored on disk and will not enter the memory hot cache.</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="complete-example">Complete Example<a href="#complete-example" class="hash-link" aria-label="Direct link to Complete Example" title="Direct link to Complete Example" translate="no">​</a></h2>
<p><strong>Goal</strong>: Enable caching for read-only APIs under the <code>/api/articles/</code> path.</p>
<ul>
<li class="">Use a dual-layer memory and file cache.</li>
<li class="">Store different cache versions based on whether the client supports <code>gzip</code> compression.</li>
<li class="">Enable cache eviction and cache stampede protection.</li>
<li class="">Only allow internal IPs to clear the cache.</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-configure-the-plugin-plugincache-articlestoml">1. Configure the plugin (<code>plugin.cache-articles.toml</code>)<a href="#1-configure-the-plugin-plugincache-articlestoml" class="hash-link" aria-label="Direct link to 1-configure-the-plugin-plugincache-articlestoml" title="Direct link to 1-configure-the-plugin-plugincache-articlestoml" translate="no">​</a></h4>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Enable cache eviction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eviction = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set memory cache limit to 256MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_size = &quot;256MB&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Store file cache in the specified directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">directory = &quot;/var/cache/pingap/articles&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Add the Accept-Encoding request header to the cache key to differentiate gzip and non-gzip caches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">headers = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Accept-Encoding&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Enable cache stampede protection with a 2-second lock wait time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lock = &quot;2s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Force cache to expire after a maximum of 1 hour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_ttl = &quot;1h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Limit caching to files no larger than 1MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_file_size = &quot;1MB&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Only allow requests from the internal network to clear the cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">purge_ip_list = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;127.0.0.1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;10.0.0.0/8&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/plugins/cache.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/pingap-en/docs/plugins/basic-auth"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Basic Auth</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/pingap-en/docs/plugins/combined-auth"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Combined Auth</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#feature-introduction" class="table-of-contents__link toc-highlight">Feature Introduction</a></li><li><a href="#use-cases" class="table-of-contents__link toc-highlight">Use Cases</a></li><li><a href="#configuration-parameters" class="table-of-contents__link toc-highlight">Configuration Parameters</a></li><li><a href="#complete-example" class="table-of-contents__link toc-highlight">Complete Example</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024-2025 Tree Xie.</div></div></div></footer></div>
</body>
</html>