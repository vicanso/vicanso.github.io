"use strict";(self.webpackChunkpingap=self.webpackChunkpingap||[]).push([[6370],{3120:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>a,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"plugins/compression","title":"Response Compression","description":"Dynamically compress response bodies with modern algorithms like Gzip, Brotli, and Zstd to significantly reduce data transfer size, speed up website and API loading, and save on bandwidth costs.","source":"@site/docs/plugins/compression.md","sourceDirName":"plugins","slug":"/plugins/compression","permalink":"/pingap-en/docs/plugins/compression","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/plugins/compression.md","tags":[],"version":"current","sidebarPosition":85,"frontMatter":{"sidebar_position":85,"title":"Response Compression","description":"Dynamically compress response bodies with modern algorithms like Gzip, Brotli, and Zstd to significantly reduce data transfer size, speed up website and API loading, and save on bandwidth costs."},"sidebar":"tutorialSidebar","previous":{"title":"Combined Auth","permalink":"/pingap-en/docs/plugins/combined-auth"},"next":{"title":"Cross-Origin Resource Sharing (CORS)","permalink":"/pingap-en/docs/plugins/cors"}}');var t=n(4848),r=n(8453);const l={sidebar_position:85,title:"Response Compression",description:"Dynamically compress response bodies with modern algorithms like Gzip, Brotli, and Zstd to significantly reduce data transfer size, speed up website and API loading, and save on bandwidth costs."},o="Response Compression Plugin",c={},d=[{value:"Feature Introduction",id:"feature-introduction",level:2},{value:"Working Modes",id:"working-modes",level:2},{value:"Configuration Parameters",id:"configuration-parameters",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Access Effects",id:"access-effects",level:3},{value:"Precautions",id:"precautions",level:2}];function h(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"response-compression-plugin",children:"Response Compression Plugin"})}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"compression"})," plugin automatically performs ",(0,t.jsx)(s.strong,{children:"dynamic compression"})," on response bodies sent to the client, based on the client's capabilities. By reducing the size of response data, it can effectively improve loading speeds, enhance user experience, and save server bandwidth costs."]}),"\n",(0,t.jsx)(s.h2,{id:"feature-introduction",children:"Feature Introduction"}),"\n",(0,t.jsx)(s.p,{children:"The plugin intelligently negotiates the compression algorithm. Its workflow is as follows:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Check Client Capabilities"}),": The plugin reads the ",(0,t.jsx)(s.code,{children:"Accept-Encoding"})," field from the request header to understand which compression algorithms the client supports (e.g., ",(0,t.jsx)(s.code,{children:"gzip"}),", ",(0,t.jsx)(s.code,{children:"br"}),", ",(0,t.jsx)(s.code,{children:"zstd"}),")."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select Optimal Algorithm"}),": Based on your configured compression levels, the plugin prioritizes the algorithm with the highest compression ratio (Priority: ",(0,t.jsx)(s.strong,{children:"Zstd > Brotli > Gzip"}),") for negotiation with the client."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Dynamic Compression"}),": When sending the response to the client, the plugin compresses the response body in real-time in a streaming fashion."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Set Response Headers"}),": It automatically adds the ",(0,t.jsx)(s.code,{children:"Content-Encoding"})," header to the response (e.g., ",(0,t.jsx)(s.code,{children:"Content-Encoding: br"}),") and removes ",(0,t.jsx)(s.code,{children:"Content-Length"}),", switching to Chunked Transfer Encoding."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"This plugin supports two working modes to adapt to different application scenarios."}),"\n",(0,t.jsx)(s.h2,{id:"working-modes",children:"Working Modes"}),"\n",(0,t.jsxs)(s.p,{children:["You can select the plugin's working mode using the ",(0,t.jsx)(s.code,{children:"mode"})," parameter:"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsxs)(s.strong,{children:[(0,t.jsx)(s.code,{children:"response"})," (Default Mode)"]}),"\nThis is the standard reverse proxy compression mode. ",(0,t.jsx)(s.code,{children:"Pingap"})," will ",(0,t.jsx)(s.strong,{children:"compress"})," the response based on the client's capabilities as it is sent to the client."]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Pros"}),": Offers the best compatibility. Regardless of whether the upstream service or cache is compressed, ",(0,t.jsx)(s.code,{children:"Pingap"})," can provide the optimal compression format for the client. You can also run other plugins on ",(0,t.jsx)(s.code,{children:"Pingap"})," that need to read the response body (e.g., content replacement)."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Cons"}),": There is a performance cost for compressing each response, which is not suitable for scenarios where compressed content is already cached."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsxs)(s.strong,{children:[(0,t.jsx)(s.code,{children:"upstream"})," Mode"]}),"\nIn this mode, ",(0,t.jsx)(s.code,{children:"Pingap"})," ",(0,t.jsx)(s.strong,{children:"compresses"})," the data as it is received from the upstream, based on the client's capabilities. This is suitable for use with the ",(0,t.jsx)(s.code,{children:"Accept-Encoding"})," plugin in cacheable request scenarios."]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Pros"}),": Allows data to be compressed before caching, so subsequent requests can directly fetch the compressed cached data."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Cons"}),": Requires you to correctly configure the cache and the ",(0,t.jsx)(s.code,{children:"Accept-Encoding"})," module, which must support and be correctly configured for content compression."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"configuration-parameters",children:"Configuration Parameters"}),"\n",(0,t.jsxs)(s.p,{children:["Configuration is done in the ",(0,t.jsx)(s.code,{children:"plugin.compression.toml"})," file."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"Parameter"}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"Type"}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"Required"}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"Default"}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"mode"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"String"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"No"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:'"response"'})}),(0,t.jsxs)(s.td,{style:{textAlign:"left"},children:["Working mode. Optional values are ",(0,t.jsx)(s.code,{children:'"response"'})," or ",(0,t.jsx)(s.code,{children:'"upstream"'}),"."]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"gzip_level"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Integer"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"No"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"0"})}),(0,t.jsxs)(s.td,{style:{textAlign:"left"},children:["Gzip compression level. Range ",(0,t.jsx)(s.code,{children:"1"})," - ",(0,t.jsx)(s.code,{children:"9"}),". ",(0,t.jsx)(s.code,{children:"0"})," disables Gzip."]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"br_level"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Integer"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"No"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"0"})}),(0,t.jsxs)(s.td,{style:{textAlign:"left"},children:["Brotli compression level. Range ",(0,t.jsx)(s.code,{children:"1"})," - ",(0,t.jsx)(s.code,{children:"11"}),". ",(0,t.jsx)(s.code,{children:"0"})," disables Brotli."]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"zstd_level"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Integer"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"No"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"0"})}),(0,t.jsxs)(s.td,{style:{textAlign:"left"},children:["Zstd compression level. Range ",(0,t.jsx)(s.code,{children:"1"})," - ",(0,t.jsx)(s.code,{children:"22"}),". ",(0,t.jsx)(s.code,{children:"0"})," disables Zstd."]})]})]})]}),"\n",(0,t.jsxs)(s.p,{children:["\ud83d\udca1 ",(0,t.jsx)(s.strong,{children:"How to choose a compression level?"})]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Lower levels (e.g., Gzip: ",(0,t.jsx)(s.code,{children:"1-3"}),", Brotli: ",(0,t.jsx)(s.code,{children:"1-4"}),") consume less CPU but have lower compression ratios."]}),"\n",(0,t.jsxs)(s.li,{children:["Higher levels (e.g., Gzip: ",(0,t.jsx)(s.code,{children:"6-9"}),", Brotli: ",(0,t.jsx)(s.code,{children:"8-11"}),") have higher compression ratios but consume more CPU."]}),"\n",(0,t.jsxs)(s.li,{children:["It is generally recommended to choose a ",(0,t.jsx)(s.strong,{children:"mid-to-high"})," level (e.g., Gzip: ",(0,t.jsx)(s.code,{children:"6"}),", Brotli: ",(0,t.jsx)(s.code,{children:"5"}),") as a balance between performance and compression ratio."]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Goal"}),": Enable high-performance ",(0,t.jsx)(s.code,{children:"Brotli"})," and ",(0,t.jsx)(s.code,{children:"Gzip"})," compression for frontend website assets (HTML, CSS, JS), and let ",(0,t.jsx)(s.code,{children:"Pingap"})," handle all the compression work."]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsxs)(s.strong,{children:["Configure the plugin (",(0,t.jsx)(s.code,{children:"plugin.compression-frontend.toml"}),")"]}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-toml",children:'# Use the default "response" mode\n# mode = "response"\n\n# Set Brotli compression level to 5\nbr_level = 5\n\n# Set Gzip compression level to 6 as a fallback for clients that don\'t support Brotli\ngzip_level = 6\n\n# zstd_level is not set, remains 0, meaning it is disabled\n'})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsxs)(s.strong,{children:["Apply the plugin in a Location (",(0,t.jsx)(s.code,{children:"location.toml"}),")"]}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-toml",children:'# ...\n[locations.route-for-my-app]\n# Match all requests to the frontend service\npath = "/"\nupstream = "frontend-server"\nplugins = [\n    "compression-frontend",\n]\n# ...\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"access-effects",children:"Access Effects"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Accessing with a modern browser (e.g., Chrome, supporting Brotli and Gzip)"}),":"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["The client sends ",(0,t.jsx)(s.code,{children:"Accept-Encoding: gzip, deflate, br, zstd"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["Pingap selects the highest priority algorithm, Brotli (",(0,t.jsx)(s.code,{children:"br"}),")."]}),"\n",(0,t.jsxs)(s.li,{children:["The response header will include ",(0,t.jsx)(s.code,{children:"Content-Encoding: br"}),", and the response body will be Brotli-compressed data."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Accessing with an older client (only supporting Gzip)"}),":"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["The client sends ",(0,t.jsx)(s.code,{children:"Accept-Encoding: gzip"}),"."]}),"\n",(0,t.jsx)(s.li,{children:"Pingap selects the Gzip algorithm."}),"\n",(0,t.jsxs)(s.li,{children:["The response header will include ",(0,t.jsx)(s.code,{children:"Content-Encoding: gzip"}),", and the response body will be Gzip-compressed data."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"precautions",children:"Precautions"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Content-Type"}),": The plugin will only compress compressible ",(0,t.jsx)(s.code,{children:"Content-Type"}),"s (like ",(0,t.jsx)(s.code,{children:"text/html"}),", ",(0,t.jsx)(s.code,{children:"application/json"}),", ",(0,t.jsx)(s.code,{children:"text/css"}),", etc.). Binary files like images (JPEG, PNG) and videos are not compressed by default because they are usually already in a compressed format, and re-compressing them is pointless."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Performance Cost"}),": Enabling compression consumes a certain amount of CPU resources. Please choose the appropriate compression algorithm and level based on your server's performance and business load."]}),"\n"]})]})}function a(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>o});var i=n(6540);const t={},r=i.createContext(t);function l(e){const s=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);