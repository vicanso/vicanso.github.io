"use strict";(self.webpackChunkpingap=self.webpackChunkpingap||[]).push([[1973],{2727:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"plugins/response-headers","title":"Response Headers","description":"Dynamically add, set, remove, rename, or conditionally set HTTP response headers before sending the response to the client. Used to enhance security, control caching, and add custom metadata.","source":"@site/docs/plugins/response-headers.md","sourceDirName":"plugins","slug":"/plugins/response-headers","permalink":"/pingap-en/docs/plugins/response-headers","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/plugins/response-headers.md","tags":[],"version":"current","sidebarPosition":98,"frontMatter":{"sidebar_position":98,"title":"Response Headers","description":"Dynamically add, set, remove, rename, or conditionally set HTTP response headers before sending the response to the client. Used to enhance security, control caching, and add custom metadata."},"sidebar":"tutorialSidebar","previous":{"title":"Request ID","permalink":"/pingap-en/docs/plugins/request-id"},"next":{"title":"Content Substitution (Sub Filter)","permalink":"/pingap-en/docs/plugins/sub-filter"}}');var r=s(4848),i=s(8453);const l={sidebar_position:98,title:"Response Headers",description:"Dynamically add, set, remove, rename, or conditionally set HTTP response headers before sending the response to the client. Used to enhance security, control caching, and add custom metadata."},d="Response Headers Plugin",o={},c=[{value:"Feature Introduction",id:"feature-introduction",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Configuration Parameters",id:"configuration-parameters",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"1. Configure the plugin (<code>plugin.response-headers-security.toml</code>)",id:"1-configure-the-plugin-pluginresponse-headers-securitytoml",level:4},{value:"2. Apply the plugin in a Location (location.toml)",id:"2-apply-the-plugin-in-a-location-locationtoml",level:4},{value:"Access Effects",id:"access-effects",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"response-headers-plugin",children:"Response Headers Plugin"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"response-headers"})," plugin is a powerful and flexible response handling plugin that allows you to perform comprehensive add, remove, modify, and query operations on HTTP response headers before they are sent to the client."]}),"\n",(0,r.jsx)(n.h2,{id:"feature-introduction",children:"Feature Introduction"}),"\n",(0,r.jsxs)(n.p,{children:["This plugin intervenes at the response phase to manipulate ",(0,r.jsx)(n.code,{children:"ResponseHeaders"})," according to the rules you define. It supports five core operations:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Add (",(0,r.jsx)(n.code,{children:"add_headers"}),")"]}),": ",(0,r.jsx)(n.strong,{children:"Appends"})," a new header to the response. If a header with the same name already exists, this operation will ",(0,r.jsx)(n.strong,{children:"keep"})," the original value and ",(0,r.jsx)(n.strong,{children:"add"})," a new header with the same name. This is suitable for response headers that can have multiple values (like ",(0,r.jsx)(n.code,{children:"Set-Cookie"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Set (",(0,r.jsx)(n.code,{children:"set_headers"}),")"]}),": ",(0,r.jsx)(n.strong,{children:"Sets"})," the exact value of a header. If a header with the same name already exists, its value will be ",(0,r.jsx)(n.strong,{children:"completely overwritten"}),"; if it doesn't exist, it will be created."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Remove (",(0,r.jsx)(n.code,{children:"remove_headers"}),")"]}),": ",(0,r.jsx)(n.strong,{children:"Completely removes"})," one or more specified headers from the response."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Rename (",(0,r.jsx)(n.code,{children:"rename_headers"}),")"]}),": ",(0,r.jsx)(n.strong,{children:"Renames"})," an existing header to a new name, while keeping its value unchanged."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Set if Not Exists (",(0,r.jsx)(n.code,{children:"set_headers_not_exists"}),")"]}),": ",(0,r.jsx)(n.strong,{children:"Only sets"})," a specified header ",(0,r.jsx)(n.strong,{children:"if it does not already exist"}),". If it exists, no action is taken."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:['Additionally, all "add" and "set" operations support the use of ',(0,r.jsx)(n.strong,{children:"dynamic variables"})," (like ",(0,r.jsx)(n.code,{children:"{$hostname}"}),", ",(0,r.jsx)(n.code,{children:"{:connection_id}"}),"), allowing you to inject dynamic contextual information."]}),"\n",(0,r.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Enhancing Security"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Remove"})," sensitive information headers, such as ",(0,r.jsx)(n.code,{children:"X-Powered-by"})," or other headers that expose the backend technology stack."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Set"})," security-related headers, such as ",(0,r.jsx)(n.code,{children:"Strict-Transport-Security"}),", ",(0,r.jsx)(n.code,{children:"X-Content-Type-Options"}),", ",(0,r.jsx)(n.code,{children:"X-Frame-Options"}),", etc."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cache Control"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Dynamically ",(0,r.jsx)(n.strong,{children:"set"})," ",(0,r.jsx)(n.code,{children:"Cache-Control"})," or ",(0,r.jsx)(n.code,{children:"Expires"})," headers to finely control browser and CDN caching policies for different resource paths."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Metadata"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Add"})," custom debugging headers, such as ",(0,r.jsx)(n.code,{children:"X-Trace-Id"})," (obtained from the request context), ",(0,r.jsx)(n.code,{children:"X-Server-Name"})," (from environment variables), or ",(0,r.jsx)(n.code,{children:"X-Upstream-Response-Time"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Standardization and Compatibility"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Rename"})," non-standard headers returned by the backend service to standard ones to improve client compatibility."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"configuration-parameters",children:"Configuration Parameters"}),"\n",(0,r.jsxs)(n.p,{children:["Configuration is done in the ",(0,r.jsx)(n.code,{children:"plugin.response-headers.toml"})," file."]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Parameter"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Type"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Required"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"add_headers"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Array of Strings"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,r.jsx)(n.strong,{children:"Appends"})," a response header. Format: ",(0,r.jsx)(n.code,{children:'"Key: Value"'}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"set_headers"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Array of Strings"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,r.jsx)(n.strong,{children:"Sets/overwrites"})," a response header. Format: ",(0,r.jsx)(n.code,{children:'"Key: Value"'}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"remove_headers"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Array of Strings"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,r.jsx)(n.strong,{children:"Removes"})," a response header. Format: ",(0,r.jsx)(n.code,{children:'"Key"'}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"rename_headers"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Array of Strings"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,r.jsx)(n.strong,{children:"Renames"})," a response header. Format: ",(0,r.jsx)(n.code,{children:'"Old-Key: New-Key"'}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"set_headers_not_exists"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Array of Strings"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,r.jsx)(n.strong,{children:"Sets"})," a response header ",(0,r.jsx)(n.strong,{children:"only if it does not already exist"}),". Format: ",(0,r.jsx)(n.code,{children:'"Key: Value"'}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.code,{children:"mode"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"String"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,r.jsx)(n.code,{children:'"response"'}),". Defines whether the plugin executes in the ",(0,r.jsx)(n.code,{children:"upstream"})," or ",(0,r.jsx)(n.code,{children:"response"})," phase."]})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Goal"}),": Standardize and harden the responses for our web application's API."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Remove the ",(0,r.jsx)(n.code,{children:"X-Powered-By"})," header that exposes backend information."]}),"\n",(0,r.jsxs)(n.li,{children:["Add a ",(0,r.jsx)(n.code,{children:"X-Content-Type-Options: nosniff"})," security header to all responses."]}),"\n",(0,r.jsxs)(n.li,{children:["Ensure all responses have an ",(0,r.jsx)(n.code,{children:"X-Request-ID"}),". If the backend doesn't provide one, we'll add it using Pingap's request ID."]}),"\n",(0,r.jsxs)(n.li,{children:["Rename the ",(0,r.jsx)(n.code,{children:"X-Svc-Version"})," header from the backend to the standard ",(0,r.jsx)(n.code,{children:"X-Service-Version"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.h4,{id:"1-configure-the-plugin-pluginresponse-headers-securitytoml",children:["1. Configure the plugin (",(0,r.jsx)(n.code,{children:"plugin.response-headers-security.toml"}),")"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'# 1. Remove insecure headers\nremove_headers = [\n  "X-Powered-By",\n]\n\n# 2. Always set security headers (overwrites if they already exist)\nset_headers = [\n  "X-Content-Type-Options: nosniff",\n  "X-Frame-Options: DENY",\n]\n\n# 3. If X-Request-ID does not exist, use Pingap\'s request ID\n# {:request_id} is a dynamic variable that will be automatically replaced\nset_headers_not_exists = [\n  "X-Request-ID: {:request_id}",\n]\n\n# 4. Rename the backend service\'s version header\nrename_headers = [\n  "X-Svc-Version: X-Service-Version",\n]\n'})}),"\n",(0,r.jsx)(n.h4,{id:"2-apply-the-plugin-in-a-location-locationtoml",children:"2. Apply the plugin in a Location (location.toml)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'# location.toml\n[locations.route-for-my-app]\npath = "/api/"\nupstream = "api-backend"\nplugins = [\n    # Ensure the request-id plugin runs before this one\n    "request-id-api", \n    "response-headers-security",\n]\n'})}),"\n",(0,r.jsx)(n.h2,{id:"access-effects",children:"Access Effects"}),"\n",(0,r.jsx)(n.p,{children:"Let's assume the backend service (api-backend) returns the following original headers for a request:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"HTTP/1.1 200 OK\nContent-Type: application/json\nX-Powered-By: Express\nX-Svc-Version: 1.2.3\n"})}),"\n",(0,r.jsxs)(n.p,{children:["After being processed by the ",(0,r.jsx)(n.code,{children:"response-headers"})," plugin, the final response headers received by the client will be:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"HTTP/1.1 200 OK\nContent-Type: application/json\nX-Service-Version: 1.2.3\nX-Content-Type-Options: nosniff\nX-Frame-Options: DENY\nX-Request-ID: <pingap-generated-id>\n"})}),"\n",(0,r.jsx)(n.p,{children:"Analysis of Header Processing:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"X-Powered-By"})," was successfully removed."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"X-Content-Type-Options"})," and ",(0,r.jsx)(n.code,{children:"X-Frame-Options"})," were successfully set."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"X-Svc-Version"})," was renamed to ",(0,r.jsx)(n.code,{children:"X-Service-Version"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Because the original response did not include an ",(0,r.jsx)(n.code,{children:"X-Request-ID"}),", the plugin successfully added it using ",(0,r.jsx)(n.code,{children:"set_headers_not_exists"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var t=s(6540);const r={},i=t.createContext(r);function l(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);