"use strict";(self.webpackChunkpingap=self.webpackChunkpingap||[]).push([[950],{8208:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"plugins/combined-auth","title":"Combined Auth","description":"A secure and reliable signature-based authentication scheme designed for service-to-service calls. It provides multi-layered security for your internal APIs by combining an App ID, IP whitelist, timestamp, and HMAC digest.","source":"@site/docs/plugins/combined-auth.md","sourceDirName":"plugins","slug":"/plugins/combined-auth","permalink":"/pingap-en/docs/plugins/combined-auth","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/plugins/combined-auth.md","tags":[],"version":"current","sidebarPosition":84,"frontMatter":{"sidebar_position":84,"title":"Combined Auth","description":"A secure and reliable signature-based authentication scheme designed for service-to-service calls. It provides multi-layered security for your internal APIs by combining an App ID, IP whitelist, timestamp, and HMAC digest."},"sidebar":"tutorialSidebar","previous":{"title":"Cache","permalink":"/pingap-en/docs/plugins/cache"},"next":{"title":"Response Compression","permalink":"/pingap-en/docs/plugins/compression"}}');var s=i(4848),l=i(8453);const r={sidebar_position:84,title:"Combined Auth",description:"A secure and reliable signature-based authentication scheme designed for service-to-service calls. It provides multi-layered security for your internal APIs by combining an App ID, IP whitelist, timestamp, and HMAC digest."},d="Combined Auth Plugin",a={},o=[{value:"Feature Overview",id:"feature-overview",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Configuration Parameters",id:"configuration-parameters",level:2},{value:"Parameters for each object in the <code>authorizations</code> list",id:"parameters-for-each-object-in-the-authorizations-list",level:3},{value:"Complete Example",id:"complete-example",level:2},{value:"1. Configure the Plugin (<code>plugins.combined-auth-internal.toml</code>)",id:"1-configure-the-plugin-pluginscombined-auth-internaltoml",level:4}];function c(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"combined-auth-plugin",children:"Combined Auth Plugin"})}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"combined-auth"})," plugin provides a powerful ",(0,s.jsx)(t.strong,{children:"HMAC signature-based"})," authentication mechanism, specifically designed for high-security ",(0,s.jsx)(t.strong,{children:"service-to-service (machine-to-machine)"})," scenarios."]}),"\n",(0,s.jsx)(t.h2,{id:"feature-overview",children:"Feature Overview"}),"\n",(0,s.jsxs)(t.p,{children:["Unlike simple API Key authentication, Combined Auth requires the caller to provide information across multiple dimensions and uses a cryptographic digest to ensure the request's ",(0,s.jsx)(t.strong,{children:"authenticity, integrity, and timeliness"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"When this plugin is enabled, every request must carry the following fields in its URL query parameters and pass a multi-layer validation process:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsxs)(t.strong,{children:[(0,s.jsx)(t.code,{children:"app_id"})," (Application ID)"]}),": Identifies which application is making the call. The plugin uses the ",(0,s.jsx)(t.code,{children:"app_id"})," to look up the corresponding authentication configuration."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"IP Whitelist Validation (Optional)"}),": Checks if the request's source IP is on the allowed list configured for that ",(0,s.jsx)(t.code,{children:"app_id"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsxs)(t.strong,{children:[(0,s.jsx)(t.code,{children:"ts"})," (Timestamp)"]}),": The Unix timestamp when the request was initiated. The plugin verifies that the deviation between this timestamp and the server's current time is within an acceptable range, effectively ",(0,s.jsx)(t.strong,{children:"preventing replay attacks"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsxs)(t.strong,{children:[(0,s.jsx)(t.code,{children:"digest"})," (Digest)"]}),": An HMAC-SHA256 digest generated from the ",(0,s.jsx)(t.strong,{children:"secret key"})," and the ",(0,s.jsx)(t.strong,{children:"timestamp"}),". This is the core of the validation. Since the secret key is held only by the client and the server, the digest proves that the request is genuinely from a legitimate client and that the timestamp and other information have not been tampered with."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Only when all checks have passed will the request be allowed to access the upstream service."}),"\n",(0,s.jsx)(t.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Protecting Core Internal APIs"}),": For internal microservices involving core functions like payments or user data modification, Combined Auth ensures that only authorized and legitimate internal services can make calls."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Open Platform APIs"}),": When providing APIs to partners or third-party developers, you can assign a unique ",(0,s.jsx)(t.code,{children:"app_id"})," and ",(0,s.jsx)(t.code,{children:"secret"})," to each developer, enabling secure and isolated authentication through this plugin."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Replacing Complex OAuth Flows"}),": For purely server-to-server calls, Combined Auth is more lightweight and easier to implement than protocols like OAuth 2.0."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"configuration-parameters",children:"Configuration Parameters"}),"\n",(0,s.jsxs)(t.p,{children:["Configuration is done in the ",(0,s.jsx)(t.code,{children:"plugin.combined-auth.toml"})," file."]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Type"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Required"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,s.jsx)(t.tbody,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"authorizations"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Array of Tables"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Yes"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"(Required)"})," A list of configurations for authorized applications."]})]})})]}),"\n",(0,s.jsxs)(t.h3,{id:"parameters-for-each-object-in-the-authorizations-list",children:["Parameters for each object in the ",(0,s.jsx)(t.code,{children:"authorizations"})," list"]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Type"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Required"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"app_id"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Yes"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"(Required)"})," The unique identifier for the application."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"secret"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Yes"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"(Required)"})," The ",(0,s.jsx)(t.strong,{children:"secret"})," key used to generate the HMAC digest. The special value ",(0,s.jsx)(t.code,{children:"*"})," denotes a superuser and will bypass all validation (use with caution)."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"deviation"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Integer"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"No"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"60"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["The maximum allowed deviation between the client timestamp and server time, in ",(0,s.jsx)(t.strong,{children:"seconds"}),"."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"ip_list"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Array of Strings"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"No"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"[]"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"An IP whitelist. Only requests from these IPs will be allowed. Supports single IPs and CIDR ranges."})]})]})]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Goal"}),": We have an internal ",(0,s.jsx)(t.code,{children:"payment-service"})," and need to create a secure API endpoint for it that only allows the ",(0,s.jsx)(t.code,{children:"order-service"})," to call it from its fixed server IP (",(0,s.jsx)(t.code,{children:"10.1.2.3"}),")."]}),"\n",(0,s.jsxs)(t.h4,{id:"1-configure-the-plugin-pluginscombined-auth-internaltoml",children:["1. Configure the Plugin (",(0,s.jsx)(t.code,{children:"plugins.combined-auth-internal.toml"}),")"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",children:'[[authorizations]]\n# Application ID\napp_id = "order-service"\n\n# Assign a secure secret key for it\nsecret = "ORDER_SVC_SECRET_KEY_VERY_SECURE_!@#"\n\n# Only allow requests from the service\'s fixed IP\nip_list = [\n  "10.1.2.3",\n]\n\n# Allow a 60-second time deviation\ndeviation = 60\n'})})]})}function h(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,t,i)=>{i.d(t,{R:()=>r,x:()=>d});var n=i(6540);const s={},l=n.createContext(s);function r(e){const t=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(l.Provider,{value:t},e.children)}}}]);