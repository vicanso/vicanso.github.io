"use strict";(self.webpackChunkpingap=self.webpackChunkpingap||[]).push([[2409],{3754:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"plugins/ua-restriction","title":"User-Agent Restriction","description":"Implement access control for specific clients, crawlers, or scanners by inspecting the HTTP User-Agent header. Supports powerful regular expression matching and can be configured in blacklist or whitelist mode.","source":"@site/docs/plugins/ua-restriction.md","sourceDirName":"plugins","slug":"/plugins/ua-restriction","permalink":"/pingap-en/docs/plugins/ua-restriction","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/plugins/ua-restriction.md","tags":[],"version":"current","sidebarPosition":100,"frontMatter":{"sidebar_position":100,"title":"User-Agent Restriction","description":"Implement access control for specific clients, crawlers, or scanners by inspecting the HTTP User-Agent header. Supports powerful regular expression matching and can be configured in blacklist or whitelist mode."},"sidebar":"tutorialSidebar","previous":{"title":"Traffic Splitting","permalink":"/pingap-en/docs/plugins/traffic-splitting"},"next":{"title":"Deploying Pingap with Docker","permalink":"/pingap-en/docs/docker"}}');var i=s(4848),r=s(8453);const l={sidebar_position:100,title:"User-Agent Restriction",description:"Implement access control for specific clients, crawlers, or scanners by inspecting the HTTP User-Agent header. Supports powerful regular expression matching and can be configured in blacklist or whitelist mode."},c="User-Agent Restriction (UA Restriction) Plugin",o={},a=[{value:"Feature Introduction",id:"feature-introduction",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Configuration Parameters",id:"configuration-parameters",level:2},{value:"Complete Examples",id:"complete-examples",level:2},{value:"Example 1: Using a Blacklist to Block Unfriendly Crawlers",id:"example-1-using-a-blacklist-to-block-unfriendly-crawlers",level:3},{value:"Access Effects",id:"access-effects",level:3},{value:"Example 2: Using a Whitelist to Allow Only a Mobile App",id:"example-2-using-a-whitelist-to-allow-only-a-mobile-app",level:3},{value:"Access Effects",id:"access-effects-1",level:3},{value:"Precautions",id:"precautions",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"user-agent-restriction-ua-restriction-plugin",children:"User-Agent Restriction (UA Restriction) Plugin"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"ua-restriction"})," plugin is a request-phase security plugin that inspects the HTTP ",(0,i.jsx)(n.code,{children:"User-Agent"})," header to identify the client type (e.g., browser, crawler, automated script) and then ",(0,i.jsx)(n.strong,{children:"allows"})," or ",(0,i.jsx)(n.strong,{children:"denies"})," the request based on a list of rules you configure."]}),"\n",(0,i.jsx)(n.h2,{id:"feature-introduction",children:"Feature Introduction"}),"\n",(0,i.jsxs)(n.p,{children:["When making an HTTP request, a client identifies itself via the ",(0,i.jsx)(n.code,{children:"User-Agent"})," header. This plugin leverages this information to implement access control."]}),"\n",(0,i.jsx)(n.p,{children:"It supports two core working modes:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Blacklist (Deny)"}),": Denies requests where the ",(0,i.jsx)(n.code,{children:"User-Agent"})," matches any rule in the list, allowing all other requests."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Whitelist (Allow)"}),": Only allows requests where the ",(0,i.jsx)(n.code,{children:"User-Agent"})," matches at least one rule in the list, denying all others."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The matching rules use powerful ",(0,i.jsx)(n.strong,{children:"regular expressions"}),", allowing you to perform precise string matching or flexible pattern matching, such as matching a specific version range of a crawler."]}),"\n",(0,i.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Blocking Malicious Crawlers or Scanners"}),": If you find that malicious web crawlers or security scanners are consuming your server resources, you can add their ",(0,i.jsx)(n.code,{children:"User-Agent"})," signature to a ",(0,i.jsx)(n.strong,{children:"blacklist"})," to effectively block their access."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Preventing Access from Automated Scripts"}),": Prohibit known automation tools or script libraries (like ",(0,i.jsx)(n.code,{children:"curl"}),", ",(0,i.jsx)(n.code,{children:"python-requests"}),", ",(0,i.jsx)(n.code,{children:"Go-http-client"}),") from directly accessing your website, forcing all access to come through a browser."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Allowing Only Specific Clients"}),": For internal APIs or specific application scenarios, you can configure a ",(0,i.jsx)(n.strong,{children:"whitelist"})," to only allow access from clients you have developed, which have a specific ",(0,i.jsx)(n.code,{children:"User-Agent"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Preventing Search Engines from Indexing Test Environments"}),": In your staging or testing environments, you can add the crawlers of major search engines (like ",(0,i.jsx)(n.code,{children:"Googlebot"}),", ",(0,i.jsx)(n.code,{children:"Baiduspider"}),") to a ",(0,i.jsx)(n.strong,{children:"blacklist"})," to prevent the content of these environments from being publicly indexed."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"configuration-parameters",children:"Configuration Parameters"}),"\n",(0,i.jsxs)(n.p,{children:["Configuration is done in the ",(0,i.jsx)(n.code,{children:"plugin.ua-restriction.toml"})," file."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"Parameter"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"Type"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"Required"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"Default"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.code,{children:"type"})}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"String"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.strong,{children:"Yes"})}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"-"}),(0,i.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,i.jsx)(n.strong,{children:"(Required)"})," The type of restriction. Possible values are ",(0,i.jsx)(n.code,{children:'"deny"'})," (blacklist mode) or ",(0,i.jsx)(n.code,{children:'"allow"'})," (whitelist mode)."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.code,{children:"ua_list"})}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"Array of Strings"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.strong,{children:"Yes"})}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.code,{children:"[]"})}),(0,i.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,i.jsx)(n.strong,{children:"(Required)"})," A list containing one or more ",(0,i.jsx)(n.strong,{children:"regular expressions"})," to match against the ",(0,i.jsx)(n.code,{children:"User-Agent"})," header."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.code,{children:"message"})}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"String"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"No"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.code,{children:'"Request is forbidden"'})}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"A custom message to return to the client when a request is denied."})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"complete-examples",children:"Complete Examples"}),"\n",(0,i.jsx)(n.h3,{id:"example-1-using-a-blacklist-to-block-unfriendly-crawlers",children:"Example 1: Using a Blacklist to Block Unfriendly Crawlers"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Goal"}),": We want to block ",(0,i.jsx)(n.code,{children:"BadBot"})," and all versions of ",(0,i.jsx)(n.code,{children:"SomeScanner"})," from accessing our website."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Configure the plugin (",(0,i.jsx)(n.code,{children:"plugin.ua-blacklist.toml"}),")"]}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'# Set to blacklist mode\ntype = "deny"\n\n# Define regular expressions for the User-Agents to block\n# Note: In TOML, backslashes \\ need to be escaped as \\\\\nua_list = [\n  # Exactly match "BadBot/1.0"\n  "^BadBot/1.0$",\n  # Match all User-Agents that start with "SomeScanner/"\n  "^SomeScanner/.*"\n]\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Apply the plugin in a Location (",(0,i.jsx)(n.code,{children:"location.toml"}),")"]}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'# location.toml\n[locations.main-website]\npath = "/"\nupstream = "my-web-server"\nplugins = [\n    "ua-blacklist",\n    # ... other plugins\n]\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"access-effects",children:"Access Effects"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A request with a ",(0,i.jsx)(n.code,{children:"User-Agent"})," of ",(0,i.jsx)(n.code,{children:"BadBot/1.0"})," will be immediately intercepted and will receive a ",(0,i.jsx)(n.code,{children:"403 Forbidden"})," response."]}),"\n",(0,i.jsxs)(n.li,{children:["A request with a ",(0,i.jsx)(n.code,{children:"User-Agent"})," of ",(0,i.jsx)(n.code,{children:"SomeScanner/3.2"})," will also be intercepted."]}),"\n",(0,i.jsxs)(n.li,{children:["A normal browser request with a ",(0,i.jsx)(n.code,{children:"User-Agent"})," of ",(0,i.jsx)(n.code,{children:"Mozilla/5.0 ..."})," will be unaffected and forwarded normally to ",(0,i.jsx)(n.code,{children:"my-web-server"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example-2-using-a-whitelist-to-allow-only-a-mobile-app",children:"Example 2: Using a Whitelist to Allow Only a Mobile App"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Goal"}),": The endpoints under the ",(0,i.jsx)(n.code,{children:"/api/mobile/"})," path are designed exclusively for our mobile app, and we only want our app to be able to access them. Assume our app's User-Agent format is ",(0,i.jsx)(n.code,{children:"MyApp/MajorVersion.MinorVersion"})," (e.g., ",(0,i.jsx)(n.code,{children:"MyApp/2.1"}),")."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Configure the plugin (",(0,i.jsx)(n.code,{children:"plugin.ua-whitelist-mobile.toml"}),")"]}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'# Set to whitelist mode\ntype = "allow"\n\n# Define a regular expression that only allows our app\'s User-Agent\n# ^MyApp/\\\\d+\\\\.\\\\d+$ matches a string starting with "MyApp/" followed by "number.number"\nua_list = [\n  "^MyApp/\\\\d+\\\\.\\\\d+$"\n]\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Apply the plugin in a Location (",(0,i.jsx)(n.code,{children:"location.toml"}),")"]}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'# location.toml\n[locations.mobile-api]\npath = "/api/mobile/"\nupstream = "mobile-api-backend"\nplugins = [\n    "ua-whitelist-mobile",\n]\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"access-effects-1",children:"Access Effects"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A request with a ",(0,i.jsx)(n.code,{children:"User-Agent"})," of ",(0,i.jsx)(n.code,{children:"MyApp/3.0"})," can access the ",(0,i.jsx)(n.code,{children:"/api/mobile/"})," path normally."]}),"\n",(0,i.jsxs)(n.li,{children:["Any request from a browser (",(0,i.jsx)(n.code,{children:"Mozilla/5.0..."}),") or an unknown client attempting to access ",(0,i.jsx)(n.code,{children:"/api/mobile/"})," will be intercepted and will receive a ",(0,i.jsx)(n.code,{children:"403 Forbidden"})," response."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"precautions",children:"Precautions"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u2757 ",(0,i.jsx)(n.strong,{children:"Security Warning"}),": The ",(0,i.jsx)(n.code,{children:"User-Agent"})," header is sent by the client and therefore ",(0,i.jsx)(n.strong,{children:"can be easily forged"}),". Please do not use User-Agent restriction as your ",(0,i.jsx)(n.strong,{children:"only"})," security mechanism to protect critical or sensitive endpoints. It is better suited as a supplementary line of defense to increase the difficulty for attackers, or for traffic management purposes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Empty User-Agent"}),": If a request has ",(0,i.jsx)(n.strong,{children:"no"})," ",(0,i.jsx)(n.code,{children:"User-Agent"})," header:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Whitelist mode (",(0,i.jsx)(n.code,{children:"allow"}),")"]}),": The request ",(0,i.jsx)(n.strong,{children:"will be denied"})," because it does not match any of the allowed rules."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Blacklist mode (",(0,i.jsx)(n.code,{children:"deny"}),")"]}),": The request ",(0,i.jsx)(n.strong,{children:"will be allowed"})," because it does not match any of the forbidden rules."]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var t=s(6540);const i={},r=t.createContext(i);function l(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);