"use strict";(self.webpackChunkpingap=self.webpackChunkpingap||[]).push([[31],{8446:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"plugins/csrf","title":"CSRF Protection","description":"Protect your web application from Cross-Site Request Forgery (CSRF) attacks by implementing the \\"Double Submit Cookie\\" pattern, ensuring all state-changing requests originate from legitimate users.","source":"@site/docs/plugins/csrf.md","sourceDirName":"plugins","slug":"/plugins/csrf","permalink":"/pingap-en/docs/plugins/csrf","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/plugins/csrf.md","tags":[],"version":"current","sidebarPosition":87,"frontMatter":{"sidebar_position":87,"title":"CSRF Protection","description":"Protect your web application from Cross-Site Request Forgery (CSRF) attacks by implementing the \\"Double Submit Cookie\\" pattern, ensuring all state-changing requests originate from legitimate users."},"sidebar":"tutorialSidebar","previous":{"title":"Cross-Origin Resource Sharing (CORS)","permalink":"/pingap-en/docs/plugins/cors"},"next":{"title":"Static File Service (Directory)","permalink":"/pingap-en/docs/plugins/directory"}}');var i=n(4848),r=n(8453);const l={sidebar_position:87,title:"CSRF Protection",description:'Protect your web application from Cross-Site Request Forgery (CSRF) attacks by implementing the "Double Submit Cookie" pattern, ensuring all state-changing requests originate from legitimate users.'},o="CSRF Protection Plugin",c={},a=[{value:"Feature Introduction",id:"feature-introduction",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Configuration Parameters",id:"configuration-parameters",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Frontend Integration Workflow",id:"frontend-integration-workflow",level:3}];function d(e){const t={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"csrf-protection-plugin",children:"CSRF Protection Plugin"})}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"csrf"})," plugin is a request-phase security plugin that provides robust Cross-Site Request Forgery (CSRF/XSRF) protection for your web application using the ",(0,i.jsx)(t.strong,{children:"Double Submit Cookie"})," pattern."]}),"\n",(0,i.jsx)(t.h2,{id:"feature-introduction",children:"Feature Introduction"}),"\n",(0,i.jsx)(t.p,{children:"Cross-Site Request Forgery (CSRF) is a common web attack where an attacker tricks a logged-in user into unknowingly sending a malicious, state-changing request from the user's browser (e.g., transferring funds, changing a password, deleting data)."}),"\n",(0,i.jsx)(t.p,{children:"This plugin counters such attacks through the following process:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Token Distribution"}),": The client (usually a frontend application) first makes a request to a designated path (e.g., ",(0,i.jsx)(t.code,{children:"/api/csrf-token"}),"). The plugin then generates a unique, cryptographically signed CSRF token."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Set Cookie"}),": This token is automatically stored in the user's browser via a ",(0,i.jsx)(t.code,{children:"Set-Cookie"})," response header. This cookie is ",(0,i.jsx)(t.strong,{children:"not readable"})," by JavaScript, enhancing security."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Double Submit Validation"}),":","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["For all ",(0,i.jsx)(t.strong,{children:"unsafe"})," HTTP requests (e.g., ",(0,i.jsx)(t.code,{children:"POST"}),", ",(0,i.jsx)(t.code,{children:"PUT"}),", ",(0,i.jsx)(t.code,{children:"DELETE"}),"), the frontend application must read the token value and place it in a custom HTTP ",(0,i.jsx)(t.strong,{children:"header"})," (e.g., ",(0,i.jsx)(t.code,{children:"X-CSRF-Token"}),") to be sent with the request."]}),"\n",(0,i.jsxs)(t.li,{children:["Upon receiving the request, the plugin checks both the token in the cookie and the token in the header. ",(0,i.jsx)(t.strong,{children:"Only if both exist and are identical"})," is the request considered legitimate."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:'Because an attacker cannot read or set a cookie under another domain, nor can they add custom headers to cross-domain requests, they cannot forge this "double submit" process, effectively preventing CSRF attacks.'}),"\n",(0,i.jsx)(t.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"All Web Applications Using Cookie/Session Authentication"}),": If your application uses cookies to maintain user login states, all interfaces that change data (e.g., form submissions, money transfers, profile modifications) should be protected against CSRF."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Single Page Applications (SPAs)"}),": For SPAs built with frameworks like React, Vue, or Angular, a common integration pattern is to fetch the CSRF token upon initialization and configure the HTTP client (like Axios) to automatically include the token in all subsequent state-changing requests."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"configuration-parameters",children:"Configuration Parameters"}),"\n",(0,i.jsxs)(t.p,{children:["Configuration is done in the ",(0,i.jsx)(t.code,{children:"plugin.csrf.toml"})," file."]}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Type"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Required"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"key"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Yes"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["A ",(0,i.jsx)(t.strong,{children:"top-secret"})," string key used to cryptographically sign the CSRF token. It must be sufficiently complex and random. ",(0,i.jsx)(t.strong,{children:"All Pingap instances must use the same key."})]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"token_path"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Yes"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["The API path for the frontend application to fetch a new CSRF token, e.g., ",(0,i.jsx)(t.code,{children:'"/api/csrf-token"'}),". Requests to this path will return a new token."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"name"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:'"x-csrf-token"'})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"The name for the cookie and HTTP request header used to store the CSRF token."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"ttl"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.em,{children:"(Never expires)"})}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["The token's validity period, formatted as a time string (e.g., ",(0,i.jsx)(t.code,{children:'"1h"'}),", ",(0,i.jsx)(t.code,{children:'"24h"'}),"). The token will become invalid after it expires."]})]})]})]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Goal"}),": Provide CSRF protection for all APIs (",(0,i.jsx)(t.code,{children:"/api/"}),") of a web application."]}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Generate a secure key"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"# Use openssl to generate a random, secure key\nopenssl rand -base64 32\n"})}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Example Output"}),": ",(0,i.jsx)(t.code,{children:"aBcDeFgHiJkLmNoPqRsTuVwXyZ1234567890/=+"})," (Please use your own generated key)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsxs)(t.strong,{children:["Configure the plugin (",(0,i.jsx)(t.code,{children:"plugin.csrf-api.toml"}),")"]}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-toml",children:'# Key that must be shared across all Pingap instances\nkey = "aBcDeFgHiJkLmNoPqRsTuVwXyZ1234567890/="\n\n# Endpoint for the frontend to fetch the token\ntoken_path = "/api/csrf-token"\n\n# Custom token name\nname = "X-CSRF-TOKEN"\n\n# Token is valid for 24 hours\nttl = "24h"\n'})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsxs)(t.strong,{children:["Apply the plugin in a Location (",(0,i.jsx)(t.code,{children:"location.toml"}),")"]}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-toml",children:'# ...\n[locations.route-for-my-app]\n# Match all API requests\npath = "/api/"\nupstream = "api-backend"\nplugins = [\n    "csrf-api",\n]\n# ...\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"frontend-integration-workflow",children:"Frontend Integration Workflow"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Fetch Token"}),": After the frontend application loads, it sends a ",(0,i.jsx)(t.code,{children:"GET /api/csrf-token"})," request."]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Pingap will return a ",(0,i.jsx)(t.code,{children:"204 No Content"})," response with a ",(0,i.jsx)(t.code,{children:"Set-Cookie: X-CSRF-TOKEN=...; Path=/; Max-Age=86400"})," header. The browser will automatically store this cookie."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Send Request"}),": When the user performs a protected action (e.g., submitting a POST form to ",(0,i.jsx)(t.code,{children:"/api/settings"}),"):"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Frontend JavaScript needs to read the value of ",(0,i.jsx)(t.code,{children:"X-CSRF-TOKEN"})," from the cookie (",(0,i.jsx)(t.code,{children:"document.cookie"}),")."]}),"\n",(0,i.jsx)(t.li,{children:"Place the retrieved token value into an HTTP header with the same name."}),"\n",(0,i.jsx)(t.li,{children:"Send the request."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Validation Process"}),":"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["For ",(0,i.jsx)(t.code,{children:"GET /api/csrf-token"})," requests, the plugin always generates and returns a new token."]}),"\n",(0,i.jsxs)(t.li,{children:["For safe requests like ",(0,i.jsx)(t.code,{children:"GET"}),", ",(0,i.jsx)(t.code,{children:"HEAD"}),", and ",(0,i.jsx)(t.code,{children:"OPTIONS"}),", the plugin skips the check."]}),"\n",(0,i.jsxs)(t.li,{children:["For a ",(0,i.jsx)(t.code,{children:"POST /api/settings"})," request, the plugin will:","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Compare the ",(0,i.jsx)(t.code,{children:"X-CSRF-TOKEN"})," from the cookie and the ",(0,i.jsx)(t.code,{children:"X-CSRF-TOKEN"})," from the request header for equality."]}),"\n",(0,i.jsx)(t.li,{children:"Verify the token's own signature and expiration."}),"\n",(0,i.jsxs)(t.li,{children:["If validation passes, the request is forwarded to ",(0,i.jsx)(t.code,{children:"api-backend"}),". If it fails, a ",(0,i.jsx)(t.code,{children:"401 Unauthorized"})," is returned immediately."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>o});var s=n(6540);const i={},r=s.createContext(i);function l(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);