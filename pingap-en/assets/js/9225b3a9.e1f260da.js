"use strict";(self.webpackChunkpingap=self.webpackChunkpingap||[]).push([[5950],{4470:(e,t,l)=>{l.r(t),l.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>x,frontMatter:()=>r,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"config","title":"Detailed Configuration Reference","description":"Pingap uses the TOML format for configuration, which offers excellent readability. All configuration items are split into different files for easy management.","source":"@site/docs/config.md","sourceDirName":".","slug":"/config","permalink":"/pingap-en/docs/config","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/config.md","tags":[],"version":"current","sidebarPosition":31,"frontMatter":{"sidebar_position":31},"sidebar":"tutorialSidebar","previous":{"title":"Command-Line Arguments and Environment Variables","permalink":"/pingap-en/docs/argument"},"next":{"title":"Access Log Formatting","permalink":"/pingap-en/docs/log"}}');var n=l(4848),i=l(8453);const r={sidebar_position:31},d="Detailed Configuration Reference",c={},h=[{value:"Basic Configuration (basic.toml)",id:"basic-configuration-basictoml",level:2},{value:"Instance and Process Management",id:"instance-and-process-management",level:3},{value:"Performance Tuning",id:"performance-tuning",level:3},{value:"Observability and Notifications",id:"observability-and-notifications",level:3},{value:"Other",id:"other",level:3},{value:"Upstream Configuration (upstream.toml)",id:"upstream-configuration-upstreamtoml",level:2},{value:"Core Configuration",id:"core-configuration",level:3},{value:"Health Check (<code>health_check</code>)",id:"health-check-health_check",level:3},{value:"Connection and Timeout Configuration",id:"connection-and-timeout-configuration",level:3},{value:"TLS/HTTPS Configuration",id:"tlshttps-configuration",level:3},{value:"Backend Node Related",id:"backend-node-related",level:3},{value:"Low-Level TCP Tuning",id:"low-level-tcp-tuning",level:3},{value:"Route Configuration (location.toml)",id:"route-configuration-locationtoml",level:2},{value:"Route Matching and Forwarding",id:"route-matching-and-forwarding",level:3},{value:"Request Header Handling",id:"request-header-handling",level:3},{value:"Available Variables",id:"available-variables",level:3},{value:"Security and Limits",id:"security-and-limits",level:3},{value:"Server Configuration (server.toml)",id:"server-configuration-servertoml",level:2},{value:"Core Configuration",id:"core-configuration-1",level:3},{value:"TLS/HTTPS",id:"tlshttps",level:3},{value:"Protocols and Modules",id:"protocols-and-modules",level:3},{value:"Performance and Connection Tuning",id:"performance-and-connection-tuning",level:3},{value:"Observability",id:"observability",level:3}];function o(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"detailed-configuration-reference",children:"Detailed Configuration Reference"})}),"\n",(0,n.jsx)(t.p,{children:"Pingap uses the TOML format for configuration, which offers excellent readability. All configuration items are split into different files for easy management."}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Common Unit Formats"}),":"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Duration"}),": Uses human-readable suffixes, such as ",(0,n.jsx)(t.code,{children:"5s"})," (5 seconds), ",(0,n.jsx)(t.code,{children:"10m"})," (10 minutes), ",(0,n.jsx)(t.code,{children:"1h"})," (1 hour)."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Size"}),": Uses standard unit suffixes, such as ",(0,n.jsx)(t.code,{children:"8kb"})," (8 KB), ",(0,n.jsx)(t.code,{children:"16mb"})," (16 MB), ",(0,n.jsx)(t.code,{children:"1gb"})," (1 GB)."]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"basic-configuration-basictoml",children:"Basic Configuration (basic.toml)"}),"\n",(0,n.jsx)(t.p,{children:"This file defines the global behavior, process management, and fundamental performance parameters of a Pingap instance."}),"\n",(0,n.jsx)(t.h3,{id:"instance-and-process-management",children:"Instance and Process Management"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"name"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"Pingap"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The name of the instance, used to differentiate between instances in logs or monitoring."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"pid_file"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"/run/pingap.pid"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The file path for storing the process ID (PID). When deploying multiple instances on a single machine, each must have a different path."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"upgrade_sock"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"/tmp/pingap_upgrade.sock"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The Unix Socket path used for zero-downtime graceful restarts. Must be modified when deploying multiple instances on a single machine."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"user"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"If running as a daemon, specifies the user to run the service as."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"group"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"If running as a daemon, specifies the group to run the service as."})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"performance-tuning",children:"Performance Tuning"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"threads"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"1"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The number of worker threads used by each service (e.g., TCP listener). Setting it to ",(0,n.jsx)(t.code,{children:"0"})," determines the number automatically based on CPU cores."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"work_stealing"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"true"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Whether to allow threads within the same service to steal tasks from other threads, which usually improves performance."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"upstream_keepalive_pool_size"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"128"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The size of the keep-alive connection pool to the upstream services."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"listener_tasks_per_fd"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"1"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The number of tasks per listening file descriptor. Setting it >1 allows parallel acceptance of new connections, improving performance under high concurrency."})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"observability-and-notifications",children:"Observability and Notifications"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"log_level"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"INFO"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The output level for application logs (e.g., ",(0,n.jsx)(t.code,{children:"DEBUG"}),", ",(0,n.jsx)(t.code,{children:"INFO"}),", ",(0,n.jsx)(t.code,{children:"WARN"}),", ",(0,n.jsx)(t.code,{children:"ERROR"}),"), supports dynamic setting of log output level, which takes effect within 30 seconds."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"log_buffered_size"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The size of the log buffer (e.g., ",(0,n.jsx)(t.code,{children:"8kb"}),"). Setting this can improve logging performance under high concurrency. ",(0,n.jsx)(t.code,{children:"0"})," means no buffer is used."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"log_format_json"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"false"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Whether to format application logs as JSON."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"webhook"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The URL for webhooks, used for sending various event notifications."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"webhook_type"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The type of webhook, supports ",(0,n.jsx)(t.code,{children:"http"})," (generic), ",(0,n.jsx)(t.code,{children:"wecom"})," (WeCom), ",(0,n.jsx)(t.code,{children:"dingtalk"})," (DingTalk)."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"webhook_notifications"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["An array defining which event types to be notified of, such as ",(0,n.jsx)(t.code,{children:"backend_status"}),", ",(0,n.jsx)(t.code,{children:"restart"}),", ",(0,n.jsx)(t.code,{children:"diff_config"}),", etc."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"sentry"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The DSN address for Sentry, used for error collection. Requires the ",(0,n.jsx)(t.code,{children:"full feature"})," version of Pingap."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"pyroscope"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The connection address for Pyroscope, used for continuous performance profiling. Requires the ",(0,n.jsx)(t.code,{children:"perf"})," version of Pingap; not recommended unless performance optimization is needed."]})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"other",children:"Other"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"error_template"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The path to a custom HTML template for error pages. ",(0,n.jsx)(t.code,{children:"{{version}}"})," and ",(0,n.jsx)(t.code,{children:"{{content}}"})," in the template will be dynamically replaced."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"grace_period"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"5m"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The total waiting period for a graceful exit."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"graceful_shutdown_timeout"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"5s"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"During a graceful exit, the timeout for waiting for each connection to close."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"auto_restart_check_interval"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"90s"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["When using ",(0,n.jsx)(t.code,{children:"--autorestart"}),", the interval for checking configuration changes, to avoid multiple restarts from rapid changes."]})]})]})]}),"\n",(0,n.jsx)(t.h2,{id:"upstream-configuration-upstreamtoml",children:"Upstream Configuration (upstream.toml)"}),"\n",(0,n.jsx)(t.p,{children:"An Upstream defines a set of backend service nodes, including their addresses, load balancing strategy, and health checks."}),"\n",(0,n.jsx)(t.h3,{id:"core-configuration",children:"Core Configuration"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"addrs"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"[]"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.strong,{children:"(Required)"})," A list of backend service addresses. Format is ",(0,n.jsx)(t.code,{children:"ip:port [weight]"}),", where ",(0,n.jsx)(t.code,{children:"weight"})," is optional."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"discovery"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Service discovery method. ",(0,n.jsx)(t.code,{children:"dns"})," is recommended when using domain names; ",(0,n.jsx)(t.code,{children:"docker"})," is available for container environments."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"algo"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"round_robin"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Load balancing algorithm. Supports ",(0,n.jsx)(t.code,{children:"round_robin"})," and ",(0,n.jsx)(t.code,{children:"hash"})," (consistent hashing)."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"update_frequency"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The update frequency for service discovery, e.g., ",(0,n.jsx)(t.code,{children:"30s"}),"."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"health_check"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Health check. Supports ",(0,n.jsx)(t.code,{children:"http"}),", ",(0,n.jsx)(t.code,{children:"tcp"}),", and ",(0,n.jsx)(t.code,{children:"grpc"})," formats. It is recommended to configure this; if not, a default TCP port check will be used."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"ipv4_only"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"false"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Whether to only use IPv4 addresses during DNS resolution."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"dns_server"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Specifies the server address for DNS service discovery, e.g., ",(0,n.jsx)(t.code,{children:"8.8.8.8:53"}),". (For DNS service discovery)"]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"dns_domain"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Specifies the domain for DNS discovery. (For DNS service discovery)"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"dns_search"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Specifies the DNS search domain. (For DNS service discovery)"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"enable_tracer"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"false"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Whether to enable tracing. When enabled, more observability metrics like connection count can be obtained."})]})]})]}),"\n",(0,n.jsxs)(t.p,{children:["\ud83d\udca1 ",(0,n.jsx)(t.strong,{children:"Details on the 'hash' mode for 'algo'"})]}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"hash"})," mode enables session persistence, ensuring that requests from the same source are always forwarded to the same backend node."]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"hash:ip"}),": Hashes based on the client IP."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"hash:url"}),": Hashes based on the full URL."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"hash:path"}),": Hashes based on the request path (default)."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"hash:header:X-User-ID"}),": Hashes based on the value of a specified request header (",(0,n.jsx)(t.code,{children:"X-User-ID"}),")."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"hash:cookie:session_id"}),": Hashes based on the value of a specified Cookie (",(0,n.jsx)(t.code,{children:"session_id"}),")."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"hash:query:user_id"}),": Hashes based on the value of a specified query parameter (",(0,n.jsx)(t.code,{children:"user_id"}),")."]}),"\n"]}),"\n",(0,n.jsxs)(t.h3,{id:"health-check-health_check",children:["Health Check (",(0,n.jsx)(t.code,{children:"health_check"}),")"]}),"\n",(0,n.jsxs)(t.p,{children:["It is strongly recommended to configure health checks. ",(0,n.jsx)(t.code,{children:"Pingap"})," will automatically remove unhealthy nodes. If not configured, it will default to a TCP port check."]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Format"}),":","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"HTTP(S)"}),": ",(0,n.jsx)(t.code,{children:"http(s)://<upstream_host>/<path>"})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"TCP"}),": ",(0,n.jsx)(t.code,{children:"tcp://<upstream_host>"})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"gRPC"}),": ",(0,n.jsx)(t.code,{children:"grpc://<upstream_host>?service=<service_name>"})]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Common Parameters"}),":","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"check_frequency"})," (default ",(0,n.jsx)(t.code,{children:"10s"}),"): The interval between checks."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"success"})," (default ",(0,n.jsx)(t.code,{children:"1"}),"): Number of consecutive successes to mark as healthy."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"failure"})," (default ",(0,n.jsx)(t.code,{children:"2"}),"): Number of consecutive failures to mark as unhealthy."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"connection_timeout"})," (default ",(0,n.jsx)(t.code,{children:"3s"}),"): The connection timeout for checks."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"connection-and-timeout-configuration",children:"Connection and Timeout Configuration"}),"\n",(0,n.jsxs)(t.p,{children:["\ud83d\udca1 ",(0,n.jsx)(t.strong,{children:"Best Practice"}),": Always set reasonable timeouts for production environments to prevent connection buildup caused by slow or unresponsive backend services, which can eventually bring down the entire proxy service."]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"total_connection_timeout"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The total timeout for the entire connection process (including TLS handshake)."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"connection_timeout"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The timeout for establishing a TCP connection."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"read_timeout"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The timeout for reading a response from the backend."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"write_timeout"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The timeout for writing a request to the backend."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"idle_timeout"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The maximum idle time for a connection in the connection pool. Setting to ",(0,n.jsx)(t.code,{children:"0"})," means no connection reuse; ",(0,n.jsx)(t.code,{children:"null"})," uses the default reuse rule."]})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"tlshttps-configuration",children:"TLS/HTTPS Configuration"}),"\n",(0,n.jsx)(t.p,{children:"When the backend service is HTTPS, the following parameters need to be configured."}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"sni"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.strong,{children:"(Required)"})," The Server Name Indication in the TLS handshake."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"verify_cert"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"true"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Whether to verify the validity of the backend service's TLS certificate (can be set to ",(0,n.jsx)(t.code,{children:"false"})," for self-signed certificates)."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"alpn"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"H1"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The protocol for TLS ALPN negotiation, such as ",(0,n.jsx)(t.code,{children:"H2"}),"."]})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"backend-node-related",children:"Backend Node Related"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Parameter"}),(0,n.jsx)(t.th,{children:"Default"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"enable_backend_stats"})}),(0,n.jsx)(t.td,{children:"false"}),(0,n.jsx)(t.td,{children:"Whether to enable backend node status statistics."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"backend_failure_status_code"})}),(0,n.jsx)(t.td,{}),(0,n.jsx)(t.td,{children:"The status codes for backend node failure, separated by commas."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"circuit_break_max_consecutive_failures"})}),(0,n.jsx)(t.td,{children:"3"}),(0,n.jsx)(t.td,{children:"The maximum number of consecutive failures for circuit breaking."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"circuit_break_max_failure_percent"})}),(0,n.jsx)(t.td,{children:"50"}),(0,n.jsx)(t.td,{children:"The maximum failure percentage for circuit breaking."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"circuit_break_min_requests_threshold"})}),(0,n.jsx)(t.td,{children:"10"}),(0,n.jsx)(t.td,{children:"The minimum number of requests threshold for circuit breaking."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"circuit_break_half_open_consecutive_success_threshold"})}),(0,n.jsx)(t.td,{children:"5"}),(0,n.jsx)(t.td,{children:"The number of consecutive successes required to transition from the half-open state to the closed state."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"circuit_break_open_duration"})}),(0,n.jsx)(t.td,{children:"10s"}),(0,n.jsx)(t.td,{children:"The duration for the circuit breaker to be in the open state."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"backend_stats_interval"})}),(0,n.jsx)(t.td,{children:"60s"}),(0,n.jsx)(t.td,{children:"The interval for backend node status statistics."})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"low-level-tcp-tuning",children:"Low-Level TCP Tuning"}),"\n",(0,n.jsxs)(t.p,{children:["\u2757 ",(0,n.jsx)(t.strong,{children:"Note"}),": It is recommended to keep the default values unless you are very clear about the effects of these parameters."]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tcp_idle"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The idle probing duration for TCP Keep-Alive."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tcp_interval"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The probe interval for TCP Keep-Alive."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tcp_probe_count"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The number of probes for TCP Keep-Alive."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tcp_user_timeout"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"TCP user timeout, defines how long unacknowledged data can remain."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tcp_recv_buf"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The size of the TCP receive buffer."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tcp_fast_open"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"false"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Whether to enable TCP Fast Open."})]})]})]}),"\n",(0,n.jsx)(t.h2,{id:"route-configuration-locationtoml",children:"Route Configuration (location.toml)"}),"\n",(0,n.jsxs)(t.p,{children:["A ",(0,n.jsx)(t.code,{children:"Location"})," is the bridge connecting requests to upstreams. It defines detailed matching rules and request handling logic."]}),"\n",(0,n.jsx)(t.h3,{id:"route-matching-and-forwarding",children:"Route Matching and Forwarding"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"host"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The domain to match. Multiple domains are separated by commas. A ",(0,n.jsx)(t.code,{children:"~"})," prefix indicates a regular expression."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"path"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The path to match. Supports prefix, regex, and exact matching."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"upstream"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The name of the ",(0,n.jsx)(t.code,{children:"Upstream"})," to forward requests to upon a successful match. Must be an existing ",(0,n.jsx)(t.code,{children:"Upstream"}),"."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"rewrite"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["A URL rewrite rule, in the format of ",(0,n.jsx)(t.code,{children:"matching_regex"})," ",(0,n.jsx)(t.code,{children:"replacement_content"}),"."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"plugins"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"[]"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"A list of plugins bound to this Location, executed in order."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"weight"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"A custom weight. Generally not needed, but can be used in scenarios like setting a mock service for unavailability and then giving it the highest weight to disable all requests."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"grpc_web"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"false"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Whether to enable support for grpc-web."})]})]})]}),"\n",(0,n.jsxs)(t.p,{children:["\ud83d\udcd6 ",(0,n.jsx)(t.strong,{children:"Path Matching Rules and Priority"})]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Exact Match"}),": Starts with ",(0,n.jsx)(t.code,{children:"="}),", e.g., ",(0,n.jsx)(t.code,{children:"=/api/user"}),", matches only requests where the path is exactly ",(0,n.jsx)(t.code,{children:"/api/user"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Regex Match"}),": Starts with ",(0,n.jsx)(t.code,{children:"~"}),", e.g., ",(0,n.jsx)(t.code,{children:"~^/(api|rest)"}),", uses a regular expression to match."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Prefix Match"}),": e.g., ",(0,n.jsx)(t.code,{children:"/api"}),", matches all requests starting with ",(0,n.jsx)(t.code,{children:"/api"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["\ud83d\udcd6 ",(0,n.jsx)(t.strong,{children:"Rewrite Rules"})]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Remove path prefix: ",(0,n.jsx)(t.code,{children:"^/api/user-service/(.*) /$1"})]}),"\n",(0,n.jsxs)(t.li,{children:["Add path prefix: ",(0,n.jsx)(t.code,{children:"^/(.*) /v2/api/$1"})]}),"\n",(0,n.jsxs)(t.li,{children:["Reorganize path parameters: ",(0,n.jsx)(t.code,{children:"^/resource/users/id/(\\\\d+) /resource/users/$1"})]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"request-header-handling",children:"Request Header Handling"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"enable_reverse_proxy_headers"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"false"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Whether to automatically add standard reverse proxy headers like ",(0,n.jsx)(t.code,{children:"X-Forwarded-*"})," and ",(0,n.jsx)(t.code,{children:"X-Real-IP"}),". Strongly recommended to enable."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"proxy_set_headers"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"[]"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Sets a forwarded request header. If the header already exists, its value is overwritten."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"proxy_add_headers"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"[]"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Adds a forwarded request header. If the header already exists, a new value is appended."})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"available-variables",children:"Available Variables"}),"\n",(0,n.jsx)(t.p,{children:"When setting request headers, you can use the following dynamic variables:"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"$hostname"}),", ",(0,n.jsx)(t.code,{children:"$host"}),", ",(0,n.jsx)(t.code,{children:"$scheme"}),", ",(0,n.jsx)(t.code,{children:"$remote_addr"}),", ",(0,n.jsx)(t.code,{children:"$remote_port"}),", ",(0,n.jsx)(t.code,{children:"$server_addr"}),", ",(0,n.jsx)(t.code,{children:"$server_port"}),", ",(0,n.jsx)(t.code,{children:"$upstream_addr"}),", etc."]}),"\n",(0,n.jsx)(t.h3,{id:"security-and-limits",children:"Security and Limits"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"client_max_body_size"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The maximum allowed client request body size, e.g., ",(0,n.jsx)(t.code,{children:"10mb"}),". No limit by default."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"max_processing"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"0"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The maximum number of requests this Location can process concurrently. ",(0,n.jsx)(t.code,{children:"0"})," means no limit."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"max_retries"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The number of times to retry the connection when the upstream fails. 0 means no retry."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"max_retry_window"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The window time for retrying the connection when the upstream fails. If exceeded, it means no more retries."})]})]})]}),"\n",(0,n.jsx)(t.h2,{id:"server-configuration-servertoml",children:"Server Configuration (server.toml)"}),"\n",(0,n.jsxs)(t.p,{children:["A ",(0,n.jsx)(t.code,{children:"Server"})," is the network entry point for Pingap. It defines the listening port, protocol, and the set of ",(0,n.jsx)(t.code,{children:"Location"})," rules bound to it. The ",(0,n.jsx)(t.code,{children:"x"})," in the filename (",(0,n.jsx)(t.code,{children:"servers.x.toml"}),") is the unique name of the service."]}),"\n",(0,n.jsx)(t.h3,{id:"core-configuration-1",children:"Core Configuration"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"addr"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.strong,{children:"(Required)"})," The listening address, in ",(0,n.jsx)(t.code,{children:"ip:port"})," format. Multiple addresses are separated by commas."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"locations"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"[]"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.strong,{children:"(Required)"})," A list of ",(0,n.jsx)(t.code,{children:"Location"})," names bound to this ",(0,n.jsx)(t.code,{children:"Server"}),". Matching is based on the ",(0,n.jsx)(t.code,{children:"Location"}),"'s weight, not their order in this list."]})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"tlshttps",children:"TLS/HTTPS"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"global_certificates"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"false"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Whether to enable the global certificate configuration. Must be enabled for HTTPS services."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tls_min_version"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"1.2"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The minimum supported TLS version."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tls_max_version"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"1.3"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The maximum supported TLS version."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tls_cipher_list"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"(Recommended list)"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The cipher suites for TLS 1.2 and below."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tls_ciphersuites"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"(Recommended list)"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The cipher suites for TLS 1.3."})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"protocols-and-modules",children:"Protocols and Modules"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"enabled_h2"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"false"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Whether to enable HTTP/2 support. If enabled, HTTPS connections will negotiate H2, and HTTP connections will be H2C."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"modules"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"[]"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Enables specific feature modules, such as ",(0,n.jsx)(t.code,{children:"web-grpc"}),", etc."]})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"performance-and-connection-tuning",children:"Performance and Connection Tuning"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"threads"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"1"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The number of worker threads specifically allocated for this Server."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"reuse_port"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"false"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Whether to enable ",(0,n.jsx)(t.code,{children:"SO_REUSEPORT"}),", allowing multiple processes/threads to listen on the same port, which can improve performance under high concurrency."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"downstream_read_timeout"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The timeout for reading a request from the client."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"downstream_write_timeout"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The timeout for writing a response to the client."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tcp_fastopen"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Enables TCP Fast Open and sets the queue size (backlog)."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tcp_idle"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The idle probing duration for TCP Keep-Alive."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tcp_interval"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The probe interval for TCP Keep-Alive."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tcp_probe_count"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The number of probes for TCP Keep-Alive."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tcp_user_timeout"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"TCP user timeout, defines how long unacknowledged data can remain."})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"observability",children:"Observability"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"access_log"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The directory, file, and format template for access logs. Left empty to disable. E.g., ",(0,n.jsx)(t.code,{children:"/var/log/pingap.log {when} {path}"}),"."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"prometheus_metrics"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The path for exposing Prometheus metrics, e.g., ",(0,n.jsx)(t.code,{children:"/metrics"}),"."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"otlp_exporter"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The path for exposing OpenTelemetry metrics, e.g., ",(0,n.jsx)(t.code,{children:"/metrics"}),"."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"enable_server_timing"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"false"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Whether to add the ",(0,n.jsx)(t.code,{children:"Server-Timing"})," header to responses, to show processing duration for frontend performance analysis."]})]})]})]})]})}function x(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}},8453:(e,t,l)=>{l.d(t,{R:()=>r,x:()=>d});var s=l(6540);const n={},i=s.createContext(n);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);