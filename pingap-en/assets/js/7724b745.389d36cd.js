"use strict";(self.webpackChunkpingap=self.webpackChunkpingap||[]).push([[3579],{4357:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"plugins/redirect","title":"HTTP Redirect","description":"Easily implement forced HTTP to HTTPS redirection or add a uniform prefix to URL paths. Ensures the original request method and body are preserved after the redirect by sending a 307 Temporary Redirect response.","source":"@site/docs/plugins/redirect.md","sourceDirName":"plugins","slug":"/plugins/redirect","permalink":"/pingap-en/docs/plugins/redirect","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/plugins/redirect.md","tags":[],"version":"current","sidebarPosition":95,"frontMatter":{"sidebar_position":95,"title":"HTTP Redirect","description":"Easily implement forced HTTP to HTTPS redirection or add a uniform prefix to URL paths. Ensures the original request method and body are preserved after the redirect by sending a 307 Temporary Redirect response."},"sidebar":"tutorialSidebar","previous":{"title":"Health Check (Ping)","permalink":"/pingap-en/docs/plugins/ping"},"next":{"title":"Referer Restriction","permalink":"/pingap-en/docs/plugins/referer-restriction"}}');var r=n(4848),i=n(8453);const l={sidebar_position:95,title:"HTTP Redirect",description:"Easily implement forced HTTP to HTTPS redirection or add a uniform prefix to URL paths. Ensures the original request method and body are preserved after the redirect by sending a 307 Temporary Redirect response."},d="HTTP Redirect Plugin",c={},o=[{value:"Feature Introduction",id:"feature-introduction",level:2},{value:"Why use a <code>307</code> Redirect?",id:"why-use-a-307-redirect",level:3},{value:"Use Cases",id:"use-cases",level:2},{value:"Configuration Parameters",id:"configuration-parameters",level:2},{value:"Complete Examples",id:"complete-examples",level:2},{value:"Example 1: Force All Traffic to Use HTTPS",id:"example-1-force-all-traffic-to-use-https",level:3},{value:"Access Effects",id:"access-effects",level:3},{value:"Example 2: Force HTTPS and Add an API Version Prefix",id:"example-2-force-https-and-add-an-api-version-prefix",level:3},{value:"Access Effects",id:"access-effects-1",level:3}];function a(e){const t={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"http-redirect-plugin",children:"HTTP Redirect Plugin"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"redirect"})," plugin is a request-phase plugin that intercepts matching requests and returns an HTTP redirect response (status code ",(0,r.jsx)(t.code,{children:"307 Temporary Redirect"}),") to the client, guiding the browser or client to a new URL."]}),"\n",(0,r.jsx)(t.h2,{id:"feature-introduction",children:"Feature Introduction"}),"\n",(0,r.jsxs)(t.p,{children:["The core function of this plugin is to ",(0,r.jsx)(t.strong,{children:"generate and return a redirect instruction"})," without forwarding the request to any upstream service. You can configure it to implement two main types of redirect logic:"]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Scheme Redirect"}),": The most common use is to forcibly redirect all ",(0,r.jsx)(t.code,{children:"http://"})," requests to ",(0,r.jsx)(t.code,{children:"https://"}),", ensuring an encrypted connection is used at all times."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Path Prefix"}),": Automatically adds a specified prefix to the request's URL path. For example, redirecting a request for ",(0,r.jsx)(t.code,{children:"/orders"})," to ",(0,r.jsx)(t.code,{children:"/api/v1/orders"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["Both types of logic can be active ",(0,r.jsx)(t.strong,{children:"simultaneously"}),"."]}),"\n",(0,r.jsxs)(t.h3,{id:"why-use-a-307-redirect",children:["Why use a ",(0,r.jsx)(t.code,{children:"307"})," Redirect?"]}),"\n",(0,r.jsxs)(t.p,{children:["Unlike the common ",(0,r.jsx)(t.code,{children:"301"})," (Permanent) or ",(0,r.jsx)(t.code,{children:"302"})," (Found) redirects, the ",(0,r.jsx)(t.code,{children:"307 Temporary Redirect"})," explicitly requires that the client ",(0,r.jsx)(t.strong,{children:"must preserve the original request method and body"})," when making the new request to the redirected address. This means that if the original request was a ",(0,r.jsx)(t.code,{children:"POST"})," or ",(0,r.jsx)(t.code,{children:"PUT"}),", the redirected request will also be a ",(0,r.jsx)(t.code,{children:"POST"})," or ",(0,r.jsx)(t.code,{children:"PUT"}),", effectively preventing data loss or request failures, which is especially suitable for handling API requests."]}),"\n",(0,r.jsx)(t.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Forcing HTTPS"}),": This is the most common and important security practice. By redirecting all HTTP traffic to HTTPS, you can prevent man-in-the-middle attacks and protect data in transit."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"URL Normalization"}),": Ensure all users access your service through a single, canonical URL path. For example, redirecting old, un-versioned API paths to new, versioned paths (",(0,r.jsx)(t.code,{children:"/users"})," -> ",(0,r.jsx)(t.code,{children:"/api/v2/users"}),")."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Domain Migration or Refactoring"}),": When a website or service is being refactored and the URL structure changes, use redirects to smoothly guide users and search engines to the new addresses. (Note: This plugin does not handle domain name changes, only scheme and path)."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"configuration-parameters",children:"Configuration Parameters"}),"\n",(0,r.jsxs)(t.p,{children:["Configuration is done in the ",(0,r.jsx)(t.code,{children:"plugin.redirect.toml"})," file."]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Type"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Required"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"http_to_https"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Boolean"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Whether to redirect ",(0,r.jsx)(t.code,{children:"http"})," requests to ",(0,r.jsx)(t.code,{children:"https"}),". Set to ",(0,r.jsx)(t.code,{children:"true"})," to force HTTPS."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"prefix"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.em,{children:"(empty)"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["A string prefix to add to the beginning of the URL path. If configured, it will be automatically formatted to start with a ",(0,r.jsx)(t.code,{children:"/"}),"."]})]})]})]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"complete-examples",children:"Complete Examples"}),"\n",(0,r.jsx)(t.h3,{id:"example-1-force-all-traffic-to-use-https",children:"Example 1: Force All Traffic to Use HTTPS"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Goal"}),": We want all access to our website to be over HTTPS. Any user visiting via ",(0,r.jsx)(t.code,{children:"http://"})," should be automatically redirected to the corresponding ",(0,r.jsx)(t.code,{children:"https://"})," page."]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsxs)(t.strong,{children:["Configure the plugin (",(0,r.jsx)(t.code,{children:"plugin.force-https.toml"}),")"]}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",children:"# Enable http to https redirection\nhttp_to_https = true\n\n# In this scenario, we are not modifying the path, so the prefix is omitted\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsxs)(t.strong,{children:["Apply the plugin in a Location (",(0,r.jsx)(t.code,{children:"location.toml"}),")"]}),":"]}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsxs)(t.p,{children:["\ud83d\udca1 ",(0,r.jsx)(t.strong,{children:"Important"}),": This plugin should be applied in an HTTP ",(0,r.jsx)(t.code,{children:"Server"})," that ",(0,r.jsx)(t.strong,{children:"only listens on port 80"}),", as it only processes HTTP requests that need to be redirected."]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",children:'# location.toml\n\n# --- Rule 1: HTTP Redirect Rule ---\n[locations.http-redirect-rule]\n# Match all HTTP requests\npath = "/"\n# Note: This Location is handled directly by the plugin, so no upstream is needed\nplugins = [\n    "force-https",\n]\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"access-effects",children:"Access Effects"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["When a user visits ",(0,r.jsx)(t.code,{children:"http://example.com/dashboard?tab=1"}),":","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Pingap will return a ",(0,r.jsx)(t.code,{children:"307 Temporary Redirect"})," response."]}),"\n",(0,r.jsxs)(t.li,{children:["The response header will include ",(0,r.jsx)(t.code,{children:"Location: https://example.com/dashboard?tab=1"}),"."]}),"\n",(0,r.jsx)(t.li,{children:"The user's browser will automatically redirect to the new HTTPS address, with the URL path and query parameters remaining unchanged."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"example-2-force-https-and-add-an-api-version-prefix",children:"Example 2: Force HTTPS and Add an API Version Prefix"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Goal"}),": All of our APIs must be accessed over HTTPS, and all paths must start with ",(0,r.jsx)(t.code,{children:"/api/v2"}),"."]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsxs)(t.strong,{children:["Configure the plugin (",(0,r.jsx)(t.code,{children:"plugin.redirect-api.toml"}),")"]}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",children:'# Enable http to https redirection\nhttp_to_https = true\n\n# Add a path prefix\nprefix = "/api/v2"\n'})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsxs)(t.strong,{children:["Apply the plugin in a Location (",(0,r.jsx)(t.code,{children:"location.toml"}),")"]}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",children:'# location.toml\n\n# --- Again, this rule is applied to an HTTP Server listening only on port 80 ---\n[locations.api-redirect-rule]\npath = "/"\nplugins = [\n    "redirect-api",\n]\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"access-effects-1",children:"Access Effects"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["When a ",(0,r.jsx)(t.code,{children:"POST"})," request is sent to ",(0,r.jsx)(t.code,{children:"http://example.com/users"}),":","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Pingap will return a ",(0,r.jsx)(t.code,{children:"307 Temporary Redirect"})," response."]}),"\n",(0,r.jsxs)(t.li,{children:["The ",(0,r.jsx)(t.code,{children:"Location"})," header will be ",(0,r.jsx)(t.code,{children:"https://example.com/api/v2/users"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["The client will automatically re-issue the request to the new address using the ",(0,r.jsx)(t.code,{children:"POST"})," method, and the request body data will not be lost."]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>d});var s=n(6540);const r={},i=s.createContext(r);function l(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);