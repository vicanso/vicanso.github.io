"use strict";(self.webpackChunkpingap=self.webpackChunkpingap||[]).push([[1031],{247:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"plugins/cors","title":"Cross-Origin Resource Sharing (CORS)","description":"Easily add Cross-Origin Resource Sharing (CORS) support to your APIs, automatically handling preflight requests and appending the necessary response headers to allow smooth communication for your separated frontend and backend applications.","source":"@site/docs/plugins/cors.md","sourceDirName":"plugins","slug":"/plugins/cors","permalink":"/pingap-en/docs/plugins/cors","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/plugins/cors.md","tags":[],"version":"current","sidebarPosition":86,"frontMatter":{"sidebar_position":86,"title":"Cross-Origin Resource Sharing (CORS)","description":"Easily add Cross-Origin Resource Sharing (CORS) support to your APIs, automatically handling preflight requests and appending the necessary response headers to allow smooth communication for your separated frontend and backend applications."},"sidebar":"tutorialSidebar","previous":{"title":"Response Compression","permalink":"/pingap-en/docs/plugins/compression"},"next":{"title":"CSRF Protection","permalink":"/pingap-en/docs/plugins/csrf"}}');var r=t(4848),i=t(8453);const l={sidebar_position:86,title:"Cross-Origin Resource Sharing (CORS)",description:"Easily add Cross-Origin Resource Sharing (CORS) support to your APIs, automatically handling preflight requests and appending the necessary response headers to allow smooth communication for your separated frontend and backend applications."},o="Cross-Origin Resource Sharing (CORS) Plugin",d={},c=[{value:"Feature Introduction",id:"feature-introduction",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Configuration Parameters",id:"configuration-parameters",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Access Effects",id:"access-effects",level:3}];function a(e){const s={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"cross-origin-resource-sharing-cors-plugin",children:"Cross-Origin Resource Sharing (CORS) Plugin"})}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"cors"})," plugin automatically handles Cross-Origin Resource Sharing (CORS) requests initiated by browsers, freeing you from writing complex CORS handling logic in your backend services."]}),"\n",(0,r.jsx)(s.h2,{id:"feature-introduction",children:"Feature Introduction"}),"\n",(0,r.jsx)(s.p,{children:"For security reasons, browsers restrict scripts originating from one origin from making requests to another origin. CORS is a W3C standard that allows a server to declare which origins are permitted to access its resources."}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"cors"})," plugin implements this mechanism in two ways:"]}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Handling Preflight Requests"}),": For complex cross-origin requests (e.g., ",(0,r.jsx)(s.code,{children:"PUT"})," methods or requests with custom headers), the browser first sends an ",(0,r.jsx)(s.code,{children:"OPTIONS"}),' method "preflight" request. This plugin automatically intercepts and responds to this request, informing the browser that the actual request is safe.']}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Appending CORS Response Headers"}),": For simple requests or actual requests that have passed the preflight check, the plugin appends the necessary ",(0,r.jsx)(s.code,{children:"Access-Control-Allow-*"})," response headers to the final response, authorizing the browser to receive and process it."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"With simple configuration, you can precisely control who can access your API, which methods and headers are allowed, and how long preflight results can be cached."}),"\n",(0,r.jsx)(s.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Separated Frontend and Backend Applications"}),": This is the most typical scenario. When your frontend application (e.g., React, Vue) is deployed at ",(0,r.jsx)(s.code,{children:"https://app.example.com"})," and your backend API service is at ",(0,r.jsx)(s.code,{children:"https://api.example.com"}),", any request from the frontend to the backend is a cross-origin request and must be permitted via a CORS policy."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Public APIs Open to Third Parties"}),": If you provide a public API for third-party developers to call from their websites, you need to configure CORS to authorize these third-party origins."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Web Fonts or CDN Resources"}),": CORS configuration is also required when a webpage needs to load fonts, images, or other resources from a different domain."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"configuration-parameters",children:"Configuration Parameters"}),"\n",(0,r.jsxs)(s.p,{children:["Configuration is done in the ",(0,r.jsx)(s.code,{children:"plugin.cors.toml"})," file."]}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{style:{textAlign:"left"},children:"Parameter"}),(0,r.jsx)(s.th,{style:{textAlign:"left"},children:"Type"}),(0,r.jsx)(s.th,{style:{textAlign:"left"},children:"Required"}),(0,r.jsx)(s.th,{style:{textAlign:"left"},children:"Default"}),(0,r.jsx)(s.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"allow_origin"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"String"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"*"})}),(0,r.jsxs)(s.td,{style:{textAlign:"left"},children:["The allowed origin domain. Can be ",(0,r.jsx)(s.code,{children:"*"})," (allow any domain), a single domain (e.g., ",(0,r.jsx)(s.code,{children:"https://app.example.com"}),"), or a dynamic value ",(0,r.jsx)(s.code,{children:"`{$http_origin}`"})," (mirrors the request's Origin header)."]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"allow_methods"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"String"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:'"GET, POST, ..."'})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"A comma-separated list of allowed HTTP methods."})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"allow_headers"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"String"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.em,{children:"(empty)"})}),(0,r.jsxs)(s.td,{style:{textAlign:"left"},children:["A comma-separated list of allowed custom request headers, e.g., ",(0,r.jsx)(s.code,{children:"Content-Type, X-Token"}),"."]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"expose_headers"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"String"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.em,{children:"(empty)"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"A comma-separated list of response headers that frontend JavaScript is allowed to access."})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"allow_credentials"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"Boolean"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"false"})}),(0,r.jsxs)(s.td,{style:{textAlign:"left"},children:["Whether to allow requests to carry credentials (like Cookies, Authorization headers). Note: If set to ",(0,r.jsx)(s.code,{children:"true"}),", ",(0,r.jsx)(s.code,{children:"allow_origin"})," ",(0,r.jsx)(s.strong,{children:"cannot"})," be ",(0,r.jsx)(s.code,{children:"*"}),"."]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"max_age"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"String"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:'"1h"'})}),(0,r.jsxs)(s.td,{style:{textAlign:"left"},children:["The cache duration for preflight request results in the browser, formatted as a time string (e.g., ",(0,r.jsx)(s.code,{children:'"10m"'}),", ",(0,r.jsx)(s.code,{children:'"24h"'}),")."]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.code,{children:"path"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"String"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"No"}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:(0,r.jsx)(s.em,{children:"(empty)"})}),(0,r.jsx)(s.td,{style:{textAlign:"left"},children:"A regular expression used to specify that this CORS policy only applies to matching paths."})]})]})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Goal"}),": Configure CORS for a project with a separated frontend and backend. The frontend is deployed at ",(0,r.jsx)(s.code,{children:"https://app.my-domain.com"}),", and the API service is accessed via the ",(0,r.jsx)(s.code,{children:"/api/"})," path. The API needs to handle ",(0,r.jsx)(s.code,{children:"GET"}),", ",(0,r.jsx)(s.code,{children:"POST"}),", ",(0,r.jsx)(s.code,{children:"PUT"})," requests and use two custom headers: ",(0,r.jsx)(s.code,{children:"Content-Type"})," and ",(0,r.jsx)(s.code,{children:"X-Auth-Token"}),"."]}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsxs)(s.strong,{children:["Configure the plugin (",(0,r.jsx)(s.code,{children:"plugin.cors-webapp.toml"}),")"]}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-toml",children:'# Only enable CORS for requests under the /api/ path\npath = "^/api/"\n\n# Only allow cross-origin requests from our frontend application\n# Using {$http_origin} can support multiple environments, e.g., dev/staging/production\nallow_origin = "[https://app.my-domain.com](https://app.my-domain.com)"\n\n# Allowed HTTP methods for the frontend application\nallow_methods = "GET, POST, PUT, OPTIONS"\n\n# Allowed custom headers sent by the frontend\nallow_headers = "Content-Type, X-Auth-Token"\n\n# Allow the frontend to access the X-Request-ID header in the response for debugging\nexpose_headers = "X-Request-ID"\n\n# Allow cross-origin requests to carry and set cookies\nallow_credentials = true\n\n# Cache preflight results for 24 hours to reduce OPTIONS requests\nmax_age = "24h"\n'})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsxs)(s.strong,{children:["Apply the plugin in a Location (",(0,r.jsx)(s.code,{children:"location.toml"}),")"]}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-toml",children:'# ...\n[locations.route-for-my-app]\nupstream = "api-backend"\nplugins = [\n    "cors-webapp",\n]\n# ...\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"access-effects",children:"Access Effects"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["When the frontend application at ",(0,r.jsx)(s.code,{children:"https://app.my-domain.com"})," sends a ",(0,r.jsx)(s.code,{children:"PUT"})," request with an ",(0,r.jsx)(s.code,{children:"X-Auth-Token"})," to ",(0,r.jsx)(s.code,{children:"/api/users"}),":","\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["The browser automatically sends an ",(0,r.jsx)(s.code,{children:"OPTIONS /api/users"})," preflight request."]}),"\n",(0,r.jsxs)(s.li,{children:["Pingap's CORS plugin intercepts this request, checks the configuration, and returns a ",(0,r.jsx)(s.code,{children:"204 No Content"})," response with ",(0,r.jsx)(s.code,{children:"Access-Control-Allow-Origin"}),", ",(0,r.jsx)(s.code,{children:"Access-Control-Allow-Methods"}),", ",(0,r.jsx)(s.code,{children:"Access-Control-Allow-Headers"}),", and other headers."]}),"\n",(0,r.jsxs)(s.li,{children:["After the browser validates the preflight response, it sends the actual ",(0,r.jsx)(s.code,{children:"PUT /api/users"})," request."]}),"\n",(0,r.jsxs)(s.li,{children:["When the ",(0,r.jsx)(s.code,{children:"api-backend"})," service returns a response, the CORS plugin intervenes again, adding headers like ",(0,r.jsx)(s.code,{children:"Access-Control-Allow-Origin: https://app.my-domain.com"})," to the final response before sending it back to the browser."]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>l,x:()=>o});var n=t(6540);const r={},i=n.createContext(r);function l(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);