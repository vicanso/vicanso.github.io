"use strict";(self.webpackChunkpingap=self.webpackChunkpingap||[]).push([[6141],{1083:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"plugins/referer-restriction","title":"Referer Restriction","description":"Implement access control based on the request\'s origin by checking the HTTP Referer header. Effectively prevent hotlinking of resources like images and videos, and restrict API calls to trusted websites.","source":"@site/docs/plugins/referer-restriction.md","sourceDirName":"plugins","slug":"/plugins/referer-restriction","permalink":"/pingap-en/docs/plugins/referer-restriction","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/plugins/referer-restriction.md","tags":[],"version":"current","sidebarPosition":96,"frontMatter":{"sidebar_position":96,"title":"Referer Restriction","description":"Implement access control based on the request\'s origin by checking the HTTP Referer header. Effectively prevent hotlinking of resources like images and videos, and restrict API calls to trusted websites."},"sidebar":"tutorialSidebar","previous":{"title":"HTTP Redirect","permalink":"/pingap-en/docs/plugins/redirect"},"next":{"title":"Request ID","permalink":"/pingap-en/docs/plugins/request-id"}}');var t=n(4848),r=n(8453);const l={sidebar_position:96,title:"Referer Restriction",description:"Implement access control based on the request's origin by checking the HTTP Referer header. Effectively prevent hotlinking of resources like images and videos, and restrict API calls to trusted websites."},c="Referer Restriction Plugin",o={},d=[{value:"Feature Introduction",id:"feature-introduction",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Configuration Parameters",id:"configuration-parameters",level:2},{value:"Complete Examples",id:"complete-examples",level:2},{value:"Example 1: Preventing Image Hotlinking (Whitelist Mode)",id:"example-1-preventing-image-hotlinking-whitelist-mode",level:3},{value:"Access Effects",id:"access-effects",level:3},{value:"Example 2: Blocking Known Spam Sources (Blacklist Mode)",id:"example-2-blocking-known-spam-sources-blacklist-mode",level:3},{value:"Access Effects",id:"access-effects-1",level:3},{value:"Precautions",id:"precautions",level:2}];function a(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"referer-restriction-plugin",children:"Referer Restriction Plugin"})}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"referer-restriction"})," plugin is a request-phase security plugin that inspects the HTTP ",(0,t.jsx)(s.code,{children:"Referer"})," request header to identify the origin page of a request, and then ",(0,t.jsx)(s.strong,{children:"allows"})," or ",(0,t.jsx)(s.strong,{children:"denies"})," the request based on a list of rules you configure."]}),"\n",(0,t.jsx)(s.h2,{id:"feature-introduction",children:"Feature Introduction"}),"\n",(0,t.jsxs)(s.p,{children:["When a browser requests a resource (e.g., an image) from your service from a page (e.g., ",(0,t.jsx)(s.code,{children:"https://example.com/page"}),"), it typically includes a ",(0,t.jsx)(s.code,{children:"Referer"})," header with the value ",(0,t.jsx)(s.code,{children:"https://example.com/page"}),". This plugin leverages this mechanism to implement access control."]}),"\n",(0,t.jsx)(s.p,{children:"It supports two core working modes:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Whitelist (Allow)"}),": Only allows requests whose ",(0,t.jsx)(s.code,{children:"Referer"})," is in your specified list to pass through."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Blacklist (Deny)"}),": Denies requests whose ",(0,t.jsx)(s.code,{children:"Referer"})," is in your specified list."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["The matching rules support both ",(0,t.jsx)(s.strong,{children:"exact domains"})," (e.g., ",(0,t.jsx)(s.code,{children:"example.com"}),") and ",(0,t.jsx)(s.strong,{children:"wildcard domains"})," (e.g., ",(0,t.jsx)(s.code,{children:"*.example.com"}),"), providing flexible configuration options."]}),"\n",(0,t.jsx)(s.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Preventing Resource Hotlinking"}),": This is the most classic use case. You can configure a ",(0,t.jsx)(s.strong,{children:"whitelist"})," to only allow ",(0,t.jsx)(s.code,{children:"Referer"}),"s from your own website to load static assets like images, videos, and fonts. This prevents other websites from directly using your resources and consuming your server's bandwidth."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Enhancing API Security"}),": Configure a ",(0,t.jsx)(s.strong,{children:"whitelist"})," for your Web API to only allow calls from the domain where your official frontend application is hosted. This adds an extra layer of security by blocking direct API calls from other unknown websites."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Blocking Malicious or Spam Sources"}),": If you find that spam websites or malicious crawlers are accessing your service by forging ",(0,t.jsx)(s.code,{children:"Referer"}),"s, you can add their domains to a ",(0,t.jsx)(s.strong,{children:"blacklist"}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"configuration-parameters",children:"Configuration Parameters"}),"\n",(0,t.jsxs)(s.p,{children:["Configuration is done in the ",(0,t.jsx)(s.code,{children:"plugin.referer-restriction.toml"})," file."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"Parameter"}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"Type"}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"Required"}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"Default"}),(0,t.jsx)(s.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"type"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"String"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Yes"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"-"}),(0,t.jsxs)(s.td,{style:{textAlign:"left"},children:[(0,t.jsx)(s.strong,{children:"(Required)"})," The type of restriction. Possible values are ",(0,t.jsx)(s.code,{children:'"deny"'})," (blacklist mode) or ",(0,t.jsx)(s.code,{children:'"allow"'})," (whitelist mode)."]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"referer_list"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"Array of Strings"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.strong,{children:"Yes"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"[]"})}),(0,t.jsxs)(s.td,{style:{textAlign:"left"},children:[(0,t.jsx)(s.strong,{children:"(Required)"})," A list used to match against the domain in the ",(0,t.jsx)(s.code,{children:"Referer"})," header. Two formats are supported:",(0,t.jsx)("br",{}),"\u2022 ",(0,t.jsx)(s.strong,{children:"Exact match"}),": ",(0,t.jsx)(s.code,{children:'"site.com"'}),(0,t.jsx)("br",{}),"\u2022 ",(0,t.jsx)(s.strong,{children:"Wildcard match"}),": ",(0,t.jsx)(s.code,{children:'"*.site.com"'})]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:"message"})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"String"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"No"}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:(0,t.jsx)(s.code,{children:'"Request is forbidden"'})}),(0,t.jsx)(s.td,{style:{textAlign:"left"},children:"A custom message to return to the client when a request is denied."})]})]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"complete-examples",children:"Complete Examples"}),"\n",(0,t.jsx)(s.h3,{id:"example-1-preventing-image-hotlinking-whitelist-mode",children:"Example 1: Preventing Image Hotlinking (Whitelist Mode)"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Goal"}),": Our website domain is ",(0,t.jsx)(s.code,{children:"my-gallery.com"}),", and we only want images in the ",(0,t.jsx)(s.code,{children:"/images/"})," directory to be referenced by our own website (including all subdomains)."]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsxs)(s.strong,{children:["Configure the plugin (",(0,t.jsx)(s.code,{children:"plugin.referer-allow-images.toml"}),")"]}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-toml",children:'# Set to whitelist mode\ntype = "allow"\n\n# Only allow requests from my-gallery.com and all its subdomains\nreferer_list = [\n  "my-gallery.com",\n  "*.my-gallery.com",\n]\n'})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsxs)(s.strong,{children:["Apply the plugin in a Location (",(0,t.jsx)(s.code,{children:"location.toml"}),")"]}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-toml",children:'# location.toml\n[locations.image-assets]\n# Only apply to the images directory\npath = "/images/"\n# This Location is handled by a static file plugin or an upstream service\nupstream = "static-assets-backend" \nplugins = [\n    "referer-allow-images",\n]\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"access-effects",children:"Access Effects"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["When the page ",(0,t.jsx)(s.code,{children:"https://my-gallery.com/index.html"})," loads the image ",(0,t.jsx)(s.code,{children:"/images/cat.jpg"}),", the request's ",(0,t.jsx)(s.code,{children:"Referer"})," is ",(0,t.jsx)(s.code,{children:"https://my-gallery.com/index.html"}),", which matches the whitelist. ",(0,t.jsx)(s.strong,{children:"Access is granted"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["When the page ",(0,t.jsx)(s.code,{children:"https://evil-site.com/steal.html"})," tries to reference ",(0,t.jsx)(s.code,{children:"/images/cat.jpg"})," using an ",(0,t.jsx)(s.code,{children:"<img>"})," tag, the request's ",(0,t.jsx)(s.code,{children:"Referer"})," is ",(0,t.jsx)(s.code,{children:"https://evil-site.com/steal.html"}),", which does not match the whitelist. The request will be intercepted and a ",(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"403 Forbidden"})})," will be returned."]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"example-2-blocking-known-spam-sources-blacklist-mode",children:"Example 2: Blocking Known Spam Sources (Blacklist Mode)"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Goal"}),": Block all access from ",(0,t.jsx)(s.code,{children:"spam-domain.com"})," and ",(0,t.jsx)(s.code,{children:"bad-site.org"}),"."]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsxs)(s.strong,{children:["Configure the plugin (",(0,t.jsx)(s.code,{children:"plugin.referer-deny-spam.toml"}),")"]}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-toml",children:'# Set to blacklist mode\ntype = "deny"\n\n# List the domains to block\nreferer_list = [\n  "spam-domain.com",\n  "bad-site.org",\n]\n'})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsxs)(s.strong,{children:["Apply the plugin in a Location (",(0,t.jsx)(s.code,{children:"location.toml"}),")"]}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-toml",children:'# location.toml\n[locations.main-site]\npath = "/"\nupstream = "main-server"\nplugins = [\n    "referer-deny-spam",\n    # ... other plugins\n]\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"access-effects-1",children:"Access Effects"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Any request with a ",(0,t.jsx)(s.code,{children:"Referer"})," header pointing to ",(0,t.jsx)(s.code,{children:"spam-domain.com"})," or ",(0,t.jsx)(s.code,{children:"bad-site.org"})," will be intercepted and will receive a ",(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"403 Forbidden"})}),"."]}),"\n",(0,t.jsx)(s.li,{children:"Requests from other sources (like a Google search results page) will pass through normally."}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"precautions",children:"Precautions"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\u2757 ",(0,t.jsx)(s.strong,{children:"Security Warning"}),": The ",(0,t.jsx)(s.code,{children:"Referer"})," header is sent by the client (browser) and therefore ",(0,t.jsx)(s.strong,{children:"can be forged"}),". Please do not use Referer restriction as your ",(0,t.jsx)(s.strong,{children:"only"})," security mechanism to protect critical or sensitive operations. It is better suited as a supplementary line of defense to increase the difficulty for attackers."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Empty Referer"}),": The ",(0,t.jsx)(s.code,{children:"Referer"})," header may be empty when a user types a URL directly into the browser's address bar, or when navigating from an HTTPS page to an HTTP page. In this plugin:","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsxs)(s.strong,{children:["Whitelist mode (",(0,t.jsx)(s.code,{children:"allow"}),")"]}),": Requests with an empty ",(0,t.jsx)(s.code,{children:"Referer"})," ",(0,t.jsx)(s.strong,{children:"will be denied"})," because they do not match any allowed domains."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsxs)(s.strong,{children:["Blacklist mode (",(0,t.jsx)(s.code,{children:"deny"}),")"]}),": Requests with an empty ",(0,t.jsx)(s.code,{children:"Referer"})," ",(0,t.jsx)(s.strong,{children:"will be allowed"})," because they do not match any forbidden domains."]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>c});var i=n(6540);const t={},r=i.createContext(t);function l(e){const s=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);