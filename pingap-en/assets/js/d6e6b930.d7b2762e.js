"use strict";(self.webpackChunkpingap=self.webpackChunkpingap||[]).push([[4866],{7090:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"plugins/jwt","title":"JWT Authentication (JWT)","description":"Protect your APIs and services by validating JSON Web Tokens (JWT). The plugin supports multiple token delivery methods, signing algorithms, and can transform backend authentication logic into stateless JWT tokens.","source":"@site/docs/plugins/jwt.md","sourceDirName":"plugins","slug":"/plugins/jwt","permalink":"/pingap-en/docs/plugins/jwt","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/plugins/jwt.md","tags":[],"version":"current","sidebarPosition":90,"frontMatter":{"sidebar_position":90,"title":"JWT Authentication (JWT)","description":"Protect your APIs and services by validating JSON Web Tokens (JWT). The plugin supports multiple token delivery methods, signing algorithms, and can transform backend authentication logic into stateless JWT tokens."},"sidebar":"tutorialSidebar","previous":{"title":"IP Restriction","permalink":"/pingap-en/docs/plugins/ip-restriction"},"next":{"title":"API Key Auth","permalink":"/pingap-en/docs/plugins/key-auth"}}');var s=n(4848),r=n(8453);const l={sidebar_position:90,title:"JWT Authentication (JWT)",description:"Protect your APIs and services by validating JSON Web Tokens (JWT). The plugin supports multiple token delivery methods, signing algorithms, and can transform backend authentication logic into stateless JWT tokens."},o="JWT Authentication (JWT) Plugin",a={},c=[{value:"Feature Introduction",id:"feature-introduction",level:2},{value:"1. Token Validation",id:"1-token-validation",level:4},{value:"2. Token Generation",id:"2-token-generation",level:4},{value:"Use Cases",id:"use-cases",level:2},{value:"Configuration Parameters",id:"configuration-parameters",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"1. Authentication Flow Design",id:"1-authentication-flow-design",level:4},{value:"2. Configure the plugin (<code>plugin.jwt-main.toml</code>)",id:"2-configure-the-plugin-pluginjwt-maintoml",level:4},{value:"Access Effects",id:"access-effects",level:2}];function d(e){const t={code:"code",em:"em",h1:"h1",h2:"h2",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"jwt-authentication-jwt-plugin",children:"JWT Authentication (JWT) Plugin"})}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"jwt"})," plugin is a powerful authentication plugin that protects your upstream services by validating ",(0,s.jsx)(t.strong,{children:"JSON Web Tokens (JWT)"}),", providing a modern, stateless, and scalable authentication solution for your APIs."]}),"\n",(0,s.jsx)(t.h2,{id:"feature-introduction",children:"Feature Introduction"}),"\n",(0,s.jsxs)(t.p,{children:["This plugin has a dual role: ",(0,s.jsx)(t.strong,{children:"Token Validation"})," and ",(0,s.jsx)(t.strong,{children:"Token Generation"}),"."]}),"\n",(0,s.jsx)(t.h4,{id:"1-token-validation",children:"1. Token Validation"}),"\n",(0,s.jsx)(t.p,{children:"For all requests except those to the login endpoint, the plugin automatically extracts a JWT from a specified location (HTTP Header, Cookie, or Query parameter) and performs a series of strict checks:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Signature Verification"}),": Uses a preset secret key to verify the token's signature, ensuring the token has not been tampered with. It supports ",(0,s.jsx)(t.strong,{children:"HS256"})," and ",(0,s.jsx)(t.strong,{children:"HS512"})," algorithms."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Expiration Verification"}),": Checks the ",(0,s.jsx)(t.code,{children:"exp"})," claim in the token, rejecting any that have expired."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Format Verification"}),": Ensures the token follows the standard three-part structure."]}),"\n"]}),"\n",(0,s.jsx)(t.h4,{id:"2-token-generation",children:"2. Token Generation"}),"\n",(0,s.jsxs)(t.p,{children:["When a request is made to your specified ",(0,s.jsx)(t.strong,{children:"authentication path"})," (e.g., ",(0,s.jsx)(t.code,{children:"/api/login"}),"), the plugin does not perform validation. Instead, it intercepts a ",(0,s.jsx)(t.strong,{children:"successful response"})," from the upstream service at that path. It then takes the response body (usually a JSON object containing user information) as the JWT's ",(0,s.jsx)(t.code,{children:"payload"}),", signs it with your secret key, and generates a brand new JWT. Finally, it returns this JWT to the client in JSON format."]}),"\n",(0,s.jsx)(t.p,{children:"This design allows you to seamlessly convert traditional, stateful authentication logic (like username/password validation) into a modern, stateless JWT authentication model."}),"\n",(0,s.jsx)(t.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Protecting Stateless APIs"}),": This is the most typical use case for JWT. After logging in, a client receives a JWT and includes it in all subsequent requests. The server can then verify the user's identity without querying a database or session store."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Microservices Authentication"}),": In a microservices architecture, one service (like a user authentication service) can issue JWTs, and all other services can verify them using the same secret key, achieving decoupling between services."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Single Page Application (SPA) Authentication"}),": A frontend application (React, Vue, etc.) stores the JWT locally (e.g., in Local Storage) after login and includes it in the ",(0,s.jsx)(t.code,{children:"Authorization"})," header of subsequent API requests."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"configuration-parameters",children:"Configuration Parameters"}),"\n",(0,s.jsxs)(t.p,{children:["Configuration is done in the ",(0,s.jsx)(t.code,{children:"plugin.jwt.toml"})," file."]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Type"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Required"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"secret"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Yes"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"(Required)"})," The ",(0,s.jsx)(t.strong,{children:"top-secret"})," key for HMAC signing. Must be sufficiently complex and random, and all Pingap instances must use the same key."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.code,{children:"header"})," / ",(0,s.jsx)(t.code,{children:"query"})," / ",(0,s.jsx)(t.code,{children:"cookie"})]}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"Yes"})," (one of the three)"]}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"(Required)"})," Specifies where to extract the JWT from. ",(0,s.jsx)(t.code,{children:"header"}),": request header name; ",(0,s.jsx)(t.code,{children:"query"}),": URL query parameter name; ",(0,s.jsx)(t.code,{children:"cookie"}),": cookie name."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"auth_path"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"No"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.em,{children:"(empty)"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["The ",(0,s.jsx)(t.strong,{children:"token generation path"}),". If configured, requests to this path will trigger the ",(0,s.jsx)(t.strong,{children:"token generation"})," process."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"algorithm"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"No"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:'"HS256"'})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["The signing algorithm. Possible values are ",(0,s.jsx)(t.code,{children:'"HS256"'})," or ",(0,s.jsx)(t.code,{children:'"HS512"'}),". HS512 is more secure but has slightly more computational overhead."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"delay"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"No"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["Introduces a delay for requests with ",(0,s.jsx)(t.strong,{children:"failed validation"}),", for example, ",(0,s.jsx)(t.code,{children:'"100ms"'}),". This is an effective defense against ",(0,s.jsx)(t.strong,{children:"timing attacks"}),"."]})]})]})]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Goal"}),": We have a traditional login endpoint at ",(0,s.jsx)(t.code,{children:"auth-server"})," that accepts a username and password and returns user JSON information upon successful validation. We want to convert this to use JWT authentication with Pingap."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Login Endpoint"}),": ",(0,s.jsx)(t.code,{children:"POST /api/auth/login"})]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Protected Endpoint"}),": ",(0,s.jsx)(t.code,{children:"/api/me"})]}),"\n"]}),"\n",(0,s.jsx)(t.h4,{id:"1-authentication-flow-design",children:"1. Authentication Flow Design"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["The client sends a username and password to Pingap at ",(0,s.jsx)(t.code,{children:"/api/auth/login"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Pingap forwards the request to the backend ",(0,s.jsx)(t.code,{children:"auth-server"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"auth-server"})," validates the credentials. On success, it returns ",(0,s.jsx)(t.code,{children:"200 OK"})," with user info JSON (e.g., ",(0,s.jsx)(t.code,{children:'{"userId": 123, "role": "admin", "exp": 1757751000}'}),")."]}),"\n",(0,s.jsxs)(t.li,{children:["Pingap's JWT plugin intercepts this successful response, uses it as the ",(0,s.jsx)(t.code,{children:"payload"}),", signs it, and generates a JWT."]}),"\n",(0,s.jsxs)(t.li,{children:["Pingap returns ",(0,s.jsx)(t.code,{children:'{"token": "xxx.yyy.zzz"}'})," to the client."]}),"\n",(0,s.jsxs)(t.li,{children:["For subsequent requests to ",(0,s.jsx)(t.code,{children:"/api/me"}),", the client includes ",(0,s.jsx)(t.code,{children:"Authorization: Bearer xxx.yyy.zzz"})," in the request header."]}),"\n",(0,s.jsx)(t.li,{children:"The JWT plugin validates this token and, on success, forwards the request to the backend."}),"\n"]}),"\n",(0,s.jsxs)(t.h4,{id:"2-configure-the-plugin-pluginjwt-maintoml",children:["2. Configure the plugin (",(0,s.jsx)(t.code,{children:"plugin.jwt-main.toml"}),")"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-toml",children:'# The secret key used for signing\nsecret = "MySuperSecretKeyThatIsVeryLongAndSecure"\n\n# The token generation path\nauth_path = "/api/auth/login"\n\n# Extract the token from the Authorization header during validation\nheader = "Authorization"\n\n# Use the stronger HS512 algorithm\nalgorithm = "HS512"\n\n#### 3. Apply the plugin in a Location (location.toml)\n\n```toml\n# ...\n[locations.route-for-my-app]\n# Match all API requests, including login and protected endpoints\npath = "/api/"\nupstream = "api-backend" # Assuming all APIs are on the same backend\nplugins = [\n    "jwt-main",\n]\n# ...\n'})}),"\n",(0,s.jsx)(t.h2,{id:"access-effects",children:"Access Effects"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Login:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["POST ",(0,s.jsx)(t.code,{children:"/api/auth/login"})," with the correct username and password."]}),"\n",(0,s.jsxs)(t.li,{children:["The backend ",(0,s.jsx)(t.code,{children:"api-backend"})," returns ",(0,s.jsx)(t.code,{children:"200 OK"})," with ",(0,s.jsx)(t.code,{children:'{"userId": 123, "role": "admin", "exp": ...}'}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["The client ultimately receives ",(0,s.jsx)(t.code,{children:"200 OK"})," from Pingap with ",(0,s.jsx)(t.code,{children:'{"token": "eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEyMywicm9sZSI6ImFkbWluIiwiZXhwIjoxNzU3NzUxMDAwfQ.xxxxxxxx"}'}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Accessing a Protected Resource (Success):"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["GET ",(0,s.jsx)(t.code,{children:"/api/me"})," with the header ",(0,s.jsx)(t.code,{children:"Authorization: Bearer eyJ...."})]}),"\n",(0,s.jsxs)(t.li,{children:["The plugin successfully validates the token, and the request is forwarded to ",(0,s.jsx)(t.code,{children:"api-backend"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Accessing a Protected Resource (Failure):"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["GET ",(0,s.jsx)(t.code,{children:"/api/me"})," without an ",(0,s.jsx)(t.code,{children:"Authorization"})," header, or with a tampered/expired token."]}),"\n",(0,s.jsxs)(t.li,{children:["The plugin immediately returns a ",(0,s.jsx)(t.code,{children:"401 Unauthorized"})," response, and the request never reaches ",(0,s.jsx)(t.code,{children:"api-backend"}),"."]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>o});var i=n(6540);const s={},r=i.createContext(s);function l(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);